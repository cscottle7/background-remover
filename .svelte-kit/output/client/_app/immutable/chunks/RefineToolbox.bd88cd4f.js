var vt=Object.defineProperty;var ft=(n,e,t)=>e in n?vt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var b=(n,e,t)=>(ft(n,typeof e!="symbol"?e+"":e,t),t);import{s as Ze,f as p,a as k,g as w,h as D,d as E,c as P,j as g,k as Te,E as F,i as ce,w as u,A as Me,J as Ke,o as gt,v as X,Q as Ye,p as ge,K as mt,l as pe,m as we,R as it,F as le,n as pt,H as wt,U as yt}from"./scheduler.f95f0c95.js";import{S as Ge,i as Je,b as Ct,d as _t,m as bt,a as St,t as Et,e as xt}from"./index.a7b2bf40.js";import{e as Ae}from"./each.e59479a4.js";class It{constructor(e){b(this,"layers");b(this,"contexts");b(this,"state");b(this,"originalImageData",null);b(this,"processedImageData",null);b(this,"isInitialized",!1);b(this,"operationCache",new Map);b(this,"MAX_CACHE_SIZE",5);b(this,"lastCleanupTime",0);b(this,"CLEANUP_INTERVAL",6e4);this.layers=e,this.contexts={original:e.original.getContext("2d"),processed:e.processed.getContext("2d"),mask:e.mask.getContext("2d"),preview:e.preview.getContext("2d")},this.state={width:0,height:0,scale:1,imageWidth:0,imageHeight:0}}async initialize(e,t){try{console.log("üé® Initializing canvas engine..."),console.log("üñºÔ∏è Original src:",e.substring(0,50)+"..."),console.log("üñºÔ∏è Processed src:",t.substring(0,50)+"...");const[i,s]=await Promise.all([this.loadImage(e),this.loadImage(t)]);console.log("üìè Image dimensions:",{original:`${i.width}x${i.height}`,processed:`${s.width}x${s.height}`}),this.state.imageWidth=s.width,this.state.imageHeight=s.height,this.setupCanvases(s.width,s.height),this.contexts.original.drawImage(i,0,0),this.contexts.processed.drawImage(s,0,0),console.log("üé® Images drawn to canvases"),this.originalImageData=this.contexts.original.getImageData(0,0,s.width,s.height),this.processedImageData=this.contexts.processed.getImageData(0,0,s.width,s.height),console.log("üíæ Image data stored"),this.updatePreview(),this.isInitialized=!0,console.log("‚úÖ Canvas engine initialized successfully:",this.state)}catch(i){throw console.error("‚ùå Canvas engine initialization failed:",i),i}}setCanvasDimensions(e,t,i){this.state.width=e,this.state.height=t,this.state.scale=i,Object.values(this.layers).forEach(s=>{s.width=e,s.height=t,s.style.width=`${e}px`,s.style.height=`${t}px`}),console.log("üìê Canvas dimensions updated:",this.state)}performRestore(e,t,i){if(!this.isInitialized||!this.originalImageData||!this.processedImageData){console.warn("‚ö†Ô∏è Canvas not initialized for restore operation");return}const s=Math.round(Math.max(0,Math.min(this.state.imageWidth-1,e))),o=Math.round(Math.max(0,Math.min(this.state.imageHeight-1,t))),a=Math.max(1,Math.round(i));console.log("üñåÔ∏è Restore operation:",{coords:`${s},${o}`,size:a,imageSize:`${this.state.imageWidth}x${this.state.imageHeight}`});const d=this.contexts.preview.getImageData(0,0,this.state.imageWidth,this.state.imageHeight);this.restoreCircularArea(d.data,this.originalImageData.data,s,o,a),this.contexts.preview.putImageData(d,0,0),console.log("‚úÖ Restore operation completed at",s,o)}performErase(e,t,i){if(!this.isInitialized||!this.processedImageData){console.warn("‚ö†Ô∏è Canvas not initialized for erase operation");return}const s=Math.round(Math.max(0,Math.min(this.state.imageWidth-1,e))),o=Math.round(Math.max(0,Math.min(this.state.imageHeight-1,t))),a=Math.max(1,Math.round(i));console.log("üóëÔ∏è Erase operation:",{coords:`${s},${o}`,size:a,imageSize:`${this.state.imageWidth}x${this.state.imageHeight}`});const d=this.contexts.preview.getImageData(0,0,this.state.imageWidth,this.state.imageHeight);this.eraseCircularArea(d.data,s,o,a),this.contexts.preview.putImageData(d,0,0),console.log("‚úÖ Erase operation completed at",s,o)}updatePreview(){!this.isInitialized||!this.processedImageData||this.contexts.preview.putImageData(this.processedImageData,0,0)}showOriginalPreview(e){this.isInitialized&&(e&&this.originalImageData?this.contexts.preview.putImageData(this.originalImageData,0,0):this.processedImageData&&this.contexts.preview.putImageData(this.processedImageData,0,0))}exportPreview(){return this.layers.preview.toDataURL("image/png")}getState(){return{...this.state}}isReady(){return this.isInitialized}getPreviewCanvas(){return this.layers.preview}performMemoryCleanup(){const e=Date.now();if(!(e-this.lastCleanupTime<this.CLEANUP_INTERVAL)){if(this.operationCache.size>this.MAX_CACHE_SIZE){const t=this.operationCache.size-this.MAX_CACHE_SIZE;Array.from(this.operationCache.keys()).slice(0,t).forEach(s=>this.operationCache.delete(s)),console.log(`üßπ Cleaned up ${t} cached operations`)}this.lastCleanupTime=e}}performOptimizedBrushOp(e,t,i,s,o=1){const a=Math.round(s*o);this.performMemoryCleanup(),e==="restore"?this.performRestore(t,i,a):this.performErase(t,i,a)}async loadImage(e){return new Promise((t,i)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>t(s),s.onerror=i,s.src=e})}setupCanvases(e,t){Object.values(this.layers).forEach(i=>{i.width=e,i.height=t})}restoreCircularArea(e,t,i,s,o){const a=o*o;for(let d=Math.max(0,s-o);d<=Math.min(this.state.imageHeight-1,s+o);d++)for(let h=Math.max(0,i-o);h<=Math.min(this.state.imageWidth-1,i+o);h++){const m=h-i,f=d-s;if(m*m+f*f<=a){const I=(d*this.state.imageWidth+h)*4;e[I]=t[I],e[I+1]=t[I+1],e[I+2]=t[I+2],e[I+3]=t[I+3]}}}eraseCircularArea(e,t,i,s){const o=s*s;for(let a=Math.max(0,i-s);a<=Math.min(this.state.imageHeight-1,i+s);a++)for(let d=Math.max(0,t-s);d<=Math.min(this.state.imageWidth-1,t+s);d++){const h=d-t,m=a-i;if(h*h+m*m<=o){const S=(a*this.state.imageWidth+d)*4;e[S+3]=0}}}}class Tt{constructor(e){b(this,"canvasEngine");b(this,"currentTool","restore");b(this,"brushSize",20);b(this,"isDrawing",!1);b(this,"lastPoint",null);b(this,"undoStack",[]);b(this,"redoStack",[]);b(this,"maxUndoSteps",20);b(this,"lastPressure",1);b(this,"lastVelocity",0);b(this,"lastTimestamp",0);b(this,"strokePoints",[]);b(this,"MIN_BRUSH_SIZE",1);b(this,"MAX_BRUSH_SIZE",200);this.canvasEngine=e}setTool(e){this.currentTool=e,console.log("üîß Tool changed to:",e)}setBrushSize(e){this.brushSize=Math.max(1,Math.min(100,e)),console.log("üñåÔ∏è Brush size set to:",this.brushSize)}getCurrentTool(){return this.currentTool}getBrushSize(){return this.brushSize}handlePointerDown(e){this.canvasEngine.isReady()&&(this.isDrawing=!0,this.lastPoint=e.point,this.lastTimestamp=performance.now(),this.strokePoints=[{point:e.point,pressure:e.pressure||1,timestamp:this.lastTimestamp}],this.saveUndoState(),this.performToolOperation(e.point,e.pressure||1),console.log("üéØ Pointer down:",{tool:this.currentTool,point:e.point,pressure:e.pressure||1,pointerType:e.pointerType}))}handlePointerMove(e){!this.canvasEngine.isReady()||!this.isDrawing||!this.lastPoint||(this.interpolateStroke(this.lastPoint,e.point),this.lastPoint=e.point)}handlePointerUp(e){this.canvasEngine.isReady()&&(this.isDrawing=!1,this.lastPoint=null,console.log("üéØ Pointer up:",{tool:this.currentTool}))}handleTouchEvent(e){const t={type:e.type==="start"?"down":e.type==="move"?"move":"up",point:e.point,pressure:e.pressure,pointerType:"touch"};switch(e.type){case"start":this.handlePointerDown(t);break;case"move":this.handlePointerMove(t);break;case"end":this.handlePointerUp(t);break}}performSmartRestore(e){if(!this.canvasEngine.isReady())return;console.log("üß† Smart restore at:",e);const t=this.brushSize*2;this.canvasEngine.performRestore(e.x,e.y,t)}performSmartErase(e){if(!this.canvasEngine.isReady())return;console.log("üß† Smart erase at:",e);const t=this.brushSize*1.5;this.canvasEngine.performErase(e.x,e.y,t)}undo(){if(this.undoStack.length===0)return!1;const e=this.canvasEngine.exportPreview();this.redoStack.push(e);const t=this.undoStack.pop();return this.restoreCanvasState(t),console.log("‚Ü∂ Undo performed, stack size:",this.undoStack.length),!0}redo(){if(this.redoStack.length===0)return!1;const e=this.canvasEngine.exportPreview();this.undoStack.push(e);const t=this.redoStack.pop();return this.restoreCanvasState(t),console.log("‚Ü∑ Redo performed, stack size:",this.redoStack.length),!0}clearHistory(){this.undoStack=[],this.redoStack=[],console.log("üóëÔ∏è Undo/redo history cleared")}getHistoryState(){return{canUndo:this.undoStack.length>0,canRedo:this.redoStack.length>0}}saveInitialState(){this.canvasEngine.isReady()&&(this.canvasEngine.exportPreview(),console.log("üíæ Initial canvas state saved"))}performToolOperation(e,t=1){var a,d,h,m;const i=performance.now(),s=i-this.lastTimestamp;if(this.lastPoint&&s>0){const f=Math.sqrt(Math.pow(e.x-this.lastPoint.x,2)+Math.pow(e.y-this.lastPoint.y,2));this.lastVelocity=f/s}let o=this.brushSize*t;switch(this.lastVelocity>.5&&(o*=Math.max(.5,1-(this.lastVelocity-.5)*.3)),o=Math.max(this.MIN_BRUSH_SIZE,Math.min(this.MAX_BRUSH_SIZE,o)),this.currentTool){case"restore":(d=(a=this.canvasEngine).performOptimizedBrushOp)!=null&&d.call(a,"restore",e.x,e.y,o,t)||this.canvasEngine.performRestore(e.x,e.y,o);break;case"erase":(m=(h=this.canvasEngine).performOptimizedBrushOp)!=null&&m.call(h,"erase",e.x,e.y,o,t)||this.canvasEngine.performErase(e.x,e.y,o);break;case"smart-restore":this.performSmartRestore(e);break;case"smart-erase":this.performSmartErase(e);break}this.lastPressure=t,this.lastTimestamp=i}interpolateStroke(e,t){const i=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),s=Math.max(1,Math.floor(i/(this.brushSize*.1)));for(let o=0;o<=s;o++){const a=o/s,d={x:e.x+(t.x-e.x)*a,y:e.y+(t.y-e.y)*a};this.performToolOperation(d)}}saveUndoState(){const e=this.canvasEngine.exportPreview();this.undoStack.push(e),this.undoStack.length>this.maxUndoSteps&&this.undoStack.shift(),this.redoStack=[]}restoreCanvasState(e){const t=new Image;t.onload=()=>{const i=this.canvasEngine.getPreviewCanvas();if(i){const s=i.getContext("2d");s&&(s.clearRect(0,0,i.width,i.height),s.drawImage(t,0,0),console.log("üîÑ Canvas state restored from image data"))}},t.src=e}}class te{static getCanvasCoordinates(e,t){const i=t.getBoundingClientRect(),s=t.width/i.width,o=t.height/i.height;return{x:(e.clientX-i.left)*s,y:(e.clientY-i.top)*o}}static getTouchPressure(e){return e.force||1}static supportsPressure(){return"ontouchstart"in window&&"force"in Touch.prototype}static preventTouchDefaults(e){e.preventDefault(),e.stopPropagation()}}class Mt{constructor(e){b(this,"container");b(this,"canvases");b(this,"contexts");b(this,"viewport");b(this,"animationFrameId",null);b(this,"isDirty",!1);b(this,"isRendering",!1);b(this,"viewMode","processed");b(this,"offscreenCanvas",null);b(this,"offscreenContext",null);b(this,"renderQueue",[]);b(this,"lastViewportUpdate",0);b(this,"VIEWPORT_THROTTLE_MS",16);b(this,"renderScheduled",!1);b(this,"lastRenderTime",0);b(this,"MIN_RENDER_INTERVAL",16);b(this,"frameDropCount",0);b(this,"imageDataCache",new Map);b(this,"MAX_CACHE_SIZE",10);this.container=e,this.viewport={x:0,y:0,zoom:1,width:0,height:0},this.setupCanvases(),this.setupOffscreenCanvas()}initialize(e){this.canvases=e,this.contexts={original:e.original.getContext("2d"),processed:e.processed.getContext("2d"),preview:e.preview.getContext("2d"),display:e.display.getContext("2d")},Object.values(this.contexts).forEach(t=>{t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high","willReadFrequently"in t&&(t.willReadFrequently=!0)}),console.log("üé® Canvas renderer initialized")}setViewport(e,t){const i=Date.now();i-this.lastViewportUpdate<this.VIEWPORT_THROTTLE_MS||this.viewport.width===e&&this.viewport.height===t||(this.lastViewportUpdate=i,this.viewport.width=e,this.viewport.height=t,this.updateCanvasSizes(),this.markDirty(),console.log("üìê Viewport updated:",this.viewport))}refreshDisplayContext(){this.canvases.display&&(this.contexts.display=this.canvases.display.getContext("2d"),this.contexts.display.imageSmoothingEnabled=!0,this.contexts.display.imageSmoothingQuality="high","willReadFrequently"in this.contexts.display&&(this.contexts.display.willReadFrequently=!0),console.log("üîÑ Display context refreshed"))}setZoom(e){this.viewport.zoom=Math.max(.1,Math.min(5,e)),this.markDirty(),console.log("üîç Zoom set to:",this.viewport.zoom)}pan(e,t){this.viewport.x+=e,this.viewport.y+=t,this.markDirty()}centerImage(){if(!this.canvases.processed)return;const e=this.canvases.processed.width,t=this.canvases.processed.height,i=e*this.viewport.zoom,s=t*this.viewport.zoom;this.viewport.x=(this.viewport.width-i)/2,this.viewport.y=(this.viewport.height-s)/2,console.log("üìç Centered image (FIXED):",{scaledSize:`${i.toFixed(1)}x${s.toFixed(1)}`,position:`${this.viewport.x.toFixed(1)}, ${this.viewport.y.toFixed(1)}`,zoom:this.viewport.zoom}),this.markDirty()}fitToViewport(e){if(!this.canvases.processed)return;const t=this.canvases.processed.width,i=this.canvases.processed.height;if(this.viewport.width<=0||this.viewport.height<=0){console.warn("‚ö†Ô∏è Invalid viewport dimensions for fitToViewport");return}const s=window.innerWidth>768&&(e!=null&&e.toolboxWidth)?this.viewport.width-e.toolboxWidth-16:this.viewport.width,o=e!=null&&e.reservedHeight?this.viewport.height-e.reservedHeight:this.viewport.height,a=Math.min(20,Math.floor(Math.min(s,o)*.02)),d=s-a*2,h=o-a*2,m=d/t,f=h/i;this.viewport.zoom=Math.min(m,f,2),this.centerImage(),console.log("üìè Fitted to viewport (DESKTOP AWARE):",{imageSize:`${t}x${i}`,viewportSize:`${this.viewport.width}x${this.viewport.height}`,effectiveSize:`${s}x${o}`,availableArea:`${d}x${h}`,toolboxWidth:(e==null?void 0:e.toolboxWidth)||0,zoom:this.viewport.zoom,padding:a})}render(e={}){if(!this.isDirty)return;const t=performance.now();if(t-this.lastRenderTime<this.MIN_RENDER_INTERVAL){if(!this.renderScheduled){this.renderScheduled=!0;const i=this.MIN_RENDER_INTERVAL-(t-this.lastRenderTime);setTimeout(()=>{this.renderScheduled=!1,this.render(e)},i)}return}t-this.lastRenderTime>32?(this.frameDropCount++,this.frameDropCount>5&&console.warn("üêå Performance warning: Frame drops detected",{lastInterval:t-this.lastRenderTime,frameDrops:this.frameDropCount})):this.frameDropCount=Math.max(0,this.frameDropCount-1),this.lastRenderTime=t,this.queueRender(()=>this.performRender(e))}forceRender(e={}){this.cancelPendingRender(),this.performRender(e)}forceRenderProcessed(){if(!this.contexts.display){console.warn("‚ö†Ô∏è Cannot force render - missing display context");return}console.log("üö® Emergency render - trying all available canvases");const e=[{name:"original",canvas:this.canvases.original},{name:"processed",canvas:this.canvases.processed},{name:"preview",canvas:this.canvases.preview}].filter(s=>s.canvas&&s.canvas.width>0&&s.canvas.height>0);console.log("üîç Available canvas candidates:",e.map(s=>`${s.name} (${s.canvas.width}x${s.canvas.height})`));const t=this.contexts.display;t.clearRect(0,0,this.viewport.width,this.viewport.height);let i=!1;for(const s of e){console.log(`üé® Attempting direct render from ${s.name} canvas...`);try{const o=t.canvas.width,a=t.canvas.height,d=this.viewport.width,h=this.viewport.height;console.log("üìê Display canvas dimensions:",{actual:`${o}x${a}`,style:`${d}x${h}`,viewport:this.viewport});const m=Math.min(20,Math.floor(Math.min(d,h)*.02)),f=d-m*2,S=h-m*2,I=f/s.canvas.width,T=S/s.canvas.height,y=Math.min(I,T),_=s.canvas.width*y,x=s.canvas.height*y,v=(d-_)/2,C=(h-x)/2;console.log(`üìê ${s.name} scaling calculation:`,{sourceSize:`${s.canvas.width}x${s.canvas.height}`,availableArea:`${f}x${S}`,scale:y,scaledSize:`${_}x${x}`,position:`${v},${C}`}),t.drawImage(s.canvas,v,C,_,x);const l=t.getImageData(Math.floor(v+_/4),Math.floor(C+x/4),50,50);let r=!1;for(let K=3;K<l.data.length;K+=4)if(l.data[K]>0){r=!0;break}if(console.log(`üîç ${s.name} render result - Display canvas has content:`,r),r){console.log(`‚úÖ Emergency render successful using ${s.name} canvas`),i=!0;break}}catch(o){console.error(`‚ùå ${s.name} render failed:`,o)}}i||console.error("üí• All emergency render attempts failed")}setViewMode(e){this.viewMode=e,this.markDirty(),this.render(),console.log("üëÅÔ∏è View mode changed to:",e)}exportProcessedImage(){const e=this.canvases.preview||this.canvases.processed;return e?e.toDataURL("image/png"):null}getViewport(){return{...this.viewport}}screenToImage(e,t){const i=(e-this.viewport.x)/this.viewport.zoom,s=(t-this.viewport.y)/this.viewport.zoom;return{x:i,y:s}}imageToScreen(e,t){const i=e*this.viewport.zoom+this.viewport.x,s=t*this.viewport.zoom+this.viewport.y;return{x:i,y:s}}destroy(){this.cancelPendingRender(),this.renderQueue=[],this.offscreenCanvas&&(this.offscreenCanvas=null,this.offscreenContext=null),console.log("üóëÔ∏è Canvas renderer destroyed")}setupCanvases(){const e=document.createElement("style");e.textContent=`
      .canvas-container {
        position: relative;
        overflow: hidden;
        width: 100%;
        height: 100%;
      }
      
      .canvas-layer {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
      }
      
      .canvas-interactive {
        pointer-events: auto;
        touch-action: none;
      }
    `,document.head.appendChild(e)}setupOffscreenCanvas(){typeof OffscreenCanvas<"u"&&(this.offscreenCanvas=new OffscreenCanvas(800,600),this.offscreenContext=this.offscreenCanvas.getContext("2d"),console.log("‚ö° Offscreen canvas enabled for better performance"))}updateCanvasSizes(){if(!this.canvases.display)return;const e=this.canvases.display,t=window.devicePixelRatio||1;e.style.width=`${this.viewport.width}px`,e.style.height=`${this.viewport.height}px`,e.width=this.viewport.width*t,e.height=this.viewport.height*t,this.contexts.display=e.getContext("2d"),this.contexts.display.imageSmoothingEnabled=!0,this.contexts.display.imageSmoothingQuality="high",this.contexts.display.scale(t,t),console.log("üìê Display canvas resized:",{style:`${e.style.width} x ${e.style.height}`,actual:`${e.width} x ${e.height}`,pixelRatio:t})}markDirty(){this.isDirty=!0}queueRender(e){this.renderQueue.push(e),this.animationFrameId===null&&(this.animationFrameId=requestAnimationFrame(()=>{this.processRenderQueue()}))}processRenderQueue(){for(this.isRendering=!0;this.renderQueue.length>0;)this.renderQueue.shift()();this.isRendering=!1,this.isDirty=!1,this.animationFrameId=null}cancelPendingRender(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}performRender(e={}){if(!this.contexts.display){console.warn("‚ö†Ô∏è Missing display context for render");return}const t=this.contexts.display;console.log("üé® Performing render with view mode:",this.viewMode),console.log("üìê Viewport:",this.viewport),t.clearRect(0,0,this.viewport.width,this.viewport.height),t.save(),t.translate(this.viewport.x,this.viewport.y),t.scale(this.viewport.zoom,this.viewport.zoom);try{switch(this.viewMode){case"original":this.drawCanvas(this.canvases.original),console.log("üñºÔ∏è Rendered original view");break;case"comparison":this.drawComparisonView(),console.log("üñºÔ∏è Rendered comparison view");break;case"processed":default:this.drawCanvas(this.canvases.preview||this.canvases.processed),console.log("üñºÔ∏è Rendered processed view");break}}catch(i){console.error("‚ùå Error drawing to canvas:",i)}t.restore(),console.log("üé® Render completed")}drawCanvas(e){if(!e||e.width<=0||e.height<=0){console.warn("‚ö†Ô∏è No valid source canvas for drawing");return}this.contexts.display.drawImage(e,0,0),console.log(`‚úÖ Drew ${e.width}x${e.height} canvas to display`)}drawComparisonView(){const e=this.contexts.display,t=this.canvases.original,i=this.canvases.preview||this.canvases.processed;if(!t||!i){console.warn("‚ö†Ô∏è Missing canvases for comparison view");return}const s=t.width,o=t.height,a=s*.5;e.save(),e.beginPath(),e.rect(0,0,a,o),e.clip(),e.drawImage(t,0,0),e.restore(),e.save(),e.beginPath(),e.rect(a,0,s-a,o),e.clip(),e.drawImage(i,0,0),e.restore(),e.strokeStyle="#3b82f6",e.lineWidth=2,e.beginPath(),e.moveTo(a,0),e.lineTo(a,o),e.stroke(),console.log("‚úÖ Comparison view drawn with split at 50%")}renderComparison(e,t){if(!this.canvases.original||!this.canvases.preview)return;const i=this.canvases.preview.width,s=this.canvases.preview.height,o=i*t;e.save(),e.beginPath(),e.rect(0,0,o,s),e.clip(),e.drawImage(this.canvases.original,0,0),e.restore(),e.save(),e.beginPath(),e.rect(o,0,i-o,s),e.clip(),e.drawImage(this.canvases.preview,0,0),e.restore(),e.strokeStyle="#ffffff",e.lineWidth=2,e.beginPath(),e.moveTo(o,0),e.lineTo(o,s),e.stroke()}}function zt(n,e,t){const i=n.slice();return i[13]=e[t],i[15]=t,i}function nt(n){let e,t,i,s,o='<span class="text-glow svelte-gckxq3">Enchanting your character...</span>',a=Ae(Array(8)),d=[];for(let h=0;h<a.length;h+=1)d[h]=Dt(zt(n,a,h));return{c(){e=p("div"),t=p("div");for(let h=0;h<d.length;h+=1)d[h].c();i=k(),s=p("div"),s.innerHTML=o,this.h()},l(h){e=w(h,"DIV",{class:!0});var m=D(e);t=w(m,"DIV",{class:!0});var f=D(t);for(let S=0;S<d.length;S+=1)d[S].l(f);f.forEach(E),i=P(m),s=w(m,"DIV",{class:!0,"data-svelte-h":!0}),X(s)!=="svelte-6139yg"&&(s.innerHTML=o),m.forEach(E),this.h()},h(){g(t,"class","magic-particles svelte-gckxq3"),g(s,"class","processing-text svelte-gckxq3"),g(e,"class","processing-overlay svelte-gckxq3")},m(h,m){ce(h,e,m),u(e,t);for(let f=0;f<d.length;f+=1)d[f]&&d[f].m(t,null);u(e,i),u(e,s)},p:Me,d(h){h&&E(e),Ye(d,h)}}}function Dt(n){let e;return{c(){e=p("div"),this.h()},l(t){e=w(t,"DIV",{class:!0}),D(e).forEach(E),this.h()},h(){g(e,"class","particle particle-"+n[15]+" svelte-gckxq3")},m(t,i){ce(t,e,i)},p:Me,d(t){t&&E(e)}}}function Rt(n){let e,t,i,s=n[0]&&nt(n);return{c(){e=p("div"),t=p("div"),i=k(),s&&s.c(),this.h()},l(o){e=w(o,"DIV",{class:!0});var a=D(e);t=w(a,"DIV",{class:!0,style:!0}),D(t).forEach(E),i=P(a),s&&s.l(a),a.forEach(E),this.h()},h(){g(t,"class","scanline svelte-gckxq3"),Te(t,"--scanline-color",n[1]),Te(t,"--glow-intensity",n[2]),g(e,"class","scanline-container svelte-gckxq3"),F(e,"active",n[0])},m(o,a){ce(o,e,a),u(e,t),n[7](t),u(e,i),s&&s.m(e,null),n[8](e)},p(o,[a]){a&2&&Te(t,"--scanline-color",o[1]),a&4&&Te(t,"--glow-intensity",o[2]),o[0]?s?s.p(o,a):(s=nt(o),s.c(),s.m(e,null)):s&&(s.d(1),s=null),a&1&&F(e,"active",o[0])},i:Me,o:Me,d(o){o&&E(e),n[7](null),s&&s.d(),n[8](null)}}}function kt(n,e,t){let{isActive:i=!1}=e,{duration:s=2e3}=e,{color:o="#3b82f6"}=e,{glowIntensity:a=.8}=e;const d=Ke();let h,m,f=!1;function S(){!h||!m||f||(t(6,f=!0),d("started"),t(3,h.style.transform="translateY(-100%)",h),t(3,h.style.opacity="1",h),h.animate([{transform:"translateY(-100%)",opacity:"1",filter:`drop-shadow(0 0 ${a*10}px ${o})`},{transform:"translateY(100vh)",opacity:"0.8",filter:`drop-shadow(0 0 ${a*15}px ${o})`},{transform:"translateY(100vh)",opacity:"0",filter:`drop-shadow(0 0 ${a*5}px ${o})`}],{duration:s,easing:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fill:"forwards"}).addEventListener("finish",()=>{t(6,f=!1),d("completed")}),console.log("‚ú® Scanline animation started"))}function I(){t(6,f=!1),h&&t(3,h.style.opacity="0",h),d("stopped")}gt(()=>()=>{I()});function T(_){ge[_?"unshift":"push"](()=>{h=_,t(3,h)})}function y(_){ge[_?"unshift":"push"](()=>{m=_,t(4,m)})}return n.$$set=_=>{"isActive"in _&&t(0,i=_.isActive),"duration"in _&&t(5,s=_.duration),"color"in _&&t(1,o=_.color),"glowIntensity"in _&&t(2,a=_.glowIntensity)},n.$$.update=()=>{n.$$.dirty&65&&i&&!f&&S()},[i,o,a,h,m,s,f,T,y]}class Pt extends Ge{constructor(e){super(),Je(this,e,kt,Rt,Ze,{isActive:0,duration:5,color:1,glowIntensity:2})}}function at(n){let e,t='<div class="loading-spinner svelte-vjoj0w"></div> <p class="svelte-vjoj0w">Initializing canvas...</p>';return{c(){e=p("div"),e.innerHTML=t,this.h()},l(i){e=w(i,"DIV",{class:!0,"data-svelte-h":!0}),X(e)!=="svelte-ldzg62"&&(e.innerHTML=t),this.h()},h(){g(e,"class","loading-overlay svelte-vjoj0w")},m(i,s){ce(i,e,s)},d(i){i&&E(e)}}}function ot(n){let e,t='<div class="processing-spinner svelte-vjoj0w"></div> <p class="svelte-vjoj0w">Processing...</p>';return{c(){e=p("div"),e.innerHTML=t,this.h()},l(i){e=w(i,"DIV",{class:!0,"data-svelte-h":!0}),X(e)!=="svelte-v9alwg"&&(e.innerHTML=t),this.h()},h(){g(e,"class","processing-overlay svelte-vjoj0w")},m(i,s){ce(i,e,s)},d(i){i&&E(e)}}}function At(n){let e,t,i,s,o,a,d,h,m,f,S,I,T,y,_,x=!n[7]&&!n[0]&&at(),v=n[0]&&ot();return y=new Pt({props:{isActive:n[9],duration:2e3}}),y.$on("started",n[32]),y.$on("completed",n[33]),{c(){e=p("div"),t=p("canvas"),i=k(),s=p("canvas"),o=k(),a=p("canvas"),d=k(),h=p("canvas"),m=k(),f=p("canvas"),S=k(),x&&x.c(),I=k(),v&&v.c(),T=k(),Ct(y.$$.fragment),this.h()},l(C){e=w(C,"DIV",{class:!0});var l=D(e);t=w(l,"CANVAS",{class:!0,"aria-hidden":!0}),D(t).forEach(E),i=P(l),s=w(l,"CANVAS",{class:!0,"aria-hidden":!0}),D(s).forEach(E),o=P(l),a=w(l,"CANVAS",{class:!0,"aria-hidden":!0}),D(a).forEach(E),d=P(l),h=w(l,"CANVAS",{class:!0,"aria-hidden":!0}),D(h).forEach(E),m=P(l),f=w(l,"CANVAS",{class:!0,style:!0}),D(f).forEach(E),S=P(l),x&&x.l(l),I=P(l),v&&v.l(l),T=P(l),_t(y.$$.fragment,l),l.forEach(E),this.h()},h(){g(t,"class","canvas-layer canvas-hidden svelte-vjoj0w"),g(t,"aria-hidden","true"),g(s,"class","canvas-layer canvas-hidden svelte-vjoj0w"),g(s,"aria-hidden","true"),g(a,"class","canvas-layer canvas-hidden svelte-vjoj0w"),g(a,"aria-hidden","true"),g(h,"class","canvas-layer canvas-hidden svelte-vjoj0w"),g(h,"aria-hidden","true"),g(f,"class","canvas-layer canvas-interactive svelte-vjoj0w"),Te(f,"cursor",n[8]?"none":"crosshair"),F(f,"drawing",n[8]),g(e,"class","canvas-container svelte-vjoj0w"),F(e,"initialized",n[7]),F(e,"processing",n[0])},m(C,l){ce(C,e,l),u(e,t),n[27](t),u(e,i),u(e,s),n[28](s),u(e,o),u(e,a),n[29](a),u(e,d),u(e,h),n[30](h),u(e,m),u(e,f),n[31](f),u(e,S),x&&x.m(e,null),u(e,I),v&&v.m(e,null),u(e,T),bt(y,e,null),n[34](e),_=!0},p(C,l){(!_||l[0]&256)&&Te(f,"cursor",C[8]?"none":"crosshair"),(!_||l[0]&256)&&F(f,"drawing",C[8]),!C[7]&&!C[0]?x||(x=at(),x.c(),x.m(e,I)):x&&(x.d(1),x=null),C[0]?v||(v=ot(),v.c(),v.m(e,T)):v&&(v.d(1),v=null);const r={};l[0]&512&&(r.isActive=C[9]),y.$set(r),(!_||l[0]&128)&&F(e,"initialized",C[7]),(!_||l[0]&1)&&F(e,"processing",C[0])},i(C){_||(St(y.$$.fragment,C),_=!0)},o(C){Et(y.$$.fragment,C),_=!1},d(C){C&&E(e),n[27](null),n[28](null),n[29](null),n[30](null),n[31](null),x&&x.d(),v&&v.d(),xt(y),n[34](null)}}}function Ht(n,e,t){let{originalImage:i}=e,{processedImage:s}=e,{isProcessing:o=!1}=e,{currentTool:a="restore"}=e,{brushSize:d=20}=e,{showComparison:h=!1}=e,{showOriginal:m=!1}=e,{toolboxWidth:f=0}=e;const S=Ke();let I,T,y,_,x,v,C=null,l=null,r=null,K=!1,W=!1,Y=0,j=0,G=0,ze=0,ve=!1,se;gt(async()=>{try{await J(),$(),console.log("‚úÖ RefineCanvas mounted and initialized")}catch(c){console.error("‚ùå RefineCanvas initialization failed:",c),S("error",{message:"Failed to initialize canvas"})}}),mt(()=>{Re()});async function J(){if(!i||!s)throw new Error("Missing image data");Z();const c={original:T,processed:y,mask:_,preview:x};t(24,C=new It(c)),await C.initialize(i,s),t(25,l=new Tt(C)),l.setTool(a),l.setBrushSize(d),t(26,r=new Mt(I)),r.initialize({original:T,processed:y,preview:x,display:v}),r.setViewport(Y,j),r.fitToViewport({toolboxWidth:f}),setTimeout(()=>{console.log("üé¨ Starting initial render sequence..."),r==null||r.render({showOriginal:!1,showComparison:!1}),setTimeout(()=>{if(r&&v){const R=v.getContext("2d"),H=Math.floor(Y/2)-25,A=Math.floor(j/2)-25,U=R==null?void 0:R.getImageData(H,A,50,50);let re=!1;if(U){for(let fe=3;fe<U.data.length;fe+=4)if(U.data[fe]>0){re=!0;break}}re?console.log("‚úÖ Display canvas has content in center area"):(console.log("üö® Center area empty, using emergency render..."),r.forceRenderProcessed())}},100)},100),t(7,K=!0),t(9,ve=!0),setTimeout(()=>{var R;t(9,ve=!1),(R=l==null?void 0:l.saveInitialState)==null||R.call(l),S("historyChanged",l==null?void 0:l.getHistoryState())},2500),S("initialized")}function $(){v&&(v.addEventListener("mousedown",ye),v.addEventListener("mousemove",ee),v.addEventListener("mouseup",he),v.addEventListener("mouseleave",he),v.addEventListener("touchstart",Ce,{passive:!1}),v.addEventListener("touchmove",_e,{passive:!1}),v.addEventListener("touchend",B,{passive:!1}),v.addEventListener("contextmenu",c=>c.preventDefault()),window.addEventListener("resize",be))}function ye(c){if(!l||!r)return;c.preventDefault(),t(8,W=!0);const R=te.getCanvasCoordinates(c,v),A={type:"down",point:r.screenToImage(R.x,R.y),pointerType:"mouse"};l.handlePointerDown(A),r==null||r.render()}function ee(c){if(!W||!l||!r)return;c.preventDefault();const R=te.getCanvasCoordinates(c,v),A={type:"move",point:r.screenToImage(R.x,R.y),pointerType:"mouse"};l.handlePointerMove(A),r==null||r.render()}function he(c){if(!W||!l)return;t(8,W=!1);const R=te.getCanvasCoordinates(c,v),A={type:"up",point:(r==null?void 0:r.screenToImage(R.x,R.y))||R,pointerType:"mouse"};l.handlePointerUp(A)}function Ce(c){if(!l||!r||c.touches.length!==1)return;te.preventTouchDefaults(c),t(8,W=!0);const R=c.touches[0],H=te.getCanvasCoordinates(R,v),A=r.screenToImage(H.x,H.y);l.handleTouchEvent({type:"start",point:A,pressure:te.getTouchPressure(R)}),r.render()}function _e(c){if(!W||!l||!r||c.touches.length!==1)return;te.preventTouchDefaults(c);const R=c.touches[0],H=te.getCanvasCoordinates(R,v),A=r.screenToImage(H.x,H.y);l.handleTouchEvent({type:"move",point:A,pressure:te.getTouchPressure(R)}),r.render()}function B(c){!W||!l||(te.preventTouchDefaults(c),t(8,W=!1),l.handleTouchEvent({type:"end",point:{x:0,y:0}}))}function be(){Z(),r&&(r.setViewport(Y,j),r.refreshDisplayContext(),r.fitToViewport({toolboxWidth:f}),r.render(),console.log("üîÑ Window resized, refitted viewport:",{containerWidth:Y,containerHeight:j,toolboxWidth:f}),setTimeout(()=>{if(v&&r){const c=v.getContext("2d"),R=Math.floor(Y/2)-25,H=Math.floor(j/2)-25,A=c==null?void 0:c.getImageData(Math.max(0,R),Math.max(0,H),50,50);let U=!1;if(A){for(let re=3;re<A.data.length;re+=4)if(A.data[re]>0){U=!0;break}}U?console.log("‚úÖ Image visible after resize"):(console.log("üö® Image disappeared after resize, using emergency render..."),r.forceRenderProcessed())}},200))}function Z(){clearTimeout(se),se=setTimeout(()=>{if(!I)return;const c=I.getBoundingClientRect(),R=Math.max(c.width||800,400),H=Math.max(c.height||600,300);if(R!==G||H!==ze){G=R,ze=H,Y=R,j=H;const A=I.parentElement;A&&(A.getBoundingClientRect(),window.getComputedStyle(A).display==="grid"&&console.log("üîç Grid layout detected, using actual container bounds")),console.log("üìè Container dimensions updated:",{containerWidth:Y,containerHeight:j,toolboxWidth:f,rect:{width:c.width,height:c.height},actualSpace:`${c.width}x${c.height}`}),v&&r&&(t(6,v.style.maxWidth="100%",v),t(6,v.style.maxHeight="100%",v),t(6,v.style.objectFit="contain",v),r.setViewport(R,H))}},50)}function ie(){return(C==null?void 0:C.exportPreview())||null}function He(){return(r==null?void 0:r.exportProcessedImage())||null}function De(c){r==null||r.setViewMode(c)}function Q(){const c=(l==null?void 0:l.undo())||!1;return c&&(r==null||r.render(),S("historyChanged",l==null?void 0:l.getHistoryState())),c}function q(){const c=(l==null?void 0:l.redo())||!1;return c&&(r==null||r.render(),S("historyChanged",l==null?void 0:l.getHistoryState())),c}function ne(){return(l==null?void 0:l.getHistoryState())||{canUndo:!1,canRedo:!1}}function Ve(){C==null||C.updatePreview(),l==null||l.clearHistory(),r==null||r.render()}function Re(){r==null||r.destroy(),l==null||l.clearHistory(),v&&(v.removeEventListener("mousedown",ye),v.removeEventListener("mousemove",ee),v.removeEventListener("mouseup",he),v.removeEventListener("touchstart",Ce),v.removeEventListener("touchmove",_e),v.removeEventListener("touchend",B)),window.removeEventListener("resize",be),console.log("üßπ RefineCanvas cleaned up")}function ae(c){ge[c?"unshift":"push"](()=>{T=c,t(2,T)})}function Fe(c){ge[c?"unshift":"push"](()=>{y=c,t(3,y)})}function Se(c){ge[c?"unshift":"push"](()=>{_=c,t(4,_)})}function ke(c){ge[c?"unshift":"push"](()=>{x=c,t(5,x)})}function O(c){ge[c?"unshift":"push"](()=>{v=c,t(6,v)})}const oe=()=>console.log("‚ú® Magic scanline started"),We=()=>console.log("‚ú® Magic scanline completed");function Pe(c){ge[c?"unshift":"push"](()=>{I=c,t(1,I)})}return n.$$set=c=>{"originalImage"in c&&t(10,i=c.originalImage),"processedImage"in c&&t(11,s=c.processedImage),"isProcessing"in c&&t(0,o=c.isProcessing),"currentTool"in c&&t(12,a=c.currentTool),"brushSize"in c&&t(13,d=c.brushSize),"showComparison"in c&&t(14,h=c.showComparison),"showOriginal"in c&&t(15,m=c.showOriginal),"toolboxWidth"in c&&t(16,f=c.toolboxWidth)},n.$$.update=()=>{n.$$.dirty[0]&50335744&&C&&l&&a&&l.setTool(a),n.$$.dirty[0]&50339840&&C&&l&&d&&l.setBrushSize(d),n.$$.dirty[0]&67158016&&r&&(h||m)&&r.render({showComparison:h,showOriginal:m})},[o,I,T,y,_,x,v,K,W,ve,i,s,a,d,h,m,f,ie,He,De,Q,q,ne,Ve,C,l,r,ae,Fe,Se,ke,O,oe,We,Pe]}class jt extends Ge{constructor(e){super(),Je(this,e,Ht,At,Ze,{originalImage:10,processedImage:11,isProcessing:0,currentTool:12,brushSize:13,showComparison:14,showOriginal:15,toolboxWidth:16,exportCanvas:17,exportProcessedImage:18,setViewMode:19,undo:20,redo:21,getHistoryState:22,reset:23},null,[-1,-1])}get exportCanvas(){return this.$$.ctx[17]}get exportProcessedImage(){return this.$$.ctx[18]}get setViewMode(){return this.$$.ctx[19]}get undo(){return this.$$.ctx[20]}get redo(){return this.$$.ctx[21]}get getHistoryState(){return this.$$.ctx[22]}get reset(){return this.$$.ctx[23]}}function rt(n,e,t){const i=n.slice();return i[17]=e[t],i}function lt(n,e,t){const i=n.slice();return i[17]=e[t],i}function ct(n){let e,t,i=n[17].icon+"",s,o,a,d=n[17].name+"",h,m,f,S;function I(){return n[12](n[17])}return{c(){e=p("button"),t=p("span"),s=pe(i),o=k(),a=p("span"),h=pe(d),m=k(),this.h()},l(T){e=w(T,"BUTTON",{class:!0,title:!0});var y=D(e);t=w(y,"SPAN",{class:!0});var _=D(t);s=we(_,i),_.forEach(E),o=P(y),a=w(y,"SPAN",{class:!0});var x=D(a);h=we(x,d),x.forEach(E),m=P(y),y.forEach(E),this.h()},h(){g(t,"class","tool-icon svelte-1u1n4ys"),g(a,"class","tool-name svelte-1u1n4ys"),g(e,"class","tool-btn svelte-1u1n4ys"),g(e,"title",n[17].description),F(e,"active",n[0]===n[17].id)},m(T,y){ce(T,e,y),u(e,t),u(t,s),u(e,o),u(e,a),u(a,h),u(e,m),f||(S=le(e,"click",I),f=!0)},p(T,y){n=T,y&33&&F(e,"active",n[0]===n[17].id)},d(T){T&&E(e),f=!1,S()}}}function ht(n){let e,t,i=n[17].icon+"",s,o,a,d=n[17].name+"",h,m,f,S;function I(){return n[13](n[17])}return{c(){e=p("button"),t=p("span"),s=pe(i),o=k(),a=p("span"),h=pe(d),m=k(),this.h()},l(T){e=w(T,"BUTTON",{class:!0,title:!0});var y=D(e);t=w(y,"SPAN",{class:!0});var _=D(t);s=we(_,i),_.forEach(E),o=P(y),a=w(y,"SPAN",{class:!0});var x=D(a);h=we(x,d),x.forEach(E),m=P(y),y.forEach(E),this.h()},h(){g(t,"class","tool-icon svelte-1u1n4ys"),g(a,"class","tool-name svelte-1u1n4ys"),g(e,"class","tool-btn svelte-1u1n4ys"),g(e,"title",n[17].description),F(e,"active",n[0]===n[17].id)},m(T,y){ce(T,e,y),u(e,t),u(t,s),u(e,o),u(e,a),u(a,h),u(e,m),f||(S=le(e,"click",I),f=!0)},p(T,y){n=T,y&33&&F(e,"active",n[0]===n[17].id)},d(T){T&&E(e),f=!1,S()}}}function Vt(n){let e,t,i,s="Tools",o,a,d,h="‚ñº",m,f,S,I,T,y="Basic Tools",_,x,v,C,l,r="Smart Tools",K,W,Y,j,G,ze="Brush Settings",ve,se,J,$,ye,ee,he,Ce,_e,B,be,Z,ie,He="Actions",De,Q,q,ne,Ve="‚Ü∂",Re,ae,Fe="Undo",Se,ke,O,oe,We="‚Ü∑",Pe,c,R="Redo",H,A,U,re='<span class="action-icon svelte-1u1n4ys">üîÑ</span> <span class="action-name svelte-1u1n4ys">Reset</span>',fe,$e,Ee=Ae(n[5].filter(dt)),L=[];for(let z=0;z<Ee.length;z+=1)L[z]=ct(lt(n,Ee,z));let xe=Ae(n[5].filter(ut)),N=[];for(let z=0;z<xe.length;z+=1)N[z]=ht(rt(n,xe,z));return{c(){e=p("div"),t=p("div"),i=p("h3"),i.textContent=s,o=k(),a=p("button"),d=p("span"),d.textContent=h,f=k(),S=p("div"),I=p("div"),T=p("h4"),T.textContent=y,_=k(),x=p("div");for(let z=0;z<L.length;z+=1)L[z].c();v=k(),C=p("div"),l=p("h4"),l.textContent=r,K=k(),W=p("div");for(let z=0;z<N.length;z+=1)N[z].c();Y=k(),j=p("div"),G=p("h4"),G.textContent=ze,ve=k(),se=p("div"),J=p("div"),$=p("label"),ye=pe("Size: "),ee=p("span"),he=pe(n[1]),Ce=pe("px"),_e=k(),B=p("input"),be=k(),Z=p("div"),ie=p("h4"),ie.textContent=He,De=k(),Q=p("div"),q=p("button"),ne=p("span"),ne.textContent=Ve,Re=k(),ae=p("span"),ae.textContent=Fe,ke=k(),O=p("button"),oe=p("span"),oe.textContent=We,Pe=k(),c=p("span"),c.textContent=R,A=k(),U=p("button"),U.innerHTML=re,this.h()},l(z){e=w(z,"DIV",{class:!0});var V=D(e);t=w(V,"DIV",{class:!0});var M=D(t);i=w(M,"H3",{class:!0,"data-svelte-h":!0}),X(i)!=="svelte-bbfivw"&&(i.textContent=s),o=P(M),a=w(M,"BUTTON",{class:!0,"aria-label":!0});var de=D(a);d=w(de,"SPAN",{class:!0,"data-svelte-h":!0}),X(d)!=="svelte-bgsbg7"&&(d.textContent=h),de.forEach(E),M.forEach(E),f=P(V),S=w(V,"DIV",{class:!0});var ue=D(S);I=w(ue,"DIV",{class:!0});var Ue=D(I);T=w(Ue,"H4",{class:!0,"data-svelte-h":!0}),X(T)!=="svelte-14f9ahy"&&(T.textContent=y),_=P(Ue),x=w(Ue,"DIV",{class:!0});var et=D(x);for(let me=0;me<L.length;me+=1)L[me].l(et);et.forEach(E),Ue.forEach(E),v=P(ue),C=w(ue,"DIV",{class:!0});var Le=D(C);l=w(Le,"H4",{class:!0,"data-svelte-h":!0}),X(l)!=="svelte-1nfj2e3"&&(l.textContent=r),K=P(Le),W=w(Le,"DIV",{class:!0});var tt=D(W);for(let me=0;me<N.length;me+=1)N[me].l(tt);tt.forEach(E),Le.forEach(E),Y=P(ue),j=w(ue,"DIV",{class:!0});var Ne=D(j);G=w(Ne,"H4",{class:!0,"data-svelte-h":!0}),X(G)!=="svelte-14vt88c"&&(G.textContent=ze),ve=P(Ne),se=w(Ne,"DIV",{class:!0});var st=D(se);J=w(st,"DIV",{class:!0});var je=D(J);$=w(je,"LABEL",{for:!0,class:!0});var Xe=D($);ye=we(Xe,"Size: "),ee=w(Xe,"SPAN",{class:!0});var Qe=D(ee);he=we(Qe,n[1]),Ce=we(Qe,"px"),Qe.forEach(E),Xe.forEach(E),_e=P(je),B=w(je,"INPUT",{id:!0,type:!0,min:!0,max:!0,class:!0}),je.forEach(E),st.forEach(E),Ne.forEach(E),be=P(ue),Z=w(ue,"DIV",{class:!0});var Be=D(Z);ie=w(Be,"H4",{class:!0,"data-svelte-h":!0}),X(ie)!=="svelte-ak7yp4"&&(ie.textContent=He),De=P(Be),Q=w(Be,"DIV",{class:!0});var Ie=D(Q);q=w(Ie,"BUTTON",{class:!0,title:!0});var qe=D(q);ne=w(qe,"SPAN",{class:!0,"data-svelte-h":!0}),X(ne)!=="svelte-ak7o03"&&(ne.textContent=Ve),Re=P(qe),ae=w(qe,"SPAN",{class:!0,"data-svelte-h":!0}),X(ae)!=="svelte-121lki9"&&(ae.textContent=Fe),qe.forEach(E),ke=P(Ie),O=w(Ie,"BUTTON",{class:!0,title:!0});var Oe=D(O);oe=w(Oe,"SPAN",{class:!0,"data-svelte-h":!0}),X(oe)!=="svelte-1d6mu6y"&&(oe.textContent=We),Pe=P(Oe),c=w(Oe,"SPAN",{class:!0,"data-svelte-h":!0}),X(c)!=="svelte-11dsstn"&&(c.textContent=R),Oe.forEach(E),A=P(Ie),U=w(Ie,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),X(U)!=="svelte-1jff83f"&&(U.innerHTML=re),Ie.forEach(E),Be.forEach(E),ue.forEach(E),V.forEach(E),this.h()},h(){g(i,"class","toolbox-title svelte-1u1n4ys"),g(d,"class","collapse-icon svelte-1u1n4ys"),F(d,"rotated",n[2]),g(a,"class","collapse-btn svelte-1u1n4ys"),g(a,"aria-label",m=n[2]?"Expand tools":"Collapse tools"),g(t,"class","toolbox-header svelte-1u1n4ys"),g(T,"class","section-title svelte-1u1n4ys"),g(x,"class","tool-grid svelte-1u1n4ys"),g(I,"class","tool-section svelte-1u1n4ys"),g(l,"class","section-title svelte-1u1n4ys"),g(W,"class","tool-grid svelte-1u1n4ys"),g(C,"class","tool-section svelte-1u1n4ys"),g(G,"class","section-title svelte-1u1n4ys"),g(ee,"class","size-value svelte-1u1n4ys"),g($,"for","brush-size"),g($,"class","control-label svelte-1u1n4ys"),g(B,"id","brush-size"),g(B,"type","range"),g(B,"min","1"),g(B,"max","100"),g(B,"class","brush-slider svelte-1u1n4ys"),g(J,"class","brush-size-control svelte-1u1n4ys"),g(se,"class","brush-controls svelte-1u1n4ys"),g(j,"class","tool-section svelte-1u1n4ys"),g(ie,"class","section-title svelte-1u1n4ys"),g(ne,"class","action-icon svelte-1u1n4ys"),g(ae,"class","action-name svelte-1u1n4ys"),g(q,"class","action-btn svelte-1u1n4ys"),q.disabled=Se=!n[3],g(q,"title","Undo last action"),F(q,"disabled",!n[3]),g(oe,"class","action-icon svelte-1u1n4ys"),g(c,"class","action-name svelte-1u1n4ys"),g(O,"class","action-btn svelte-1u1n4ys"),O.disabled=H=!n[4],g(O,"title","Redo last action"),F(O,"disabled",!n[4]),g(U,"class","action-btn reset-btn svelte-1u1n4ys"),g(U,"title","Reset to original"),g(Q,"class","action-controls svelte-1u1n4ys"),g(Z,"class","tool-section svelte-1u1n4ys"),g(S,"class","toolbox-content svelte-1u1n4ys"),g(e,"class","toolbox svelte-1u1n4ys"),F(e,"collapsed",n[2])},m(z,V){ce(z,e,V),u(e,t),u(t,i),u(t,o),u(t,a),u(a,d),u(e,f),u(e,S),u(S,I),u(I,T),u(I,_),u(I,x);for(let M=0;M<L.length;M+=1)L[M]&&L[M].m(x,null);u(S,v),u(S,C),u(C,l),u(C,K),u(C,W);for(let M=0;M<N.length;M+=1)N[M]&&N[M].m(W,null);u(S,Y),u(S,j),u(j,G),u(j,ve),u(j,se),u(se,J),u(J,$),u($,ye),u($,ee),u(ee,he),u(ee,Ce),u(J,_e),u(J,B),it(B,n[1]),u(S,be),u(S,Z),u(Z,ie),u(Z,De),u(Z,Q),u(Q,q),u(q,ne),u(q,Re),u(q,ae),u(Q,ke),u(Q,O),u(O,oe),u(O,Pe),u(O,c),u(Q,A),u(Q,U),fe||($e=[le(a,"click",n[8]),le(B,"change",n[14]),le(B,"input",n[14]),le(B,"input",n[15]),le(q,"click",n[9]),le(O,"click",n[10]),le(U,"click",n[11])],fe=!0)},p(z,[V]){if(V&4&&F(d,"rotated",z[2]),V&4&&m!==(m=z[2]?"Expand tools":"Collapse tools")&&g(a,"aria-label",m),V&97){Ee=Ae(z[5].filter(dt));let M;for(M=0;M<Ee.length;M+=1){const de=lt(z,Ee,M);L[M]?L[M].p(de,V):(L[M]=ct(de),L[M].c(),L[M].m(x,null))}for(;M<L.length;M+=1)L[M].d(1);L.length=Ee.length}if(V&97){xe=Ae(z[5].filter(ut));let M;for(M=0;M<xe.length;M+=1){const de=rt(z,xe,M);N[M]?N[M].p(de,V):(N[M]=ht(de),N[M].c(),N[M].m(W,null))}for(;M<N.length;M+=1)N[M].d(1);N.length=xe.length}V&2&&pt(he,z[1]),V&2&&it(B,z[1]),V&8&&Se!==(Se=!z[3])&&(q.disabled=Se),V&8&&F(q,"disabled",!z[3]),V&16&&H!==(H=!z[4])&&(O.disabled=H),V&16&&F(O,"disabled",!z[4]),V&4&&F(e,"collapsed",z[2])},i:Me,o:Me,d(z){z&&E(e),Ye(L,z),Ye(N,z),fe=!1,wt($e)}}}const dt=n=>["restore","erase"].includes(n.id),ut=n=>["smart-restore","smart-erase"].includes(n.id);function Ft(n,e,t){let{currentTool:i="restore"}=e,{brushSize:s=20}=e,{canUndo:o=!1}=e,{canRedo:a=!1}=e,{isCollapsed:d=!1}=e;const h=Ke(),m=[{id:"restore",name:"Restore",icon:"üñåÔ∏è",description:"Restore background areas"},{id:"erase",name:"Erase",icon:"üßΩ",description:"Remove unwanted areas"},{id:"smart-restore",name:"Smart Restore",icon:"‚ú®",description:"Intelligent background restoration"},{id:"smart-erase",name:"Smart Erase",icon:"üéØ",description:"Intelligent edge removal"}];function f(r){r!==i&&(t(0,i=r),h("toolChanged",{tool:r}))}function S(r){t(1,s=Math.max(1,Math.min(100,r))),h("brushSizeChanged",{size:s})}function I(){t(2,d=!d),h("collapseToggled",{collapsed:d})}function T(){o&&h("undo")}function y(){a&&h("redo")}function _(){h("reset")}const x=r=>f(r.id),v=r=>f(r.id);function C(){s=yt(this.value),t(1,s)}const l=r=>S(Number(r.target.value));return n.$$set=r=>{"currentTool"in r&&t(0,i=r.currentTool),"brushSize"in r&&t(1,s=r.brushSize),"canUndo"in r&&t(3,o=r.canUndo),"canRedo"in r&&t(4,a=r.canRedo),"isCollapsed"in r&&t(2,d=r.isCollapsed)},[i,s,d,o,a,m,f,S,I,T,y,_,x,v,C,l]}class Bt extends Ge{constructor(e){super(),Je(this,e,Ft,Vt,Ze,{currentTool:0,brushSize:1,canUndo:3,canRedo:4,isCollapsed:2})}}export{jt as R,Bt as a};

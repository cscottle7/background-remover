var wa=Object.defineProperty;var ya=(s,e,t)=>e in s?wa(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var or=(s,e,t)=>(ya(s,typeof e!="symbol"?e+"":e,t),t);import{A as Ge,s as Ps,r as Ea,C as $o,f as h,a as C,g,h as v,c as D,d,j as a,k as ge,D as Il,E as ze,i as Y,w as l,F as se,G as $r,x as Ca,y as Da,z as Ia,H as Jt,I as Sl,J as Er,K as fl,L as Sa,p as Cs,l as L,m as O,n as pe,o as Cr,M as Ce,v as Z,N as De,O as Ma,B as is,P as zo,Q as To,e as cs,R as os,S as Ta,T as ga,U as rl,u as xa}from"../chunks/scheduler.f95f0c95.js";import{S as Rs,i as As,a as $e,t as ht,b as lr,d as nr,m as ar,e as ir,c as Ko,g as Jo}from"../chunks/index.a7b2bf40.js";import{w as el,d as El}from"../chunks/index.711ff95f.js";import{g as Pa}from"../chunks/globals.7f7f1b26.js";import{e as Ds}from"../chunks/each.e59479a4.js";import{a as Kt,b as Ra}from"../chunks/appState.be2a1895.js";const ma=typeof window<"u";let Aa=ma?()=>window.performance.now():()=>Date.now(),va=ma?s=>requestAnimationFrame(s):Ge;const Uo=new Set;function pa(s){Uo.forEach(e=>{e.c(s)||(Uo.delete(e),e.f())}),Uo.size!==0&&va(pa)}function Va(s){let e;return Uo.size===0&&va(pa),{promise:new Promise(t=>{Uo.add(e={c:s,f:t})}),abort(){Uo.delete(e)}}}function Fa(s,e){const t={},r={},o={$$scope:1};let n=s.length;for(;n--;){const i=s[n],u=e[n];if(u){for(const c in i)c in u||(r[c]=1);for(const c in u)o[c]||(t[c]=u[c],o[c]=1);s[n]=u}else for(const c in i)o[c]=1}for(const i in r)i in t||(t[i]=void 0);return t}function Go(s,e,t,r){function o(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function u(m){try{f(r.next(m))}catch(p){i(p)}}function c(m){try{f(r.throw(m))}catch(p){i(p)}}function f(m){m.done?n(m.value):o(m.value).then(u,c)}f((r=r.apply(s,e||[])).next())})}function qo(s,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,o,n,i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(f){return function(m){return c([f,m])}}function c(f){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,f[0]&&(t=0)),t;)try{if(r=1,o&&(n=f[0]&2?o.return:f[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,f[1])).done)return n;switch(o=0,n&&(f=[f[0]&2,n.value]),f[0]){case 0:case 1:n=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,o=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(f[0]===6||f[0]===2)){t=0;continue}if(f[0]===3&&(!n||f[1]>n[0]&&f[1]<n[3])){t.label=f[1];break}if(f[0]===6&&t.label<n[1]){t.label=n[1],n=f;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(f);break}n[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(s,t)}catch(m){f=[6,m],o=0}finally{r=n=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function Ml(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var r=t.call(s),o,n=[],i;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)n.push(o.value)}catch(u){i={error:u}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(i)throw i.error}}return n}function Tl(s,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,n;r<o;r++)(n||!(r in e))&&(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return s.concat(n||Array.prototype.slice.call(e))}var Ba=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function tl(s,e){var t=ja(s);if(typeof t.path!="string"){var r=s.webkitRelativePath;Object.defineProperty(t,"path",{value:typeof e=="string"?e:typeof r=="string"&&r.length>0?r:s.name,writable:!1,configurable:!1,enumerable:!0})}return t}function ja(s){var e=s.name,t=e&&e.lastIndexOf(".")!==-1;if(t&&!s.type){var r=e.split(".").pop().toLowerCase(),o=Ba.get(r);o&&Object.defineProperty(s,"type",{value:o,writable:!1,configurable:!1,enumerable:!0})}return s}var Na=[".DS_Store","Thumbs.db"];function La(s){return Go(this,void 0,void 0,function(){return qo(this,function(e){return ul(s)&&Oa(s.dataTransfer)?[2,Ga(s.dataTransfer,s.type)]:za(s)?[2,Ua(s)]:Array.isArray(s)&&s.every(function(t){return"getFile"in t&&typeof t.getFile=="function"})?[2,Ha(s)]:[2,[]]})})}function Oa(s){return ul(s)}function za(s){return ul(s)&&ul(s.target)}function ul(s){return typeof s=="object"&&s!==null}function Ua(s){return ml(s.target.files).map(function(e){return tl(e)})}function Ha(s){return Go(this,void 0,void 0,function(){var e;return qo(this,function(t){switch(t.label){case 0:return[4,Promise.all(s.map(function(r){return r.getFile()}))];case 1:return e=t.sent(),[2,e.map(function(r){return tl(r)})]}})})}function Ga(s,e){return Go(this,void 0,void 0,function(){var t,r;return qo(this,function(o){switch(o.label){case 0:return s.items?(t=ml(s.items).filter(function(n){return n.kind==="file"}),e!=="drop"?[2,t]:[4,Promise.all(t.map(qa))]):[3,2];case 1:return r=o.sent(),[2,xl(ba(r))];case 2:return[2,xl(ml(s.files).map(function(n){return tl(n)}))]}})})}function xl(s){return s.filter(function(e){return Na.indexOf(e.name)===-1})}function ml(s){if(s===null)return[];for(var e=[],t=0;t<s.length;t++){var r=s[t];e.push(r)}return e}function qa(s){if(typeof s.webkitGetAsEntry!="function")return Pl(s);var e=s.webkitGetAsEntry();return e&&e.isDirectory?_a(e):Pl(s)}function ba(s){return s.reduce(function(e,t){return Tl(Tl([],Ml(e),!1),Ml(Array.isArray(t)?ba(t):[t]),!1)},[])}function Pl(s){var e=s.getAsFile();if(!e)return Promise.reject("".concat(s," is not a File"));var t=tl(e);return Promise.resolve(t)}function Wa(s){return Go(this,void 0,void 0,function(){return qo(this,function(e){return[2,s.isDirectory?_a(s):Ya(s)]})})}function _a(s){var e=s.createReader();return new Promise(function(t,r){var o=[];function n(){var i=this;e.readEntries(function(u){return Go(i,void 0,void 0,function(){var c,f,m;return qo(this,function(p){switch(p.label){case 0:if(u.length)return[3,5];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,Promise.all(o)];case 2:return c=p.sent(),t(c),[3,4];case 3:return f=p.sent(),r(f),[3,4];case 4:return[3,6];case 5:m=Promise.all(u.map(Wa)),o.push(m),n(),p.label=6;case 6:return[2]}})})},function(u){r(u)})}n()})}function Ya(s){return Go(this,void 0,void 0,function(){return qo(this,function(e){return[2,new Promise(function(t,r){s.file(function(o){var n=tl(o,s.fullPath);t(n)},function(o){r(o)})})]})})}function Ka(s,e){if(s&&e){const t=Array.isArray(e)?e:e.split(","),r=s.name||"",o=(s.type||"").toLowerCase(),n=o.replace(/\/.*$/,"");return t.some(i=>{const u=i.trim().toLowerCase();return u.charAt(0)==="."?r.toLowerCase().endsWith(u):u.endsWith("/*")?n===u.replace(/\/.*$/,""):o===u})}return!0}const Ja="file-invalid-type",Xa="file-too-large",Qa="file-too-small",Za="too-many-files",$a=s=>{s=Array.isArray(s)&&s.length===1?s[0]:s;const e=Array.isArray(s)?`one of ${s.join(", ")}`:s;return{code:Ja,message:`File type must be ${e}`}},Rl=s=>({code:Xa,message:`File is larger than ${s} bytes`}),Al=s=>({code:Qa,message:`File is smaller than ${s} bytes`}),ei={code:Za,message:"Too many files"};function ti(s,e){const t=s.type==="application/x-moz-file"||Ka(s,e);return[t,t?null:$a(e)]}function si(s,e,t){if(Xo(s.size))if(Xo(e)&&Xo(t)){if(s.size>t)return[!1,Rl(t)];if(s.size<e)return[!1,Al(e)]}else{if(Xo(e)&&s.size<e)return[!1,Al(e)];if(Xo(t)&&s.size>t)return[!1,Rl(t)]}return[!0,null]}function Xo(s){return s!=null}function Vl(s){return typeof s.isPropagationStopped=="function"?s.isPropagationStopped():typeof s.cancelBubble<"u"?s.cancelBubble:!1}function ol(s){return s.dataTransfer?Array.prototype.some.call(s.dataTransfer.types,e=>e==="Files"||e==="application/x-moz-file"):!!s.target&&!!s.target.files}function ri(s){return s.indexOf("MSIE")!==-1||s.indexOf("Trident/")!==-1}function oi(s){return s.indexOf("Edge/")!==-1}function li(s=window.navigator.userAgent){return ri(s)||oi(s)}function ni(s){let e,t;return{c(){e=h("p"),t=L(s[10])},l(r){e=g(r,"P",{});var o=v(e);t=O(o,s[10]),o.forEach(d)},m(r,o){Y(r,e,o),l(e,t)},p(r,o){o[0]&1024&&pe(t,r[10])},d(r){r&&d(e)}}}function ai(s){let e,t,r,o,n,i,u,c;const f=s[35].default,m=Ea(f,s,s[34],null),p=m||ni(s);let b=[{tabindex:"0"},{role:"button"},{class:n=(s[5]?"":"dropzone")+" "+s[3]},{style:s[4]},s[24]],w={};for(let _=0;_<b.length;_+=1)w=$o(w,b[_]);return{c(){e=h("div"),t=h("input"),o=C(),p&&p.c(),this.h()},l(_){e=g(_,"DIV",{tabindex:!0,role:!0,class:!0,style:!0});var y=v(e);t=g(y,"INPUT",{accept:!0,type:!0,name:!0,autocomplete:!0,tabindex:!0,style:!0}),o=D(y),p&&p.l(y),y.forEach(d),this.h()},h(){var _;a(t,"accept",r=(_=s[1])==null?void 0:_.toString()),t.multiple=s[2],t.required=s[7],a(t,"type","file"),a(t,"name",s[6]),a(t,"autocomplete","off"),a(t,"tabindex","-1"),ge(t,"display","none"),Il(e,w),ze(e,"svelte-817dg2",!0)},m(_,y){Y(_,e,y),l(e,t),s[36](t),l(e,o),p&&p.m(e,null),s[37](e),i=!0,u||(c=[se(window,"focus",s[23]),se(window,"dragover",s[21]),se(window,"drop",s[22]),se(t,"change",s[20]),se(t,"click",ii),se(e,"keydown",function(){$r(s[12](s[13]))&&s[12](s[13]).apply(this,arguments)}),se(e,"focus",function(){$r(s[12](s[14]))&&s[12](s[14]).apply(this,arguments)}),se(e,"blur",function(){$r(s[12](s[15]))&&s[12](s[15]).apply(this,arguments)}),se(e,"click",function(){$r(s[8](s[16]))&&s[8](s[16]).apply(this,arguments)}),se(e,"dragenter",function(){$r(s[11](s[17]))&&s[11](s[17]).apply(this,arguments)}),se(e,"dragover",function(){$r(s[11](s[18]))&&s[11](s[18]).apply(this,arguments)}),se(e,"dragleave",function(){$r(s[11](s[19]))&&s[11](s[19]).apply(this,arguments)}),se(e,"drop",function(){$r(s[11](s[20]))&&s[11](s[20]).apply(this,arguments)})],u=!0)},p(_,y){var V;s=_,(!i||y[0]&2&&r!==(r=(V=s[1])==null?void 0:V.toString()))&&a(t,"accept",r),(!i||y[0]&4)&&(t.multiple=s[2]),(!i||y[0]&128)&&(t.required=s[7]),(!i||y[0]&64)&&a(t,"name",s[6]),m?m.p&&(!i||y[1]&8)&&Ca(m,f,s,s[34],i?Ia(f,s[34],y,null):Da(s[34]),null):p&&p.p&&(!i||y[0]&1024)&&p.p(s,i?y:[-1,-1]),Il(e,w=Fa(b,[{tabindex:"0"},{role:"button"},(!i||y[0]&40&&n!==(n=(s[5]?"":"dropzone")+" "+s[3]))&&{class:n},(!i||y[0]&16)&&{style:s[4]},y[0]&16777216&&s[24]])),ze(e,"svelte-817dg2",!0)},i(_){i||($e(p,_),i=!0)},o(_){ht(p,_),i=!1},d(_){_&&d(e),s[36](null),p&&p.d(_),s[37](null),u=!1,Jt(c)}}}function ii(s){s.stopPropagation()}function ci(s,e,t){let r,o,n,i;const u=["accept","disabled","getFilesFromEvent","maxSize","minSize","multiple","preventDropOnDocument","noClick","noKeyboard","noDrag","noDragEventsBubbling","containerClasses","containerStyles","disableDefaultStyles","name","inputElement","required"];let c=Sl(e,u),{$$slots:f={},$$scope:m}=e,{accept:p=void 0}=e,{disabled:b=!1}=e,{getFilesFromEvent:w=La}=e,{maxSize:_=1/0}=e,{minSize:y=0}=e,{multiple:V=!0}=e,{preventDropOnDocument:S=!0}=e,{noClick:k=!1}=e,{noKeyboard:M=!1}=e,{noDrag:A=!1}=e,{noDragEventsBubbling:x=!1}=e,{containerClasses:R=""}=e,{containerStyles:I=""}=e,{disableDefaultStyles:U=!1}=e,{name:B=""}=e,{inputElement:T=void 0}=e,{required:j=!1}=e;const G=Er();let z={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]},H;function E(){z.isFileDialogActive=!1,z.isDragActive=!1,z.draggedFiles=[],z.acceptedFiles=[],z.fileRejections=[]}function F(){T&&(t(0,T.value=null,T),z.isFileDialogActive=!0,T.click())}function P(J){!H||!H.isEqualNode(J.target)||(J.keyCode===32||J.keyCode===13)&&(J.preventDefault(),F())}function N(){z.isFocused=!0}function K(){z.isFocused=!1}function q(){k||(li()?setTimeout(F,0):F())}function X(J){J.preventDefault(),ee(J),ne=[...ne,J.target],ol(J)&&Promise.resolve(w(J)).then(Ae=>{Vl(J)&&!x||(z.draggedFiles=Ae,z.isDragActive=!0,G("dragenter",{dragEvent:J}))})}function re(J){if(J.preventDefault(),ee(J),J.dataTransfer)try{J.dataTransfer.dropEffect="copy"}catch{}return ol(J)&&G("dragover",{dragEvent:J}),!1}function Q(J){J.preventDefault(),ee(J);const Ae=ne.filter(ce=>H&&H.contains(ce)),_e=Ae.indexOf(J.target);_e!==-1&&Ae.splice(_e,1),ne=Ae,!(Ae.length>0)&&(z.isDragActive=!1,z.draggedFiles=[],ol(J)&&G("dragleave",{dragEvent:J}))}function te(J){J.preventDefault(),ee(J),ne=[],ol(J)&&(G("filedropped",{event:J}),Promise.resolve(w(J)).then(Ae=>{if(Vl(J)&&!x)return;const _e=[],ce=[];Ae.forEach(de=>{const[ue,ye]=ti(de,p),[Re,Qe]=si(de,y,_);if(ue&&Re)_e.push(de);else{const Ue=[ye,Qe].filter(Te=>Te);ce.push({file:de,errors:Ue})}}),!V&&_e.length>1&&(_e.forEach(de=>{ce.push({file:de,errors:[ei]})}),_e.splice(0)),J.dataTransfer&&t(0,T.files=J.dataTransfer.files,T),z.acceptedFiles=_e,z.fileRejections=ce,G("drop",{acceptedFiles:_e,fileRejections:ce,event:J}),ce.length>0&&G("droprejected",{fileRejections:ce,event:J}),_e.length>0&&G("dropaccepted",{acceptedFiles:_e,event:J})})),E()}function ee(J){x&&J.stopPropagation()}function oe(J){S&&J.preventDefault()}let ne=[];function ke(J){S&&(H&&H.contains(J.target)||(J.preventDefault(),ne=[]))}function ae(){z.isFileDialogActive&&setTimeout(()=>{if(T){const{files:J}=T;J.length||(z.isFileDialogActive=!1,G("filedialogcancel"))}},300)}fl(()=>{t(0,T=null)});function be(J){Cs[J?"unshift":"push"](()=>{T=J,t(0,T)})}function Ie(J){Cs[J?"unshift":"push"](()=>{H=J,t(9,H)})}return s.$$set=J=>{e=$o($o({},e),Sa(J)),t(24,c=Sl(e,u)),"accept"in J&&t(1,p=J.accept),"disabled"in J&&t(25,b=J.disabled),"getFilesFromEvent"in J&&t(26,w=J.getFilesFromEvent),"maxSize"in J&&t(27,_=J.maxSize),"minSize"in J&&t(28,y=J.minSize),"multiple"in J&&t(2,V=J.multiple),"preventDropOnDocument"in J&&t(29,S=J.preventDropOnDocument),"noClick"in J&&t(30,k=J.noClick),"noKeyboard"in J&&t(31,M=J.noKeyboard),"noDrag"in J&&t(32,A=J.noDrag),"noDragEventsBubbling"in J&&t(33,x=J.noDragEventsBubbling),"containerClasses"in J&&t(3,R=J.containerClasses),"containerStyles"in J&&t(4,I=J.containerStyles),"disableDefaultStyles"in J&&t(5,U=J.disableDefaultStyles),"name"in J&&t(6,B=J.name),"inputElement"in J&&t(0,T=J.inputElement),"required"in J&&t(7,j=J.required),"$$scope"in J&&t(34,m=J.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&33554432&&t(8,r=J=>b?null:J),s.$$.dirty[0]&256|s.$$.dirty[1]&1&&t(12,o=J=>M?null:r(J)),s.$$.dirty[0]&256|s.$$.dirty[1]&2&&t(11,n=J=>A?null:r(J)),s.$$.dirty[0]&4&&t(10,i=V?"Drag 'n' drop some files here, or click to select files":"Drag 'n' drop a file here, or click to select a file")},[T,p,V,R,I,U,B,j,r,H,i,n,o,P,N,K,q,X,re,Q,te,oe,ke,ae,c,b,w,_,y,S,k,M,A,x,m,f,be,Ie]}class ui extends Rs{constructor(e){super(),As(this,e,ci,ai,Ps,{accept:1,disabled:25,getFilesFromEvent:26,maxSize:27,minSize:28,multiple:2,preventDropOnDocument:29,noClick:30,noKeyboard:31,noDrag:32,noDragEventsBubbling:33,containerClasses:3,containerStyles:4,disableDefaultStyles:5,name:6,inputElement:0,required:7},null,[-1,-1])}}const Fl=10*1024*1024,ll=4096,nl=32,di=new Set(["image/jpeg","image/jpg","image/png","image/webp","image/bmp","image/tiff"]);async function fi(s){const e=[],t=[];try{s.size>Fl&&e.push(`File size (${Bl(s.size)}) exceeds maximum allowed size of ${Bl(Fl)}`),di.has(s.type.toLowerCase())||e.push(`Unsupported file type: ${s.type}. Supported formats: JPEG, PNG, WebP, BMP, TIFF`);const r=await gi(s);if(!r.valid)return e.push("Invalid or corrupted image file"),{isValid:!1,error:e.join(". ")};const{width:o,height:n}=r;(o<nl||n<nl)&&e.push(`Image dimensions (${o}Ã—${n}) are too small. Minimum: ${nl}Ã—${nl}px`),(o>ll||n>ll)&&e.push(`Image dimensions (${o}Ã—${n}) are too large. Maximum: ${ll}Ã—${ll}px`),o*n>2048*2048&&t.push("Large images may take longer to process");const u=o/n;return(u>10||u<.1)&&t.push("Unusual aspect ratio may affect processing quality"),await pi(s)&&t.push("Animated images will be processed as static images"),{isValid:e.length===0,error:e.length>0?e.join(". "):void 0,warnings:t.length>0?t:void 0}}catch(r){return{isValid:!1,error:`Validation failed: ${r instanceof Error?r.message:"Unknown error"}`}}}async function hi(s){const e=await vi(s),t=await mi(s);return{file:s,preview:e,size:s.size,dimensions:t,format:s.type}}function gi(s){return new Promise(e=>{const t=new Image;t.onload=()=>{e({valid:!0,width:t.naturalWidth,height:t.naturalHeight})},t.onerror=()=>{e({valid:!1,width:0,height:0})},t.src=URL.createObjectURL(s)})}function mi(s){return new Promise((e,t)=>{const r=new Image;r.onload=()=>{e({width:r.naturalWidth,height:r.naturalHeight}),URL.revokeObjectURL(r.src)},r.onerror=()=>{t(new Error("Failed to load image")),URL.revokeObjectURL(r.src)},r.src=URL.createObjectURL(s)})}function vi(s){return new Promise((e,t)=>{const r=new FileReader;r.onload=o=>{var n;e((n=o.target)==null?void 0:n.result)},r.onerror=()=>{t(new Error("Failed to create image preview"))},r.readAsDataURL(s)})}async function pi(s){try{if(s.type==="image/gif"){const e=await s.arrayBuffer(),t=new Uint8Array(e);let r=0;for(let o=0;o<t.length-1;o++)if(t[o]===33&&t[o+1]===249&&(r++,r>1))return!0}return!1}catch{return!1}}function Bl(s){const e=["B","KB","MB","GB"];let t=s,r=0;for(;t>=1024&&r<e.length-1;)t/=1024,r++;return`${t.toFixed(1)} ${e[r]}`}function bi(s){const e=s.size>5242880,t=s.type==="image/jpeg";return{shouldCompress:e&&t,quality:e?.8:.9}}async function _i(s){const e=bi(s);if(!e.shouldCompress)return s;try{const t=document.createElement("canvas"),r=t.getContext("2d"),o=new Image;return new Promise((n,i)=>{o.onload=()=>{t.width=o.naturalWidth,t.height=o.naturalHeight,r==null||r.drawImage(o,0,0),t.toBlob(u=>{if(u){const c=new File([u],s.name,{type:"image/jpeg",lastModified:Date.now()});n(c)}else n(s)},"image/jpeg",e.quality)},o.onerror=()=>n(s),o.src=URL.createObjectURL(s)})}catch{return s}}function jl(s){let e,t,r,o,n,i;return{c(){e=h("button"),t=Ce("svg"),r=Ce("path"),o=L(`\r
              Paste`),this.h()},l(u){e=g(u,"BUTTON",{class:!0});var c=v(e);t=De(c,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var f=v(t);r=De(f,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(r).forEach(d),f.forEach(d),o=O(c,`\r
              Paste`),c.forEach(d),this.h()},h(){a(r,"stroke-linecap","round"),a(r,"stroke-linejoin","round"),a(r,"stroke-width","2"),a(r,"d","M9 5H7a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"),a(t,"class","w-5 h-5 mr-2"),a(t,"fill","none"),a(t,"stroke","currentColor"),a(t,"viewBox","0 0 24 24"),a(e,"class","btn btn-outline border-magic-400 text-magic-400 hover:bg-magic-400 hover:text-white flex-1 py-3 px-6 rounded-lg font-medium transition-all duration-200"),e.disabled=s[0]},m(u,c){Y(u,e,c),l(e,t),l(t,r),l(e,o),n||(i=se(e,"click",s[12]),n=!0)},p(u,c){c&1&&(e.disabled=u[0])},d(u){u&&d(e),n=!1,i()}}}function Nl(s){let e;return{c(){e=L(", or paste it in")},l(t){e=O(t,", or paste it in")},m(t,r){Y(t,e,r)},d(t){t&&d(e)}}}function Ll(s){let e,t='<div class="text-center"><div class="w-16 h-16 mx-auto mb-4 rounded-full bg-magic-400/20 flex items-center justify-center"><svg class="w-8 h-8 text-magic-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg></div> <p class="text-xl font-semibold text-magic-400">Drop to process</p> <p class="text-magic-300">Release to start the magic</p></div>';return{c(){e=h("div"),e.innerHTML=t,this.h()},l(r){e=g(r,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-1rgb4wq"&&(e.innerHTML=t),this.h()},h(){a(e,"class","absolute inset-0 bg-magic-400/20 border-2 border-magic-400 rounded-lg flex items-center justify-center z-20")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function ki(s){let e,t,r,o,n,i='<svg class="w-12 h-12 text-magic-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>',u,c,f='<h2 class="text-2xl font-semibold text-magic-gradient mb-2">Place Character Here</h2> <p class="text-dark-text-secondary text-lg">Watch backgrounds disappear like magic</p>',m,p,b,w,_,y,V,S,k,M,A,x,R,I="Supports JPEG, PNG, WebP â€¢ Max 10MB â€¢ Up to 4K resolution",U,B,T,j,G=s[4]&&jl(s),z=s[4]&&s[1]&&Nl(),H=s[3]&&Ll();return{c(){e=h("div"),t=h("div"),r=C(),o=h("div"),n=h("div"),n.innerHTML=i,u=C(),c=h("div"),c.innerHTML=f,m=C(),p=h("div"),b=h("button"),w=Ce("svg"),_=Ce("path"),y=L(`\r
            Choose Image`),V=C(),G&&G.c(),S=C(),k=h("div"),M=h("p"),A=L("Drag & drop, choose file"),z&&z.c(),x=C(),R=h("p"),R.textContent=I,U=C(),H&&H.c(),this.h()},l(E){e=g(E,"DIV",{class:!0});var F=v(e);t=g(F,"DIV",{class:!0}),v(t).forEach(d),r=D(F),o=g(F,"DIV",{class:!0});var P=v(o);n=g(P,"DIV",{class:!0,"data-svelte-h":!0}),Z(n)!=="svelte-zpjsso"&&(n.innerHTML=i),u=D(P),c=g(P,"DIV",{class:!0,"data-svelte-h":!0}),Z(c)!=="svelte-1noa2ng"&&(c.innerHTML=f),m=D(P),p=g(P,"DIV",{class:!0});var N=v(p);b=g(N,"BUTTON",{class:!0});var K=v(b);w=De(K,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var q=v(w);_=De(q,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(_).forEach(d),q.forEach(d),y=O(K,`\r
            Choose Image`),K.forEach(d),V=D(N),G&&G.l(N),N.forEach(d),S=D(P),k=g(P,"DIV",{class:!0});var X=v(k);M=g(X,"P",{});var re=v(M);A=O(re,"Drag & drop, choose file"),z&&z.l(re),re.forEach(d),x=D(X),R=g(X,"P",{class:!0,"data-svelte-h":!0}),Z(R)!=="svelte-oom6db"&&(R.textContent=I),X.forEach(d),P.forEach(d),U=D(F),H&&H.l(F),F.forEach(d),this.h()},h(){a(t,"class","character-guide absolute inset-0 pointer-events-none opacity-20 svelte-1yokvc6"),a(n,"class","w-24 h-24 rounded-full bg-magic-400/10 flex items-center justify-center"),a(c,"class","text-center"),a(_,"stroke-linecap","round"),a(_,"stroke-linejoin","round"),a(_,"stroke-width","2"),a(_,"d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"),a(w,"class","w-5 h-5 mr-2"),a(w,"fill","none"),a(w,"stroke","currentColor"),a(w,"viewBox","0 0 24 24"),a(b,"class","btn btn-magic flex-1 py-3 px-6 rounded-lg font-medium transition-all duration-200"),b.disabled=s[0],a(p,"class","flex flex-col sm:flex-row gap-4 w-full max-w-md"),a(R,"class","opacity-75"),a(k,"class","text-center text-sm text-dark-text-muted space-y-1"),a(o,"class","flex flex-col items-center justify-center space-y-6 relative z-10"),a(e,"class",B="dropzone "+(s[3]?"dropzone-active":"")+" "+(s[0]?"opacity-50 cursor-not-allowed":"cursor-pointer")+" svelte-1yokvc6"),ze(e,"animate-pulse-glow",s[3])},m(E,F){Y(E,e,F),l(e,t),l(e,r),l(e,o),l(o,n),l(o,u),l(o,c),l(o,m),l(o,p),l(p,b),l(b,w),l(w,_),l(b,y),l(p,V),G&&G.m(p,null),l(o,S),l(o,k),l(k,M),l(M,A),z&&z.m(M,null),l(k,x),l(k,R),l(e,U),H&&H.m(e,null),T||(j=se(b,"click",s[10]),T=!0)},p(E,F){F&1&&(b.disabled=E[0]),E[4]?G?G.p(E,F):(G=jl(E),G.c(),G.m(p,null)):G&&(G.d(1),G=null),E[4]&&E[1]?z||(z=Nl(),z.c(),z.m(M,null)):z&&(z.d(1),z=null),E[3]?H||(H=Ll(),H.c(),H.m(e,null)):H&&(H.d(1),H=null),F&9&&B!==(B="dropzone "+(E[3]?"dropzone-active":"")+" "+(E[0]?"opacity-50 cursor-not-allowed":"cursor-pointer")+" svelte-1yokvc6")&&a(e,"class",B),F&9&&ze(e,"animate-pulse-glow",E[3])},d(E){E&&d(e),G&&G.d(),z&&z.d(),H&&H.d(),T=!1,j()}}}function wi(s){let e,t,r,o,n,i,u;return o=new ui({props:{accept:"image/*",multiple:!1,disableDefaultStyles:!0,containerClasses:"dropzone-container",disabled:s[0],noClick:!0,$$slots:{default:[ki]},$$scope:{ctx:s}}}),o.$on("drop",s[7]),o.$on("dragenter",s[5]),o.$on("dragleave",s[6]),o.$on("dragover",yi),{c(){e=h("div"),t=h("input"),r=C(),lr(o.$$.fragment),this.h()},l(c){e=g(c,"DIV",{class:!0});var f=v(e);t=g(f,"INPUT",{type:!0,accept:!0,class:!0}),r=D(f),nr(o.$$.fragment,f),f.forEach(d),this.h()},h(){a(t,"type","file"),a(t,"accept","image/jpeg,image/jpg,image/png,image/webp,image/bmp,image/tiff"),a(t,"class","hidden"),t.disabled=s[0],a(e,"class","unified-input-container svelte-1yokvc6")},m(c,f){Y(c,e,f),l(e,t),s[11](t),l(e,r),ar(o,e,null),n=!0,i||(u=se(t,"change",s[8]),i=!0)},p(c,[f]){(!n||f&1)&&(t.disabled=c[0]);const m={};f&1&&(m.disabled=c[0]),f&131099&&(m.$$scope={dirty:f,ctx:c}),o.$set(m)},i(c){n||($e(o.$$.fragment,c),n=!0)},o(c){ht(o.$$.fragment,c),n=!1},d(c){c&&d(e),s[11](null),ir(o),i=!1,u()}}}function yi(){console.log("ðŸ” handleDragOver called")}function Ei(s,e,t){let{disabled:r=!1}=e,{showPasteHint:o=!0}=e;const n=Er();let i,u=!1,c=!1,f=null;Cr(async()=>{console.log("ðŸ” UnifiedInput component mounted"),t(4,c=!!(navigator.clipboard&&navigator.clipboard.read)),console.log("ðŸ” Clipboard supported:",c),c&&(f=m())}),fl(()=>{f&&f()});function m(){const A=async x=>{if(!((x.metaKey||x.ctrlKey)&&x.key==="v"))return;const I=x.target;I.tagName==="INPUT"||I.tagName==="TEXTAREA"||I.isContentEditable||(x.preventDefault(),await V())};return document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)}async function p(A){if(console.log("ðŸ” handleFiles called with",A.length,"files"),r||A.length===0)return;const x=A[0];console.log("ðŸ” Processing file:",x.name,x.type,x.size);try{const R=await fi(x);if(!R.isValid){console.log("ðŸ” File validation failed:",R.error),n("error",{message:R.error||"Invalid image file"});return}R.warnings&&R.warnings.length>0&&console.warn("Image validation warnings:",R.warnings);const I=await _i(x);console.log("ðŸ” File processed, size:",I.size);const U=await hi(I);console.log("ðŸ” Image data created:",U),n("imageSelected",{image:U}),console.log("ðŸ” imageSelected event dispatched")}catch(R){console.log("ðŸ” Error in handleFiles:",R);const I=R instanceof Error?R.message:"Failed to process image";n("error",{message:I})}}function b(){console.log("ðŸ” handleDragEnter called"),r||t(3,u=!0)}function w(){console.log("ðŸ” handleDragLeave called"),r||t(3,u=!1)}async function _(A){console.log("ðŸ” handleDrop called with",A.detail.acceptedFiles.length,"files"),t(3,u=!1),!r&&A.detail.acceptedFiles.length>0?await p(A.detail.acceptedFiles):n("error",{message:"No supported files found in drop"})}function y(){console.log("ðŸ” handleFileInputChange called"),console.log("ðŸ” fileInput.files:",i.files),i.files&&i.files.length>0&&(p(i.files),t(2,i.value="",i))}async function V(A){if(console.log("ðŸ” handleClipboardPaste called"),!r)try{let x=null;if(A)x=A,console.log("ðŸ” Using provided file from keyboard listener");else if(c){console.log("ðŸ” Reading from clipboard");const R=await navigator.clipboard.read();if(R&&R.length>0)for(const I of R){const U=I.types.filter(B=>B.startsWith("image/"));if(U.length>0){const B=U[0],T=await I.getType(B);if(T&&T.size>0){x=new File([T],"clipboard-image.png",{type:B}),console.log("ðŸ” Clipboard image converted to file");break}}}}x?await p([x]):n("error",{message:"No image found in clipboard"})}catch(x){console.log("ðŸ” Clipboard paste error:",x);const R=x instanceof Error?x.message:"Failed to paste image";n("error",{message:R})}}function S(){console.log("ðŸ” triggerFileInput called"),console.log("ðŸ” disabled:",r),console.log("ðŸ” fileInput:",i),!r&&i&&(i.click(),console.log("ðŸ” File input clicked"))}function k(A){Cs[A?"unshift":"push"](()=>{i=A,t(2,i)})}const M=()=>V();return s.$$set=A=>{"disabled"in A&&t(0,r=A.disabled),"showPasteHint"in A&&t(1,o=A.showPasteHint)},[r,o,i,u,c,b,w,_,y,V,S,k,M]}class Ci extends Rs{constructor(e){super(),As(this,e,Ei,wi,Ps,{disabled:0,showPasteHint:1})}}function Ol(s){return Object.prototype.toString.call(s)==="[object Date]"}function dl(s){const e=s-1;return e*e*e+1}function Di(s){return Math.sin(-13*(s+1)*Math.PI/2)*Math.pow(2,-10*s)+1}function to(s){return--s*s*s*s*s+1}function vl(s,e){if(s===e||s!==s)return()=>s;const t=typeof s;if(t!==typeof e||Array.isArray(s)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(s)){const r=e.map((o,n)=>vl(s[n],o));return o=>r.map(n=>n(o))}if(t==="object"){if(!s||!e)throw new Error("Object cannot be null");if(Ol(s)&&Ol(e)){s=s.getTime(),e=e.getTime();const n=e-s;return i=>new Date(s+i*n)}const r=Object.keys(e),o={};return r.forEach(n=>{o[n]=vl(s[n],e[n])}),n=>{const i={};return r.forEach(u=>{i[u]=o[u](n)}),i}}if(t==="number"){const r=e-s;return o=>s+o*r}throw new Error(`Cannot interpolate ${t} values`)}function Is(s,e={}){const t=el(s);let r,o=s;function n(i,u){if(s==null)return t.set(s=i),Promise.resolve();o=i;let c=r,f=!1,{delay:m=0,duration:p=400,easing:b=Ma,interpolate:w=vl}=$o($o({},e),u);if(p===0)return c&&(c.abort(),c=null),t.set(s=o),Promise.resolve();const _=Aa()+m;let y;return r=Va(V=>{if(V<_)return!0;f||(y=w(s,i),typeof p=="function"&&(p=p(s,i)),f=!0),c&&(c.abort(),c=null);const S=V-_;return S>p?(t.set(s=i),!1):(t.set(s=y(b(S/p))),!0)}),r.promise}return{set:n,update:(i,u)=>n(i(o,s),u),subscribe:t.subscribe}}function zl(s){let e,t,r,o,n,i,u,c=Math.round(s[1])+"",f,m,p,b,w,_,y,V,S='<div class="w-2 h-2 rounded-full bg-magic-400 animate-pulse svelte-194rnt3"></div> <span class="text-xs text-dark-text-muted">Magic scanline active...</span>';return{c(){e=h("div"),t=h("div"),r=h("div"),o=h("span"),n=L(s[2]),i=C(),u=h("span"),f=L(c),m=L("%"),p=C(),b=h("div"),w=h("div"),_=h("div"),y=C(),V=h("div"),V.innerHTML=S,this.h()},l(k){e=g(k,"DIV",{class:!0});var M=v(e);t=g(M,"DIV",{class:!0});var A=v(t);r=g(A,"DIV",{class:!0});var x=v(r);o=g(x,"SPAN",{class:!0});var R=v(o);n=O(R,s[2]),R.forEach(d),i=D(x),u=g(x,"SPAN",{class:!0});var I=v(u);f=O(I,c),m=O(I,"%"),I.forEach(d),x.forEach(d),p=D(A),b=g(A,"DIV",{class:!0});var U=v(b);w=g(U,"DIV",{class:!0,style:!0});var B=v(w);_=g(B,"DIV",{class:!0}),v(_).forEach(d),B.forEach(d),U.forEach(d),y=D(A),V=g(A,"DIV",{class:!0,"data-svelte-h":!0}),Z(V)!=="svelte-55sbsw"&&(V.innerHTML=S),A.forEach(d),M.forEach(d),this.h()},h(){a(o,"class","text-sm text-magic-400 font-medium"),a(u,"class","text-xs text-dark-text-secondary"),a(r,"class","flex items-center justify-between mb-2"),a(_,"class","h-full w-full bg-white/20 animate-pulse svelte-194rnt3"),a(w,"class","h-full bg-gradient-to-r from-magic-400 to-magic-300 transition-all duration-500 ease-out"),ge(w,"width",s[1]+"%"),a(b,"class","h-1 bg-dark-base rounded-full overflow-hidden"),a(V,"class","mt-2 flex items-center space-x-2"),a(t,"class","bg-dark-elevated/90 backdrop-blur-sm rounded-lg px-4 py-3 border border-magic-400/20"),a(e,"class","absolute bottom-4 left-4 right-4 z-30")},m(k,M){Y(k,e,M),l(e,t),l(t,r),l(r,o),l(o,n),l(r,i),l(r,u),l(u,f),l(u,m),l(t,p),l(t,b),l(b,w),l(w,_),l(t,y),l(t,V)},p(k,M){M[0]&4&&pe(n,k[2]),M[0]&2&&c!==(c=Math.round(k[1])+"")&&pe(f,c),M[0]&2&&ge(w,"width",k[1]+"%")},d(k){k&&d(e)}}}function Ul(s){let e;return{c(){e=h("div"),this.h()},l(t){e=g(t,"DIV",{class:!0,style:!0}),v(e).forEach(d),this.h()},h(){a(e,"class","absolute inset-0 pointer-events-none z-5"),ge(e,"background","radial-gradient(circle at center, rgba(0, 255, 136, "+s[5]*.1+") 0%, transparent 70%)"),ge(e,"box-shadow","inset 0 0 100px rgba(0, 255, 136, "+s[5]*.2+")")},m(t,r){Y(t,e,r)},p(t,r){r[0]&32&&ge(e,"background","radial-gradient(circle at center, rgba(0, 255, 136, "+t[5]*.1+") 0%, transparent 70%)"),r[0]&32&&ge(e,"box-shadow","inset 0 0 100px rgba(0, 255, 136, "+t[5]*.2+")")},d(t){t&&d(e)}}}function Ii(s){let e,t,r,o,n,i,u=s[0]&&zl(s),c=s[0]&&Ul(s);return{c(){e=h("div"),t=h("canvas"),r=C(),o=h("canvas"),n=C(),u&&u.c(),i=C(),c&&c.c(),this.h()},l(f){e=g(f,"DIV",{class:!0});var m=v(e);t=g(m,"CANVAS",{class:!0,style:!0}),v(t).forEach(d),r=D(m),o=g(m,"CANVAS",{class:!0,style:!0}),v(o).forEach(d),n=D(m),u&&u.l(m),i=D(m),c&&c.l(m),m.forEach(d),this.h()},h(){a(t,"class","absolute inset-0 w-full h-full object-contain z-10 svelte-194rnt3"),ge(t,"opacity",s[6]),a(o,"class","absolute inset-0 w-full h-full object-contain z-20 pointer-events-none svelte-194rnt3"),ge(o,"mix-blend-mode","screen"),a(e,"class","scanline-processor relative overflow-hidden rounded-lg svelte-194rnt3")},m(f,m){Y(f,e,m),l(e,t),s[11](t),l(e,r),l(e,o),s[12](o),l(e,n),u&&u.m(e,null),l(e,i),c&&c.m(e,null)},p(f,m){m[0]&64&&ge(t,"opacity",f[6]),f[0]?u?u.p(f,m):(u=zl(f),u.c(),u.m(e,i)):u&&(u.d(1),u=null),f[0]?c?c.p(f,m):(c=Ul(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i:Ge,o:Ge,d(f){f&&d(e),s[11](null),s[12](null),u&&u.d(),c&&c.d()}}}const Hl=3e3,hl=1e3,Si=.003,Mi=12,Ti=5;function xi(s,e,t){let r,o,{image:n}=e,{isProcessing:i=!1}=e,{processingProgress:u=0}=e,{processingMessage:c="Processing..."}=e,{processedResult:f=null}=e;const m=Er();let p,b,w,_=Is(0,{duration:3e3,easing:to}),y=Is(1,{duration:1e3,easing:dl});is(s,y,q=>t(6,o=q));let V=Is(0,{duration:500,easing:dl});is(s,V,q=>t(5,r=q));let S,k,M,A=null;Cr(()=>{p&&b&&(S=p.getContext("2d"),k=b.getContext("2d"),y.set(1,{duration:0}),x())}),fl(()=>{w&&cancelAnimationFrame(w)});async function x(){M=new Image,M.onload=()=>{R(),U()},M.src=n.preview}function R(){const{width:q,height:X}=I();t(3,p.width=q,p),t(3,p.height=X,p),t(4,b.width=q,b),t(4,b.height=X,b),S.imageSmoothingEnabled=!0,S.imageSmoothingQuality="high",k.imageSmoothingEnabled=!0,k.imageSmoothingQuality="high"}function I(){const q=window.innerWidth,X=window.innerHeight;let re=Math.min(600,q-80),Q=Math.min(400,X*.4);q<=480&&(re=Math.min(re,q-40),Q=Math.min(Q,X*.35));const te=n.dimensions||{width:600,height:400},ee=te.width/te.height;let oe=Math.min(te.width,re),ne=oe/ee;return ne>Q&&(ne=Q,oe=ne*ee),oe=Math.max(oe,200),ne=Math.max(ne,150),{width:Math.round(oe),height:Math.round(ne)}}function U(){const{width:q,height:X}=I();S.clearRect(0,0,q,X),S.drawImage(M,0,0,q,X)}async function B(){_.set(0),V.set(.3),y.set(1,{duration:0}),_.set(1),T(),j()}function T(){let q=Date.now();function X(){if(!i)return;const re=Date.now()-q,Q=.3+.4*Math.sin(re*Si);V.set(Q),w=requestAnimationFrame(X)}X()}function j(){const q=Date.now(),{width:X,height:re}=I();function Q(){if(!i)return;const te=Date.now()-q,ee=Math.min(te/Hl,1);if(k.clearRect(0,0,X,re),G(ee,X,re),te>hl){const oe=Math.min((te-hl)/(Hl-hl),1);F(oe,X,re)}ee<1?w=requestAnimationFrame(Q):m("scanlineComplete")}Q()}function G(q,X,re){const Q=q*re,te=r,ee=Date.now()*.005,oe=Math.sin(ee*2)*Ti,ne=Q+oe,ke=k.createLinearGradient(0,ne-25,0,ne+25);ke.addColorStop(0,"rgba(0, 255, 136, 0)"),ke.addColorStop(.3,`rgba(0, 255, 136, ${te*.6})`),ke.addColorStop(.5,`rgba(0, 255, 136, ${te})`),ke.addColorStop(.7,`rgba(0, 255, 136, ${te*.6})`),ke.addColorStop(1,"rgba(0, 255, 136, 0)"),k.fillStyle=ke,k.fillRect(0,ne-25,X,50),z(ne,X,te,ee),H(ne,X,te);const ae=k.createLinearGradient(0,Math.max(0,ne-80),0,ne);ae.addColorStop(0,"rgba(0, 255, 136, 0)"),ae.addColorStop(.5,`rgba(0, 255, 136, ${te*.2})`),ae.addColorStop(1,`rgba(0, 255, 136, ${te*.4})`),k.fillStyle=ae,k.fillRect(0,Math.max(0,ne-80),X,80),q>.3&&E(ne,X,te)}function z(q,X,re,Q){for(let ee=0;ee<12;ee++){const ne=ee/12*X+Math.sin(Q+ee*.5)*30,ke=q+Math.sin(Q*1.2+ee*.8)*8,ae=1.5+Math.sin(Q*2+ee)*.8,be=(.6+Math.sin(Q*1.5+ee*.3)*.3)*re;k.save(),k.globalAlpha=be;const Ie=k.createRadialGradient(ne,ke,0,ne,ke,ae*3);Ie.addColorStop(0,`rgba(0, 255, 136, ${be})`),Ie.addColorStop(.7,`rgba(0, 255, 136, ${be*.5})`),Ie.addColorStop(1,"rgba(0, 255, 136, 0)"),k.fillStyle=Ie,k.beginPath(),k.arc(ne,ke,ae*3,0,Math.PI*2),k.fill(),k.fillStyle=`rgba(255, 255, 255, ${be*.8})`,k.beginPath(),k.arc(ne,ke,ae,0,Math.PI*2),k.fill(),k.restore()}}function H(q,X,re,Q){const te=Math.floor(Mi*re),ee=Date.now()*.01;for(let oe=0;oe<te;oe++){const ne=Math.random()*X,ke=q+(Math.random()-.5)*40,ae=(Math.sin(ee+oe)+1)/2;if(ae<.1)continue;const be=(1+Math.random()*2)*ae,Ie=ae*re*.6;k.save(),k.globalAlpha=Ie,k.shadowBlur=6,k.shadowColor=`rgba(0, 255, 136, ${Ie})`,k.strokeStyle=`rgba(255, 255, 255, ${Ie})`,k.lineWidth=be,k.lineCap="round",k.beginPath(),k.moveTo(ne-be*2,ke),k.lineTo(ne+be*2,ke),k.moveTo(ne,ke-be*2),k.lineTo(ne,ke+be*2),k.stroke(),k.restore()}}function E(q,X,re,Q){const ee=q+10,oe=k.createLinearGradient(0,ee,0,ee+30);oe.addColorStop(0,`rgba(0, 255, 136, ${re*.2})`),oe.addColorStop(1,"rgba(0, 255, 136, 0)"),k.save(),k.globalAlpha=.4,k.fillStyle=oe,k.fillRect(0,ee,X,30),k.restore()}function F(q,X,re){const Q=k.getImageData(0,0,X,re),te=Q.data;for(let ee=0;ee<te.length;ee+=4){const oe=ee/4%X,ne=Math.floor(ee/4/X),ke=Math.random()*.5+.5,be=Math.sqrt(Math.pow(oe-X/2,2)+Math.pow(ne-re/2,2))/Math.sqrt(X*X+re*re);q*(1+be*.3)*ke>.6&&(te[ee]=Math.min(255,te[ee]+Math.random()*100),te[ee+1]=Math.min(255,te[ee+1]+Math.random()*255),te[ee+2]=Math.min(255,te[ee+2]+Math.random()*150),te[ee+3]=Math.max(0,te[ee+3]-Math.random()*100))}k.putImageData(Q,0,0)}async function P(){f&&(A=new Image,A.onload=()=>{w&&cancelAnimationFrame(w),k.clearRect(0,0,b.width,b.height);const{width:q,height:X}=I();S.clearRect(0,0,q,X),S.drawImage(A,0,0,q,X),y.set(0).then(()=>{y.set(1),m("animationComplete")})},A.src=f)}function N(q){Cs[q?"unshift":"push"](()=>{p=q,t(3,p)})}function K(q){Cs[q?"unshift":"push"](()=>{b=q,t(4,b)})}return s.$$set=q=>{"image"in q&&t(9,n=q.image),"isProcessing"in q&&t(0,i=q.isProcessing),"processingProgress"in q&&t(1,u=q.processingProgress),"processingMessage"in q&&t(2,c=q.processingMessage),"processedResult"in q&&t(10,f=q.processedResult)},s.$$.update=()=>{s.$$.dirty[0]&9&&i&&p&&B(),s.$$.dirty[0]&1025&&f&&!i&&P()},[i,u,c,p,b,r,o,y,V,n,f,N,K]}class Pi extends Rs{constructor(e){super(),As(this,e,xi,Ii,Ps,{image:9,isProcessing:0,processingProgress:1,processingMessage:2,processedResult:10},null,[-1,-1])}}const Eo=class Eo{constructor(){}static getInstance(){return Eo.instance||(Eo.instance=new Eo),Eo.instance}async downloadImage(e,t={format:"png"},r){try{const o=await fetch(e);if(!o.ok)throw new Error(`Failed to fetch image: ${o.status}`);const n=await o.blob(),{blob:i,filename:u}=await this.processImageBlob(n,t,r),c=URL.createObjectURL(i),f=document.createElement("a");return f.href=c,f.download=u,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(c),!0}catch(o){return console.error("Download failed:",o),!1}}async downloadBatch(e,t={format:"png"}){let r=0,o=0;for(let n=0;n<e.length;n++){const{url:i,metadata:u}=e[n],c={...t,filename:t.filename||`character_batch_${n+1}.${t.format}`};await this.downloadImage(i,c,u)?r++:o++,await this.delay(200)}return{successful:r,failed:o}}async getDownloadPreview(e,t){try{const r=await fetch(e,{method:"HEAD"}),o=parseInt(r.headers.get("content-length")||"0");let n=o;return t.format==="jpeg"?n=Math.floor(o*.6):t.format==="webp"&&(n=Math.floor(o*.7)),{estimatedSize:this.formatFileSize(n),format:t.format.toUpperCase(),filename:this.generateFilename(t),dimensions:await this.getImageDimensions(e)}}catch{return{estimatedSize:"Unknown",format:t.format.toUpperCase(),filename:this.generateFilename(t)}}}async processImageBlob(e,t,r){const o=this.generateFilename(t,r);return t.format==="png"&&!t.includeMetadata?{blob:e,filename:o}:{blob:await this.convertImageFormat(e,t),filename:o}}async convertImageFormat(e,t){return new Promise(r=>{const o=new Image,n=document.createElement("canvas"),i=n.getContext("2d");o.onload=()=>{n.width=o.width,n.height=o.height,i.drawImage(o,0,0),n.toBlob(u=>{r(u||e)},this.getMimeType(t.format),t.quality||.9)},o.onerror=()=>r(e),o.src=URL.createObjectURL(e)})}generateFilename(e,t){var n;if(e.filename)return this.ensureExtension(e.filename,e.format);const r=new Date().toISOString().slice(0,19).replace(/[:.]/g,"-");return`character_${((n=t==null?void 0:t.processingId)==null?void 0:n.slice(-8))||"unknown"}_${r}.${e.format}`}ensureExtension(e,t){const r=`.${t}`;if(e.toLowerCase().endsWith(r))return e;const o=e.lastIndexOf(".");return o>0&&(e=e.substring(0,o)),e+r}getMimeType(e){return{png:"image/png",jpeg:"image/jpeg",webp:"image/webp"}[e]||"image/png"}formatFileSize(e){if(e===0)return"0 B";const t=1024,r=["B","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(1))+" "+r[o]}async getImageDimensions(e){return new Promise(t=>{const r=new Image;r.onload=()=>t({width:r.width,height:r.height}),r.onerror=()=>t(void 0),r.src=e})}delay(e){return new Promise(t=>setTimeout(t,e))}supportsFormat(e){const t=document.createElement("canvas");if(!["png","jpeg","webp"].includes(e))return!1;try{return t.toBlob(()=>{},this.getMimeType(e)),!0}catch{return!1}}getRecommendedFormat(e="development"){const t=this.supportsFormat("webp");switch(e){case"web":return t?"webp":"png";case"print":return"png";case"development":default:return"png"}}};or(Eo,"instance");let pl=Eo;const Ri=pl.getInstance();function Zo(){const{subscribe:s,update:e}=el([]);let t=1;return{subscribe:s,add:(r,o,n=5e3)=>{const i=t++,u={id:i,type:r,message:o,duration:n,timestamp:Date.now()};return e(c=>[...c,u]),i},remove:r=>{e(o=>o.filter(n=>n.id!==r))},clear:()=>{e(()=>[])},success:(r,o)=>Zo().add("success",r,o),error:(r,o)=>Zo().add("error",r,o),warning:(r,o)=>Zo().add("warning",r,o),info:(r,o)=>Zo().add("info",r,o)}}const Lo=Zo(),Ai={success:(s,e=5e3)=>Lo.add("success",s,e),error:(s,e=5e3)=>Lo.add("error",s,e),warning:(s,e=5e3)=>Lo.add("warning",s,e),info:(s,e=5e3)=>Lo.add("info",s,e),remove:s=>Lo.remove(s),clear:()=>Lo.clear()};const{window:al}=Pa;function Gl(s){let e,t,r,o,n,i="Before",u,c,f,m,p,b,w="After",_,y,V,S,k='<div class="w-8 h-8 bg-magic-400 rounded-full shadow-lg flex items-center justify-center cursor-grab active:cursor-grabbing svelte-1pjh5e2"><svg class="w-4 h-4 text-white svelte-1pjh5e2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4M8 15l4 4 4-4" class="svelte-1pjh5e2"></path></svg></div>',M,A,x,R,I,U,B;return{c(){e=h("div"),t=h("img"),o=C(),n=h("div"),n.textContent=i,u=C(),c=h("div"),f=h("img"),p=C(),b=h("div"),b.textContent=w,_=C(),y=h("div"),V=h("div"),S=h("div"),S.innerHTML=k,A=C(),x=h("div"),R=h("div"),I=h("div"),this.h()},l(T){e=g(T,"DIV",{class:!0});var j=v(e);t=g(j,"IMG",{src:!0,alt:!0,class:!0}),o=D(j),n=g(j,"DIV",{class:!0,"data-svelte-h":!0}),Z(n)!=="svelte-1708kdh"&&(n.textContent=i),j.forEach(d),u=D(T),c=g(T,"DIV",{class:!0,style:!0});var G=v(c);f=g(G,"IMG",{src:!0,alt:!0,class:!0}),p=D(G),b=g(G,"DIV",{class:!0,"data-svelte-h":!0}),Z(b)!=="svelte-1c3bdub"&&(b.textContent=w),G.forEach(d),_=D(T),y=g(T,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0,"aria-valuemin":!0,"aria-valuemax":!0,"aria-valuenow":!0,"aria-valuetext":!0});var z=v(y);V=g(z,"DIV",{class:!0,style:!0});var H=v(V);S=g(H,"DIV",{class:!0,"data-svelte-h":!0}),Z(S)!=="svelte-j7g78v"&&(S.innerHTML=k),H.forEach(d),z.forEach(d),A=D(T),x=g(T,"DIV",{class:!0});var E=v(x);R=g(E,"DIV",{class:!0});var F=v(R);I=g(F,"DIV",{class:!0,style:!0}),v(I).forEach(d),F.forEach(d),E.forEach(d),this.h()},h(){zo(t.src,r=s[0].preview)||a(t,"src",r),a(t,"alt","Original character with background"),a(t,"class","w-full h-full object-contain svelte-1pjh5e2"),a(n,"class","absolute bottom-2 left-2 px-2 py-1 bg-dark-elevated/90 rounded text-xs text-dark-text-secondary svelte-1pjh5e2"),a(e,"class","comparison-image absolute inset-0 svelte-1pjh5e2"),zo(f.src,m=s[10])||a(f,"src",m),a(f,"alt","Character with background removed"),a(f,"class","w-full h-full object-contain processed-image svelte-1pjh5e2"),a(b,"class","absolute bottom-2 right-2 px-2 py-1 bg-magic-400/20 backdrop-blur-sm rounded text-xs text-magic-400 svelte-1pjh5e2"),a(c,"class","comparison-image absolute inset-0 transition-all duration-300 ease-out svelte-1pjh5e2"),ge(c,"clip-path","inset(0 "+(100-s[8])+"% 0 0)"),a(S,"class","slider-handle absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 svelte-1pjh5e2"),a(V,"class","slider-line absolute top-0 bottom-0 w-0.5 bg-magic-400 shadow-lg svelte-1pjh5e2"),ge(V,"left",s[8]+"%"),a(y,"class","slider-container absolute inset-0 cursor-ew-resize svelte-1pjh5e2"),a(y,"role","slider"),a(y,"tabindex","0"),a(y,"aria-label","Compare before and after images. Drag left and right to reveal the original or processed image."),a(y,"aria-valuemin","0"),a(y,"aria-valuemax","100"),a(y,"aria-valuenow",s[8]),a(y,"aria-valuetext",M=Math.round(s[8])+"% comparison position"),a(I,"class","h-full bg-gradient-to-r from-magic-400 to-magic-300 transition-all duration-1000 ease-out svelte-1pjh5e2"),ge(I,"width",s[13]*100+"%"),a(R,"class","h-1 bg-dark-elevated rounded-full overflow-hidden svelte-1pjh5e2"),a(x,"class","absolute top-2 left-2 right-2 svelte-1pjh5e2")},m(T,j){Y(T,e,j),l(e,t),l(e,o),l(e,n),Y(T,u,j),Y(T,c,j),l(c,f),l(c,p),l(c,b),Y(T,_,j),Y(T,y,j),l(y,V),l(V,S),Y(T,A,j),Y(T,x,j),l(x,R),l(R,I),U||(B=[se(y,"mousedown",s[21]),se(y,"touchstart",s[21],{passive:!0}),se(y,"keydown",s[24])],U=!0)},p(T,j){j[0]&1&&!zo(t.src,r=T[0].preview)&&a(t,"src",r),j[0]&1024&&!zo(f.src,m=T[10])&&a(f,"src",m),j[0]&256&&ge(c,"clip-path","inset(0 "+(100-T[8])+"% 0 0)"),j[0]&256&&ge(V,"left",T[8]+"%"),j[0]&256&&a(y,"aria-valuenow",T[8]),j[0]&256&&M!==(M=Math.round(T[8])+"% comparison position")&&a(y,"aria-valuetext",M),j[0]&8192&&ge(I,"width",T[13]*100+"%")},d(T){T&&(d(e),d(u),d(c),d(_),d(y),d(A),d(x)),U=!1,Jt(B)}}}function ql(s){let e,t,r,o,n,i,u,c,f,m,p,b,w,_,y="Perfect for batch processing workflow",V,S,k,M="Download",A,x,R="Stay Here",I,U,B,T,j;return{c(){e=h("div"),t=h("div"),r=h("div"),o=h("div"),n=h("span"),i=L(s[6]),u=C(),c=h("div"),f=h("p"),m=L("Continuing to process another image in "),p=L(s[6]),b=L("s"),w=C(),_=h("p"),_.textContent=y,V=C(),S=h("div"),k=h("button"),k.textContent=M,A=C(),x=h("button"),x.textContent=R,I=C(),U=h("div"),B=h("div"),this.h()},l(G){e=g(G,"DIV",{class:!0});var z=v(e);t=g(z,"DIV",{class:!0});var H=v(t);r=g(H,"DIV",{class:!0});var E=v(r);o=g(E,"DIV",{class:!0});var F=v(o);n=g(F,"SPAN",{class:!0});var P=v(n);i=O(P,s[6]),P.forEach(d),F.forEach(d),u=D(E),c=g(E,"DIV",{class:!0});var N=v(c);f=g(N,"P",{class:!0});var K=v(f);m=O(K,"Continuing to process another image in "),p=O(K,s[6]),b=O(K,"s"),K.forEach(d),w=D(N),_=g(N,"P",{class:!0,"data-svelte-h":!0}),Z(_)!=="svelte-1j2dwwu"&&(_.textContent=y),N.forEach(d),E.forEach(d),V=D(H),S=g(H,"DIV",{class:!0});var q=v(S);k=g(q,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),Z(k)!=="svelte-1jou2sf"&&(k.textContent=M),A=D(q),x=g(q,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),Z(x)!=="svelte-1copmo1"&&(x.textContent=R),q.forEach(d),H.forEach(d),I=D(z),U=g(z,"DIV",{class:!0});var X=v(U);B=g(X,"DIV",{class:!0,style:!0}),v(B).forEach(d),X.forEach(d),z.forEach(d),this.h()},h(){a(n,"class","text-sm font-mono text-magic-400 svelte-1pjh5e2"),a(o,"class","w-8 h-8 rounded-full bg-magic-400/20 flex items-center justify-center svelte-1pjh5e2"),a(f,"class","text-sm text-dark-text svelte-1pjh5e2"),a(_,"class","text-xs text-dark-text-muted svelte-1pjh5e2"),a(c,"class","svelte-1pjh5e2"),a(r,"class","flex items-center space-x-3 svelte-1pjh5e2"),a(k,"class","btn btn-outline border-magic-400 text-magic-400 hover:bg-magic-400 hover:text-white px-4 py-2 rounded text-sm svelte-1pjh5e2"),a(k,"aria-label","Download the processed image without background"),a(x,"class","btn btn-outline border-gray-500 text-gray-400 hover:bg-gray-500 hover:text-white px-4 py-2 rounded text-sm svelte-1pjh5e2"),a(x,"aria-label","Cancel auto-download and stay on this page"),a(S,"class","flex space-x-2 svelte-1pjh5e2"),a(t,"class","flex items-center justify-between svelte-1pjh5e2"),a(B,"class","h-full bg-magic-400 transition-all duration-1000 ease-linear svelte-1pjh5e2"),ge(B,"width",(Math.floor(s[2]/1e3)-s[6])/Math.floor(s[2]/1e3)*100+"%"),a(U,"class","mt-3 h-1 bg-dark-base rounded-full overflow-hidden svelte-1pjh5e2"),a(e,"class","mt-6 p-4 bg-dark-elevated/50 backdrop-blur-sm rounded-lg border border-magic-400/20 svelte-1pjh5e2")},m(G,z){Y(G,e,z),l(e,t),l(t,r),l(r,o),l(o,n),l(n,i),l(r,u),l(r,c),l(c,f),l(f,m),l(f,p),l(f,b),l(c,w),l(c,_),l(t,V),l(t,S),l(S,k),l(S,A),l(S,x),l(e,I),l(e,U),l(U,B),T||(j=[se(k,"click",s[19]),se(x,"click",s[18])],T=!0)},p(G,z){z[0]&64&&pe(i,G[6]),z[0]&64&&pe(p,G[6]),z[0]&68&&ge(B,"width",(Math.floor(G[2]/1e3)-G[6])/Math.floor(G[2]/1e3)*100+"%")},d(G){G&&d(e),T=!1,Jt(j)}}}function Wl(s){let e,t,r=`<svg class="w-5 h-5 mr-2 svelte-1pjh5e2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-4-4m4 4l4-4m-4-4V3" class="svelte-1pjh5e2"></path></svg>
        Download PNG`,o,n,i=`<svg class="w-5 h-5 mr-2 svelte-1pjh5e2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-1pjh5e2"></path></svg>
        Refine`,u,c,f=`<svg class="w-5 h-5 mr-2 svelte-1pjh5e2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" class="svelte-1pjh5e2"></path></svg>
        Process Another`,m,p;return{c(){e=h("div"),t=h("button"),t.innerHTML=r,o=C(),n=h("button"),n.innerHTML=i,u=C(),c=h("button"),c.innerHTML=f,this.h()},l(b){e=g(b,"DIV",{class:!0});var w=v(e);t=g(w,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),Z(t)!=="svelte-1mpi2nz"&&(t.innerHTML=r),o=D(w),n=g(w,"BUTTON",{class:!0,"aria-label":!0,title:!0,"data-svelte-h":!0}),Z(n)!=="svelte-1ced4ro"&&(n.innerHTML=i),u=D(w),c=g(w,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),Z(c)!=="svelte-6vgmuk"&&(c.innerHTML=f),w.forEach(d),this.h()},h(){a(t,"class","btn btn-magic py-3 px-6 rounded-lg font-medium svelte-1pjh5e2"),a(t,"aria-label","Download the processed image as PNG file"),a(n,"class","btn btn-outline border-amber-400 text-amber-400 hover:bg-amber-400 hover:text-white py-3 px-6 rounded-lg font-medium svelte-1pjh5e2"),a(n,"aria-label","Open refinement editor to fix any background removal errors with brush tools"),a(n,"title","Fix any background removal errors with brush tools"),a(c,"class","btn btn-outline border-magic-400 text-magic-400 hover:bg-magic-400 hover:text-white py-3 px-6 rounded-lg font-medium svelte-1pjh5e2"),a(c,"aria-label","Process another image - return to upload interface"),a(e,"class","mt-6 flex flex-col sm:flex-row gap-4 justify-center svelte-1pjh5e2")},m(b,w){Y(b,e,w),l(e,t),l(e,o),l(e,n),l(e,u),l(e,c),m||(p=[se(t,"click",s[19]),se(n,"click",s[26]),se(c,"click",s[27])],m=!0)},p:Ge,d(b){b&&d(e),m=!1,Jt(p)}}}function Vi(s){let e,t,r,o="Perfect Reveal Complete!",n,i,u,c=s[9].toFixed(2)+"",f,m,p,b,w,_,y,V,S=s[3]&&Gl(s),k=s[5]&&s[1]&&ql(s),M=(!s[1]||!s[5])&&Wl(s);return{c(){e=h("div"),t=h("div"),r=h("h3"),r.textContent=o,n=C(),i=h("p"),u=L("Background removed in "),f=L(c),m=L("s â€¢ Auto-copied to clipboard"),p=C(),b=h("div"),S&&S.c(),w=C(),k&&k.c(),_=C(),M&&M.c(),this.h()},l(A){e=g(A,"DIV",{class:!0,style:!0});var x=v(e);t=g(x,"DIV",{class:!0});var R=v(t);r=g(R,"H3",{class:!0,"data-svelte-h":!0}),Z(r)!=="svelte-1t3kgd4"&&(r.textContent=o),n=D(R),i=g(R,"P",{class:!0});var I=v(i);u=O(I,"Background removed in "),f=O(I,c),m=O(I,"s â€¢ Auto-copied to clipboard"),I.forEach(d),R.forEach(d),p=D(x),b=g(x,"DIV",{class:!0,style:!0});var U=v(b);S&&S.l(U),U.forEach(d),w=D(x),k&&k.l(x),_=D(x),M&&M.l(x),x.forEach(d),this.h()},h(){a(r,"class","text-2xl font-semibold text-magic-gradient mb-2 svelte-1pjh5e2"),a(i,"class","text-dark-text-secondary svelte-1pjh5e2"),a(t,"class","mb-6 text-center svelte-1pjh5e2"),a(b,"class","comparison-container relative overflow-hidden rounded-xl border border-magic-400/20 svelte-1pjh5e2"),ge(b,"transform","translateY("+s[12]+"px)"),ge(b,"height",s[7]+"px"),a(e,"class","before-after-preview svelte-1pjh5e2"),ge(e,"opacity",s[11])},m(A,x){Y(A,e,x),l(e,t),l(t,r),l(t,n),l(t,i),l(i,u),l(i,f),l(i,m),l(e,p),l(e,b),S&&S.m(b,null),s[25](b),l(e,w),k&&k.m(e,null),l(e,_),M&&M.m(e,null),y||(V=[se(al,"mousemove",s[20]),se(al,"mouseup",s[22]),se(al,"touchmove",s[20]),se(al,"touchend",s[22])],y=!0)},p(A,x){x[0]&512&&c!==(c=A[9].toFixed(2)+"")&&pe(f,c),A[3]?S?S.p(A,x):(S=Gl(A),S.c(),S.m(b,null)):S&&(S.d(1),S=null),x[0]&4096&&ge(b,"transform","translateY("+A[12]+"px)"),x[0]&128&&ge(b,"height",A[7]+"px"),A[5]&&A[1]?k?k.p(A,x):(k=ql(A),k.c(),k.m(e,_)):k&&(k.d(1),k=null),!A[1]||!A[5]?M?M.p(A,x):(M=Wl(A),M.c(),M.m(e,null)):M&&(M.d(1),M=null),x[0]&2048&&ge(e,"opacity",A[11])},i:Ge,o:Ge,d(A){A&&d(e),S&&S.d(),s[25](null),k&&k.d(),M&&M.d(),y=!1,Jt(V)}}}function Fi(s,e,t){let r,o,n,i,u,{originalImage:c}=e,{processedResult:f}=e,{autoProceeds:m=!0}=e,{autoProceedDelay:p=2e3}=e;const b=Er();let w=!1,_=Is(0,{duration:1500,easing:to});is(s,_,Q=>t(13,u=Q));let y=Is(100,{duration:800,easing:dl});is(s,y,Q=>t(12,i=Q));let V=Is(0,{duration:600,easing:dl});is(s,V,Q=>t(11,n=Q));let S,k,M=!1,A=Math.floor(p/1e3),x,R=400;Cr(()=>{I(),U()});function I(){const Q=new Image;Q.onload=()=>{const te=Q.naturalWidth/Q.naturalHeight,oe=800/te;t(7,R=Math.max(300,Math.min(oe,window.innerHeight*.7))),console.log("ðŸ“ Container height calculated:",{imageSize:{width:Q.naturalWidth,height:Q.naturalHeight},aspectRatio:te,containerHeight:R})},Q.src=c.preview}async function U(){V.set(1),setTimeout(()=>{t(3,w=!0),y.set(0),_.set(1)},300),setTimeout(()=>{m&&(t(5,M=!0),B())},2e3)}function B(){x=setInterval(()=>{t(6,A--,A),A<=0&&(clearInterval(x),T())},1e3),k=setTimeout(()=>{T()},p)}function T(){z(),b("proceed",{action:"continue"})}function j(){z(),t(5,M=!1),b("stay")}async function G(){z(),Ai.info("Preparing download..."),b("proceed",{action:"download"})}function z(){k&&clearTimeout(k),x&&clearInterval(x)}let H=50,E=!1;function F(Q){if(!E)return;const te=S.getBoundingClientRect(),oe=(("touches"in Q?Q.touches[0].clientX:Q.clientX)-te.left)/te.width*100;t(8,H=Math.max(0,Math.min(100,oe)))}function P(){E=!0,z()}function N(){E=!1}const K=Q=>{Q.key==="ArrowLeft"?(Q.preventDefault(),t(8,H=Math.max(0,H-5))):Q.key==="ArrowRight"&&(Q.preventDefault(),t(8,H=Math.min(100,H+5)))};function q(Q){Cs[Q?"unshift":"push"](()=>{S=Q,t(4,S)})}const X=()=>b("proceed",{action:"refine"}),re=()=>b("proceed",{action:"continue"});return s.$$set=Q=>{"originalImage"in Q&&t(0,c=Q.originalImage),"processedResult"in Q&&t(23,f=Q.processedResult),"autoProceeds"in Q&&t(1,m=Q.autoProceeds),"autoProceedDelay"in Q&&t(2,p=Q.autoProceedDelay)},s.$$.update=()=>{s.$$.dirty[0]&8388608&&t(10,r=f.download_url),s.$$.dirty[0]&8388608&&t(9,o=f.processing_time||0)},[c,m,p,w,S,M,A,R,H,o,r,n,i,u,b,_,y,V,j,G,F,P,N,f,K,q,X,re]}class Bi extends Rs{constructor(e){super(),As(this,e,Fi,Vi,Ps,{originalImage:0,processedResult:23,autoProceeds:1,autoProceedDelay:2},null,[-1,-1])}}function ji(s,e,t){const r=s.slice();return r[21]=e[t],r[23]=t,r}function Ni(s){let e;return{c(){e=L("Ready to process image")},l(t){e=O(t,"Ready to process image")},m(t,r){Y(t,e,r)},p:Ge,d(t){t&&d(e)}}}function Li(s){let e;return{c(){e=L("Uploading image")},l(t){e=O(t,"Uploading image")},m(t,r){Y(t,e,r)},p:Ge,d(t){t&&d(e)}}}function Oi(s){let e;return{c(){e=L("Background removal failed")},l(t){e=O(t,"Background removal failed")},m(t,r){Y(t,e,r)},p:Ge,d(t){t&&d(e)}}}function zi(s){let e;return{c(){e=L("Background removal completed successfully")},l(t){e=O(t,"Background removal completed successfully")},m(t,r){Y(t,e,r)},p:Ge,d(t){t&&d(e)}}}function Ui(s){let e,t,r,o=Ho(s[5])+"",n,i;return{c(){e=L("Processing image, attempt "),t=L(s[3]),r=L(", "),n=L(o),i=L(" elapsed")},l(u){e=O(u,"Processing image, attempt "),t=O(u,s[3]),r=O(u,", "),n=O(u,o),i=O(u," elapsed")},m(u,c){Y(u,e,c),Y(u,t,c),Y(u,r,c),Y(u,n,c),Y(u,i,c)},p(u,c){c&8&&pe(t,u[3]),c&32&&o!==(o=Ho(u[5])+"")&&pe(n,o)},d(u){u&&(d(e),d(t),d(r),d(n),d(i))}}}function Yl(s){let e,t,r,o=Ho(s[5])+"",n,i=s[3]>1&&Kl(s);return{c(){e=h("div"),i&&i.c(),t=C(),r=h("span"),n=L(o),this.h()},l(u){e=g(u,"DIV",{class:!0});var c=v(e);i&&i.l(c),t=D(c),r=g(c,"SPAN",{});var f=v(r);n=O(f,o),f.forEach(d),c.forEach(d),this.h()},h(){a(e,"class","flex items-center space-x-2 text-xs text-dark-text-muted")},m(u,c){Y(u,e,c),i&&i.m(e,null),l(e,t),l(e,r),l(r,n)},p(u,c){u[3]>1?i?i.p(u,c):(i=Kl(u),i.c(),i.m(e,t)):i&&(i.d(1),i=null),c&32&&o!==(o=Ho(u[5])+"")&&pe(n,o)},d(u){u&&d(e),i&&i.d()}}}function Kl(s){let e,t,r;return{c(){e=h("span"),t=L("Attempt "),r=L(s[3]),this.h()},l(o){e=g(o,"SPAN",{class:!0});var n=v(e);t=O(n,"Attempt "),r=O(n,s[3]),n.forEach(d),this.h()},h(){a(e,"class","px-2 py-1 bg-yellow-400/20 text-yellow-400 rounded")},m(o,n){Y(o,e,n),l(e,t),l(e,r)},p(o,n){n&8&&pe(r,o[3])},d(o){o&&d(e)}}}function Jl(s){let e,t,r=Ho(s[4]*1e3)+"",o;return{c(){e=h("span"),t=L("Completed in "),o=L(r),this.h()},l(n){e=g(n,"SPAN",{class:!0});var i=v(e);t=O(i,"Completed in "),o=O(i,r),i.forEach(d),this.h()},h(){a(e,"class","text-xs text-green-400")},m(n,i){Y(n,e,i),l(e,t),l(e,o)},p(n,i){i&16&&r!==(r=Ho(n[4]*1e3)+"")&&pe(o,r)},d(n){n&&d(e)}}}function Xl(s){let e,t,r,o="Progress",n,i,u=Math.round(s[9])+"",c,f,m,p,b,w,_;return{c(){e=h("div"),t=h("div"),r=h("span"),r.textContent=o,n=C(),i=h("span"),c=L(u),f=L("%"),p=C(),b=h("div"),w=h("div"),_=h("div"),this.h()},l(y){e=g(y,"DIV",{class:!0});var V=v(e);t=g(V,"DIV",{class:!0});var S=v(t);r=g(S,"SPAN",{class:!0,"data-svelte-h":!0}),Z(r)!=="svelte-nbdke7"&&(r.textContent=o),n=D(S),i=g(S,"SPAN",{class:!0});var k=v(i);c=O(k,u),f=O(k,"%"),k.forEach(d),S.forEach(d),p=D(V),b=g(V,"DIV",{class:!0});var M=v(b);w=g(M,"DIV",{class:!0,style:!0});var A=v(w);_=g(A,"DIV",{class:!0}),v(_).forEach(d),A.forEach(d),M.forEach(d),V.forEach(d),this.h()},h(){a(r,"class","text-xs text-dark-text-muted"),a(i,"class",m="text-xs "+s[6].color+" svelte-vxne92"),a(t,"class","flex items-center justify-between mb-1"),a(_,"class","absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-shimmer svelte-vxne92"),a(w,"class","h-full transition-all duration-300 ease-out relative"),ge(w,"width",s[9]+"%"),ze(w,"bg-blue-400",s[1]==="uploading"),ze(w,"bg-magic-400",s[1]==="processing"),a(b,"class","h-2 bg-dark-base rounded-full overflow-hidden"),a(e,"class","mt-2")},m(y,V){Y(y,e,V),l(e,t),l(t,r),l(t,n),l(t,i),l(i,c),l(i,f),l(e,p),l(e,b),l(b,w),l(w,_)},p(y,V){V&512&&u!==(u=Math.round(y[9])+"")&&pe(c,u),V&64&&m!==(m="text-xs "+y[6].color+" svelte-vxne92")&&a(i,"class",m),V&512&&ge(w,"width",y[9]+"%"),V&2&&ze(w,"bg-blue-400",y[1]==="uploading"),V&2&&ze(w,"bg-magic-400",y[1]==="processing")},d(y){y&&d(e)}}}function Ql(s){let e,t='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>',r,o;return{c(){e=h("button"),e.innerHTML=t,this.h()},l(n){e=g(n,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-h4m568"&&(e.innerHTML=t),this.h()},h(){a(e,"class","flex-shrink-0 p-1 text-dark-text-muted hover:text-dark-text transition-colors")},m(n,i){Y(n,e,i),r||(o=se(e,"click",s[14]),r=!0)},p:Ge,d(n){n&&d(e),r=!1,o()}}}function Zl(s){let e,t='<div class="success-checkmark svelte-vxne92"><svg class="w-16 h-16 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" class="checkmark-path svelte-vxne92"></path></svg></div>';return{c(){e=h("div"),e.innerHTML=t,this.h()},l(r){e=g(r,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-cpexd1"&&(e.innerHTML=t),this.h()},h(){a(e,"class","mt-4 flex items-center justify-center")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function $l(s){let e,t=Ds(Array(6)),r=[];for(let o=0;o<t.length;o+=1)r[o]=Hi(ji(s,t,o));return{c(){e=h("div");for(let o=0;o<r.length;o+=1)r[o].c();this.h()},l(o){e=g(o,"DIV",{class:!0});var n=v(e);for(let i=0;i<r.length;i+=1)r[i].l(n);n.forEach(d),this.h()},h(){a(e,"class","processing-particles absolute inset-0 pointer-events-none overflow-hidden rounded-lg")},m(o,n){Y(o,e,n);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p:Ge,d(o){o&&d(e),To(r,o)}}}function Hi(s){let e;return{c(){e=h("div"),this.h()},l(t){e=g(t,"DIV",{class:!0,style:!0}),v(e).forEach(d),this.h()},h(){a(e,"class","particle absolute w-1 h-1 bg-magic-400 rounded-full opacity-60 svelte-vxne92"),ge(e,"left",10+s[23]*15+"%"),ge(e,"animation","float "+(2+s[23]*.3)+"s ease-in-out infinite"),ge(e,"animation-delay",s[23]*.2+"s")},m(t,r){Y(t,e,r)},p:Ge,d(t){t&&d(e)}}}function Gi(s){let e,t,r,o,n,i,u,c,f,m,p,b,w=(s[2]||"Ready")+"",_,y,V,S,k,M,A,x,R,I,U;function B(N,K){return N[1]==="processing"?Ui:N[1]==="success"?zi:N[1]==="error"?Oi:N[1]==="uploading"?Li:Ni}let T=B(s),j=T(s),G=s[1]==="processing"&&Yl(s),z=s[1]==="success"&&s[4]>0&&Jl(s),H=(s[1]==="uploading"||s[1]==="processing")&&Xl(s),E=s[0]&&(s[1]==="processing"||s[1]==="error")&&Ql(s),F=s[1]==="success"&&Zl(),P=s[1]==="processing"&&$l(s);return{c(){e=h("div"),t=h("div"),r=h("div"),o=Ce("svg"),n=Ce("path"),f=C(),m=h("div"),p=h("div"),b=h("span"),_=L(w),V=C(),S=h("span"),j.c(),k=C(),G&&G.c(),M=C(),z&&z.c(),A=C(),H&&H.c(),x=C(),E&&E.c(),R=C(),F&&F.c(),I=C(),P&&P.c(),this.h()},l(N){e=g(N,"DIV",{class:!0,style:!0,role:!0,"aria-live":!0,"aria-label":!0});var K=v(e);t=g(K,"DIV",{class:!0});var q=v(t);r=g(q,"DIV",{class:!0,style:!0});var X=v(r);o=De(X,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0,"aria-hidden":!0});var re=v(o);n=De(re,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(n).forEach(d),re.forEach(d),X.forEach(d),f=D(q),m=g(q,"DIV",{class:!0});var Q=v(m);p=g(Q,"DIV",{class:!0});var te=v(p);b=g(te,"SPAN",{class:!0});var ee=v(b);_=O(ee,w),ee.forEach(d),V=D(te),S=g(te,"SPAN",{class:!0});var oe=v(S);j.l(oe),oe.forEach(d),k=D(te),G&&G.l(te),M=D(te),z&&z.l(te),te.forEach(d),A=D(Q),H&&H.l(Q),Q.forEach(d),x=D(q),E&&E.l(q),q.forEach(d),R=D(K),F&&F.l(K),I=D(K),P&&P.l(K),K.forEach(d),this.h()},h(){a(n,"stroke-linecap","round"),a(n,"stroke-linejoin","round"),a(n,"stroke-width","2"),a(n,"d",i=en(s[6].icon)),a(o,"class",u="w-5 h-5 "+s[6].color+" svelte-vxne92"),a(o,"fill","none"),a(o,"stroke","currentColor"),a(o,"viewBox","0 0 24 24"),a(o,"aria-hidden","true"),ze(o,"animate-spin",s[1]==="processing"&&s[6].icon==="cog"),a(r,"class",c="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center "+s[6].bgColor+" svelte-vxne92"),ge(r,"box-shadow","0 0 "+s[8]*20+"px rgba(0, 255, 136, "+s[8]*.4+")"),a(b,"class",y="text-sm font-medium "+s[6].color+" svelte-vxne92"),a(S,"class","sr-only"),a(p,"class","flex items-center justify-between"),a(m,"class","flex-grow"),a(t,"class","flex items-center space-x-4 svelte-vxne92"),a(e,"class",U="processing-feedback transition-all duration-300 "+s[6].bgColor+" "+s[6].borderColor+" border rounded-lg p-4 svelte-vxne92"),ge(e,"transform","scale("+s[7]+")"),a(e,"role","status"),a(e,"aria-live","polite"),a(e,"aria-label","Background removal processing status")},m(N,K){Y(N,e,K),l(e,t),l(t,r),l(r,o),l(o,n),l(t,f),l(t,m),l(m,p),l(p,b),l(b,_),l(p,V),l(p,S),j.m(S,null),l(p,k),G&&G.m(p,null),l(p,M),z&&z.m(p,null),l(m,A),H&&H.m(m,null),l(t,x),E&&E.m(t,null),l(e,R),F&&F.m(e,null),l(e,I),P&&P.m(e,null)},p(N,[K]){K&64&&i!==(i=en(N[6].icon))&&a(n,"d",i),K&64&&u!==(u="w-5 h-5 "+N[6].color+" svelte-vxne92")&&a(o,"class",u),K&66&&ze(o,"animate-spin",N[1]==="processing"&&N[6].icon==="cog"),K&64&&c!==(c="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center "+N[6].bgColor+" svelte-vxne92")&&a(r,"class",c),K&256&&ge(r,"box-shadow","0 0 "+N[8]*20+"px rgba(0, 255, 136, "+N[8]*.4+")"),K&4&&w!==(w=(N[2]||"Ready")+"")&&pe(_,w),K&64&&y!==(y="text-sm font-medium "+N[6].color+" svelte-vxne92")&&a(b,"class",y),T===(T=B(N))&&j?j.p(N,K):(j.d(1),j=T(N),j&&(j.c(),j.m(S,null))),N[1]==="processing"?G?G.p(N,K):(G=Yl(N),G.c(),G.m(p,M)):G&&(G.d(1),G=null),N[1]==="success"&&N[4]>0?z?z.p(N,K):(z=Jl(N),z.c(),z.m(p,null)):z&&(z.d(1),z=null),N[1]==="uploading"||N[1]==="processing"?H?H.p(N,K):(H=Xl(N),H.c(),H.m(m,null)):H&&(H.d(1),H=null),N[0]&&(N[1]==="processing"||N[1]==="error")?E?E.p(N,K):(E=Ql(N),E.c(),E.m(t,null)):E&&(E.d(1),E=null),N[1]==="success"?F||(F=Zl(),F.c(),F.m(e,I)):F&&(F.d(1),F=null),N[1]==="processing"?P?P.p(N,K):(P=$l(N),P.c(),P.m(e,null)):P&&(P.d(1),P=null),K&64&&U!==(U="processing-feedback transition-all duration-300 "+N[6].bgColor+" "+N[6].borderColor+" border rounded-lg p-4 svelte-vxne92")&&a(e,"class",U),K&128&&ge(e,"transform","scale("+N[7]+")")},i:Ge,o:Ge,d(N){N&&d(e),j.d(),G&&G.d(),z&&z.d(),H&&H.d(),E&&E.d(),F&&F.d(),P&&P.d()}}}function Ho(s){const e=Math.floor(s/1e3),t=Math.floor(e/60),r=e%60;return t>0?`${t}:${r.toString().padStart(2,"0")}`:`${e}s`}function en(s){const e={upload:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12","upload-cloud":"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10",cog:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z","check-circle":"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z","exclamation-circle":"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"};return e[s]||e.upload}function qi(s,e,t){let r,o,n,i,{status:u="idle"}=e,{progress:c=0}=e,{message:f=""}=e,{attemptNumber:m=1}=e,{processingTime:p=0}=e,{showDetails:b=!1}=e,w=Is(0,{duration:300,easing:to});is(s,w,U=>t(9,i=U));let _=Is(1,{duration:800,easing:Di});is(s,_,U=>t(7,o=U));let y=Is(0,{duration:500,easing:to});is(s,y,U=>t(8,n=U));let V,S=0,k=0;Cr(()=>{u==="processing"&&(S=Date.now(),x())}),fl(()=>{A(),V&&cancelAnimationFrame(V)});function M(){let U;function B(T){U||(U=T);const j=T-U,G=1+.1*Math.sin(j*.003);_.set(G),u==="processing"&&(V=requestAnimationFrame(B))}V=requestAnimationFrame(B)}function A(){V&&cancelAnimationFrame(V),_.set(1)}function x(){function U(){u==="processing"&&(t(5,k=Date.now()-S),V=requestAnimationFrame(U))}u==="processing"&&(V=requestAnimationFrame(U))}const R={idle:{icon:"upload",color:"text-dark-text-muted",bgColor:"bg-dark-elevated",borderColor:"border-gray-600"},uploading:{icon:"upload-cloud",color:"text-blue-400",bgColor:"bg-blue-400/10",borderColor:"border-blue-400/30"},processing:{icon:"cog",color:"text-magic-400",bgColor:"bg-magic-400/10",borderColor:"border-magic-400/30"},success:{icon:"check-circle",color:"text-green-400",bgColor:"bg-green-400/10",borderColor:"border-green-400/30"},error:{icon:"exclamation-circle",color:"text-red-400",bgColor:"bg-red-400/10",borderColor:"border-red-400/30"}},I=()=>t(0,b=!b);return s.$$set=U=>{"status"in U&&t(1,u=U.status),"progress"in U&&t(13,c=U.progress),"message"in U&&t(2,f=U.message),"attemptNumber"in U&&t(3,m=U.attemptNumber),"processingTime"in U&&t(4,p=U.processingTime),"showDetails"in U&&t(0,b=U.showDetails)},s.$$.update=()=>{s.$$.dirty&8192&&w.set(c),s.$$.dirty&2&&(u==="processing"?(M(),y.set(.8)):(A(),y.set(0))),s.$$.dirty&2&&t(6,r=R[u])},[b,u,f,m,p,k,r,o,n,i,w,_,y,c,I]}class Wi extends Rs{constructor(e){super(),As(this,e,qi,Gi,Ps,{status:1,progress:13,message:2,attemptNumber:3,processingTime:4,showDetails:0})}}const Co=class Co{constructor(){}static getInstance(){return Co.instance||(Co.instance=new Co),Co.instance}classifyError(e,t){const r=typeof e=="string"?e:e.message,o=typeof e=="string"?"":e.stack||"";return this.isNetworkError(r,o)?this.createNetworkErrorClassification(r,t):this.isFileValidationError(r)?this.createFileValidationErrorClassification(r,t):this.isProcessingFailure(r)?this.createProcessingFailureClassification(r,t):this.isBrowserCompatibilityError(r,t==null?void 0:t.userAgent)?this.createBrowserCompatibilityClassification(r,t):this.isQuotaError(r)?this.createQuotaErrorClassification(r,t):this.isServerError(r)?this.createServerErrorClassification(r,t):this.createUnknownErrorClassification(r,t)}isNetworkError(e,t){return[/network/i,/connection/i,/timeout/i,/fetch.*failed/i,/cors/i,/net::/i,/ERR_INTERNET_DISCONNECTED/i,/ERR_NETWORK_CHANGED/i].some(o=>o.test(e)||o.test(t))}isFileValidationError(e){return[/invalid.*file/i,/unsupported.*format/i,/file.*too.*large/i,/file.*size/i,/corrupted.*file/i,/invalid.*image/i].some(r=>r.test(e))}isProcessingFailure(e){return[/processing.*failed/i,/background.*removal.*failed/i,/model.*error/i,/segmentation.*failed/i,/rembg.*error/i].some(r=>r.test(e))}isBrowserCompatibilityError(e,t){const o=[/clipboard.*not.*supported/i,/file.*api.*not.*supported/i,/canvas.*not.*supported/i,/webp.*not.*supported/i,/drag.*drop.*not.*supported/i].some(i=>i.test(e)),n=t&&(/MSIE|Trident/i.test(t)||/Chrome\/[4-6]\d/i.test(t)||/Firefox\/[3-5]\d/i.test(t));return o||!!n}isQuotaError(e){return[/quota.*exceeded/i,/rate.*limit/i,/too.*many.*requests/i,/429/,/storage.*full/i].some(r=>r.test(e))}isServerError(e){return[/5\d\d/,/server.*error/i,/internal.*error/i,/service.*unavailable/i,/gateway.*timeout/i].some(r=>r.test(e))}createNetworkErrorClassification(e,t){return{category:"network",severity:"medium",userMessage:"Connection issue detected. Please check your internet connection.",technicalMessage:e,recoverable:!0,suggestedActions:["Check your internet connection","Try again in a moment","Reload the page if the issue persists"],recommendedStrategy:"retry_original",displayDuration:5e3}}createFileValidationErrorClassification(e,t){const r=(t==null?void 0:t.fileSize)&&t.fileSize>10485760;return{category:"file_validation",severity:"low",userMessage:r?"Image file is too large. Please use a smaller image (under 10MB).":"This image format isn't supported. Please try a different image.",technicalMessage:e,recoverable:!0,suggestedActions:r?["Use an image under 10MB","Try compressing your image first"]:["Use JPG, PNG, or WebP format","Try a different image"],recommendedStrategy:r?"compress_image":"convert_format",displayDuration:6e3}}createProcessingFailureClassification(e,t){const r=(t==null?void 0:t.attempt)&&t.attempt>1;return{category:"processing_failure",severity:r?"high":"medium",userMessage:r?"We're having trouble processing this image. The AI model might be struggling with this particular image.":"Processing failed. This sometimes happens with complex images.",technicalMessage:e,recoverable:!r,suggestedActions:r?["Try a different image","Simplify the background if possible"]:["We'll try different processing methods","Please wait while we attempt recovery"],recommendedStrategy:r?"contact_support":"compress_image",displayDuration:r?8e3:4e3}}createBrowserCompatibilityClassification(e,t){return{category:"browser_compatibility",severity:"medium",userMessage:"Your browser doesn't support all the features needed. Please update your browser or try a different one.",technicalMessage:e,recoverable:!1,suggestedActions:["Update to the latest version of your browser","Try Chrome, Firefox, Safari, or Edge","Enable JavaScript if disabled"],recommendedStrategy:"try_different_browser",displayDuration:1e4}}createQuotaErrorClassification(e,t){return{category:"quota_exceeded",severity:"medium",userMessage:"Service is temporarily busy. Please wait a moment and try again.",technicalMessage:e,recoverable:!0,suggestedActions:["Wait a few minutes and try again","Avoid processing multiple images simultaneously"],recommendedStrategy:"retry_original",displayDuration:7e3}}createServerErrorClassification(e,t){return{category:"server_error",severity:"high",userMessage:"Our servers are experiencing issues. We're working to fix this.",technicalMessage:e,recoverable:!0,suggestedActions:["Try again in a few minutes","Reload the page if the issue persists"],recommendedStrategy:"retry_original",displayDuration:6e3}}createUnknownErrorClassification(e,t){return{category:"unknown",severity:"medium",userMessage:"Something unexpected happened. Please try again.",technicalMessage:e,recoverable:!0,suggestedActions:["Try again with the same image","Try a different image","Reload the page if issues continue"],recommendedStrategy:"retry_original",displayDuration:5e3}}getErrorColor(e){return{low:"text-yellow-400",medium:"text-orange-400",high:"text-red-400",critical:"text-red-500"}[e]}getErrorBackgroundColor(e){return{low:"bg-yellow-400/10",medium:"bg-orange-400/10",high:"bg-red-400/10",critical:"bg-red-500/10"}[e]}getErrorBorderColor(e){return{low:"border-yellow-400/30",medium:"border-orange-400/30",high:"border-red-400/30",critical:"border-red-500/30"}[e]}shouldAutoRetry(e){return e.recoverable&&e.severity!=="critical"&&["network","quota_exceeded","server_error"].includes(e.category)}getRetryDelay(e,t){return({network:1e3,quota_exceeded:3e3,server_error:2e3,processing_failure:1500}[e.category]||1e3)*Math.pow(1.5,t-1)+Math.random()*1e3}};or(Co,"instance");let bl=Co;const et=bl.getInstance();function tn(s,e,t){const r=s.slice();return r[18]=e[t],r}function sn(s){let e,t,r,o,n,i,u,c,f,m,p,b,w,_=mn(s[4].category)+"",y,V,S,k,M,A=s[4].userMessage+"",x,R,I,U,B,T,j,G="Dismiss",z,H,E,F,P='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',N,K,q,X,re,Q=(s[0].fileName||s[0].attempt&&s[0].attempt>1)&&rn(s),te=s[4].suggestedActions.length>0&&nn(s),ee=s[2]&&s[4].recoverable&&cn(s),oe=s[1]&&un(s),ne=s[1]&&s[5]&&dn(s),ke=s[3]&&s[4].displayDuration&&s[4].severity!=="critical"&&hn(s);return{c(){e=h("div"),t=h("div"),r=h("div"),o=h("div"),n=Ce("svg"),i=Ce("path"),m=C(),p=h("div"),b=h("div"),w=h("h3"),y=L(_),V=L(" Error"),k=C(),M=h("p"),x=L(A),R=C(),Q&&Q.c(),I=C(),te&&te.c(),U=C(),B=h("div"),ee&&ee.c(),T=C(),j=h("button"),j.textContent=G,z=C(),oe&&oe.c(),H=C(),E=h("div"),F=h("button"),F.innerHTML=P,N=C(),ne&&ne.c(),K=C(),ke&&ke.c(),this.h()},l(ae){e=g(ae,"DIV",{class:!0,style:!0});var be=v(e);t=g(be,"DIV",{class:!0});var Ie=v(t);r=g(Ie,"DIV",{class:!0});var J=v(r);o=g(J,"DIV",{class:!0});var Ae=v(o);n=De(Ae,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var _e=v(n);i=De(_e,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(i).forEach(d),_e.forEach(d),Ae.forEach(d),J.forEach(d),m=D(Ie),p=g(Ie,"DIV",{class:!0});var ce=v(p);b=g(ce,"DIV",{class:!0});var de=v(b);w=g(de,"H3",{class:!0});var ue=v(w);y=O(ue,_),V=O(ue," Error"),ue.forEach(d),k=D(de),M=g(de,"P",{class:!0});var ye=v(M);x=O(ye,A),ye.forEach(d),R=D(de),Q&&Q.l(de),de.forEach(d),I=D(ce),te&&te.l(ce),U=D(ce),B=g(ce,"DIV",{class:!0});var Re=v(B);ee&&ee.l(Re),T=D(Re),j=g(Re,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(j)!=="svelte-904fnz"&&(j.textContent=G),z=D(Re),oe&&oe.l(Re),Re.forEach(d),ce.forEach(d),H=D(Ie),E=g(Ie,"DIV",{class:!0});var Qe=v(E);F=g(Qe,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(F)!=="svelte-x2bwpo"&&(F.innerHTML=P),Qe.forEach(d),Ie.forEach(d),N=D(be),ne&&ne.l(be),K=D(be),ke&&ke.l(be),be.forEach(d),this.h()},h(){a(i,"stroke-linecap","round"),a(i,"stroke-linejoin","round"),a(i,"stroke-width","2"),a(i,"d",u=gn(s[4].category)),a(n,"class",c="w-6 h-6 "+et.getErrorColor(s[4].severity)+" svelte-o4la6q"),a(n,"fill","none"),a(n,"stroke","currentColor"),a(n,"viewBox","0 0 24 24"),a(o,"class",f="w-12 h-12 rounded-full "+et.getErrorBackgroundColor(s[4].severity)+" flex items-center justify-center svelte-o4la6q"),a(r,"class","flex-shrink-0"),a(w,"class",S="text-lg font-semibold "+et.getErrorColor(s[4].severity)+" mb-2 svelte-o4la6q"),a(M,"class","text-dark-text mb-3 leading-relaxed"),a(b,"class","mb-4"),a(j,"class","btn btn-outline border-gray-500 text-gray-400 hover:bg-gray-500 hover:text-white px-4 py-2 rounded-lg text-sm font-medium svelte-o4la6q"),a(B,"class","flex flex-wrap gap-3 svelte-o4la6q"),a(p,"class","flex-grow"),a(F,"class","text-dark-text-muted hover:text-dark-text p-1 rounded svelte-o4la6q"),a(E,"class","flex-shrink-0"),a(t,"class","flex items-start space-x-4"),a(e,"class",q="error-display "+et.getErrorBackgroundColor(s[4].severity)+" "+et.getErrorBorderColor(s[4].severity)+" border rounded-xl p-6 max-w-2xl mx-auto svelte-o4la6q"),ge(e,"opacity",s[7]),ge(e,"transform","translateY("+(1-s[8])*20+"px)")},m(ae,be){Y(ae,e,be),l(e,t),l(t,r),l(r,o),l(o,n),l(n,i),l(t,m),l(t,p),l(p,b),l(b,w),l(w,y),l(w,V),l(b,k),l(b,M),l(M,x),l(b,R),Q&&Q.m(b,null),l(p,I),te&&te.m(p,null),l(p,U),l(p,B),ee&&ee.m(B,null),l(B,T),l(B,j),l(B,z),oe&&oe.m(B,null),l(t,H),l(t,E),l(E,F),l(e,N),ne&&ne.m(e,null),l(e,K),ke&&ke.m(e,null),X||(re=[se(j,"click",s[12]),se(F,"click",s[12])],X=!0)},p(ae,be){be&16&&u!==(u=gn(ae[4].category))&&a(i,"d",u),be&16&&c!==(c="w-6 h-6 "+et.getErrorColor(ae[4].severity)+" svelte-o4la6q")&&a(n,"class",c),be&16&&f!==(f="w-12 h-12 rounded-full "+et.getErrorBackgroundColor(ae[4].severity)+" flex items-center justify-center svelte-o4la6q")&&a(o,"class",f),be&16&&_!==(_=mn(ae[4].category)+"")&&pe(y,_),be&16&&S!==(S="text-lg font-semibold "+et.getErrorColor(ae[4].severity)+" mb-2 svelte-o4la6q")&&a(w,"class",S),be&16&&A!==(A=ae[4].userMessage+"")&&pe(x,A),ae[0].fileName||ae[0].attempt&&ae[0].attempt>1?Q?Q.p(ae,be):(Q=rn(ae),Q.c(),Q.m(b,null)):Q&&(Q.d(1),Q=null),ae[4].suggestedActions.length>0?te?te.p(ae,be):(te=nn(ae),te.c(),te.m(p,U)):te&&(te.d(1),te=null),ae[2]&&ae[4].recoverable?ee?ee.p(ae,be):(ee=cn(ae),ee.c(),ee.m(B,T)):ee&&(ee.d(1),ee=null),ae[1]?oe?oe.p(ae,be):(oe=un(ae),oe.c(),oe.m(B,null)):oe&&(oe.d(1),oe=null),ae[1]&&ae[5]?ne?ne.p(ae,be):(ne=dn(ae),ne.c(),ne.m(e,K)):ne&&(ne.d(1),ne=null),ae[3]&&ae[4].displayDuration&&ae[4].severity!=="critical"?ke?ke.p(ae,be):(ke=hn(ae),ke.c(),ke.m(e,null)):ke&&(ke.d(1),ke=null),be&16&&q!==(q="error-display "+et.getErrorBackgroundColor(ae[4].severity)+" "+et.getErrorBorderColor(ae[4].severity)+" border rounded-xl p-6 max-w-2xl mx-auto svelte-o4la6q")&&a(e,"class",q),be&128&&ge(e,"opacity",ae[7]),be&256&&ge(e,"transform","translateY("+(1-ae[8])*20+"px)")},d(ae){ae&&d(e),Q&&Q.d(),te&&te.d(),ee&&ee.d(),oe&&oe.d(),ne&&ne.d(),ke&&ke.d(),X=!1,Jt(re)}}}function rn(s){let e,t,r=s[0].fileName&&on(s),o=s[0].attempt&&s[0].attempt>1&&ln(s);return{c(){e=h("div"),r&&r.c(),t=C(),o&&o.c(),this.h()},l(n){e=g(n,"DIV",{class:!0});var i=v(e);r&&r.l(i),t=D(i),o&&o.l(i),i.forEach(d),this.h()},h(){a(e,"class","text-sm text-dark-text-muted space-y-1")},m(n,i){Y(n,e,i),r&&r.m(e,null),l(e,t),o&&o.m(e,null)},p(n,i){n[0].fileName?r?r.p(n,i):(r=on(n),r.c(),r.m(e,t)):r&&(r.d(1),r=null),n[0].attempt&&n[0].attempt>1?o?o.p(n,i):(o=ln(n),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(n){n&&d(e),r&&r.d(),o&&o.d()}}}function on(s){let e,t,r="File:",o,n,i=s[0].fileName+"",u;return{c(){e=h("div"),t=h("span"),t.textContent=r,o=C(),n=h("span"),u=L(i),this.h()},l(c){e=g(c,"DIV",{class:!0});var f=v(e);t=g(f,"SPAN",{"data-svelte-h":!0}),Z(t)!=="svelte-g4vdly"&&(t.textContent=r),o=D(f),n=g(f,"SPAN",{class:!0});var m=v(n);u=O(m,i),m.forEach(d),f.forEach(d),this.h()},h(){a(n,"class","font-mono bg-dark-elevated px-2 py-1 rounded text-xs"),a(e,"class","flex items-center space-x-2")},m(c,f){Y(c,e,f),l(e,t),l(e,o),l(e,n),l(n,u)},p(c,f){f&1&&i!==(i=c[0].fileName+"")&&pe(u,i)},d(c){c&&d(e)}}}function ln(s){let e,t,r="Attempt:",o,n,i=s[0].attempt+"",u;return{c(){e=h("div"),t=h("span"),t.textContent=r,o=C(),n=h("span"),u=L(i),this.h()},l(c){e=g(c,"DIV",{class:!0});var f=v(e);t=g(f,"SPAN",{"data-svelte-h":!0}),Z(t)!=="svelte-c9sg9r"&&(t.textContent=r),o=D(f),n=g(f,"SPAN",{class:!0});var m=v(n);u=O(m,i),m.forEach(d),f.forEach(d),this.h()},h(){a(n,"class","font-mono bg-dark-elevated px-2 py-1 rounded text-xs"),a(e,"class","flex items-center space-x-2")},m(c,f){Y(c,e,f),l(e,t),l(e,o),l(e,n),l(n,u)},p(c,f){f&1&&i!==(i=c[0].attempt+"")&&pe(u,i)},d(c){c&&d(e)}}}function nn(s){let e,t,r="What you can do:",o,n,i=Ds(s[4].suggestedActions),u=[];for(let c=0;c<i.length;c+=1)u[c]=an(tn(s,i,c));return{c(){e=h("div"),t=h("h4"),t.textContent=r,o=C(),n=h("ul");for(let c=0;c<u.length;c+=1)u[c].c();this.h()},l(c){e=g(c,"DIV",{class:!0});var f=v(e);t=g(f,"H4",{class:!0,"data-svelte-h":!0}),Z(t)!=="svelte-x4n314"&&(t.textContent=r),o=D(f),n=g(f,"UL",{class:!0});var m=v(n);for(let p=0;p<u.length;p+=1)u[p].l(m);m.forEach(d),f.forEach(d),this.h()},h(){a(t,"class","text-sm font-medium text-dark-text mb-2"),a(n,"class","space-y-1"),a(e,"class","mb-4")},m(c,f){Y(c,e,f),l(e,t),l(e,o),l(e,n);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(n,null)},p(c,f){if(f&16){i=Ds(c[4].suggestedActions);let m;for(m=0;m<i.length;m+=1){const p=tn(c,i,m);u[m]?u[m].p(p,f):(u[m]=an(p),u[m].c(),u[m].m(n,null))}for(;m<u.length;m+=1)u[m].d(1);u.length=i.length}},d(c){c&&d(e),To(u,c)}}}function an(s){let e,t,r,o,n,i=s[18]+"",u,c;return{c(){e=h("li"),t=Ce("svg"),r=Ce("path"),o=C(),n=h("span"),u=L(i),c=C(),this.h()},l(f){e=g(f,"LI",{class:!0});var m=v(e);t=De(m,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var p=v(t);r=De(p,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(r).forEach(d),p.forEach(d),o=D(m),n=g(m,"SPAN",{});var b=v(n);u=O(b,i),b.forEach(d),c=D(m),m.forEach(d),this.h()},h(){a(r,"stroke-linecap","round"),a(r,"stroke-linejoin","round"),a(r,"stroke-width","2"),a(r,"d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"),a(t,"class","w-4 h-4 text-magic-400 mt-0.5 flex-shrink-0"),a(t,"fill","none"),a(t,"stroke","currentColor"),a(t,"viewBox","0 0 24 24"),a(e,"class","flex items-start space-x-2 text-sm text-dark-text-secondary")},m(f,m){Y(f,e,m),l(e,t),l(t,r),l(e,o),l(e,n),l(n,u),l(e,c)},p(f,m){m&16&&i!==(i=f[18]+"")&&pe(u,i)},d(f){f&&d(e)}}}function cn(s){let e,t,r,o,n,i,u;return{c(){e=h("button"),t=Ce("svg"),r=Ce("path"),o=L(`\r
              Try Again`),this.h()},l(c){e=g(c,"BUTTON",{class:!0});var f=v(e);t=De(f,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var m=v(t);r=De(m,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(r).forEach(d),m.forEach(d),o=O(f,`\r
              Try Again`),f.forEach(d),this.h()},h(){a(r,"stroke-linecap","round"),a(r,"stroke-linejoin","round"),a(r,"stroke-width","2"),a(r,"d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"),a(t,"class","w-4 h-4 mr-2"),a(t,"fill","none"),a(t,"stroke","currentColor"),a(t,"viewBox","0 0 24 24"),a(e,"class",n="btn btn-outline "+et.getErrorBorderColor(s[4].severity)+" "+et.getErrorColor(s[4].severity)+" hover:"+et.getErrorBackgroundColor(s[4].severity)+" px-4 py-2 rounded-lg text-sm font-medium svelte-o4la6q")},m(c,f){Y(c,e,f),l(e,t),l(t,r),l(e,o),i||(u=se(e,"click",s[11]),i=!0)},p(c,f){f&16&&n!==(n="btn btn-outline "+et.getErrorBorderColor(c[4].severity)+" "+et.getErrorColor(c[4].severity)+" hover:"+et.getErrorBackgroundColor(c[4].severity)+" px-4 py-2 rounded-lg text-sm font-medium svelte-o4la6q")&&a(e,"class",n)},d(c){c&&d(e),i=!1,u()}}}function un(s){let e,t,r,o,n=s[5]?"Hide":"Show",i,u,c,f;return{c(){e=h("button"),t=Ce("svg"),r=Ce("path"),o=C(),i=L(n),u=L(" Details"),this.h()},l(m){e=g(m,"BUTTON",{class:!0});var p=v(e);t=De(p,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var b=v(t);r=De(b,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(r).forEach(d),b.forEach(d),o=D(p),i=O(p,n),u=O(p," Details"),p.forEach(d),this.h()},h(){a(r,"stroke-linecap","round"),a(r,"stroke-linejoin","round"),a(r,"stroke-width","2"),a(r,"d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"),a(t,"class","w-4 h-4 mr-2"),a(t,"fill","none"),a(t,"stroke","currentColor"),a(t,"viewBox","0 0 24 24"),a(e,"class","btn btn-text text-dark-text-muted hover:text-dark-text px-4 py-2 rounded-lg text-sm svelte-o4la6q")},m(m,p){Y(m,e,p),l(e,t),l(t,r),l(e,o),l(e,i),l(e,u),c||(f=se(e,"click",s[13]),c=!0)},p(m,p){p&32&&n!==(n=m[5]?"Hide":"Show")&&pe(i,n)},d(m){m&&d(e),c=!1,f()}}}function dn(s){let e,t,r,o="Technical Information",n,i,u,c,f="Category:",m,p=s[4].category+"",b,w,_,y,V="Severity:",S,k=s[4].severity+"",M,A,x,R,I="Recoverable:",U,B=s[4].recoverable?"Yes":"No",T,j,G,z,H,E="Technical Message:",F,P,N=s[4].technicalMessage+"",K,q=s[4].recommendedStrategy&&fn(s);return{c(){e=h("div"),t=h("details"),r=h("summary"),r.textContent=o,n=C(),i=h("div"),u=h("div"),c=h("strong"),c.textContent=f,m=C(),b=L(p),w=C(),_=h("div"),y=h("strong"),y.textContent=V,S=C(),M=L(k),A=C(),x=h("div"),R=h("strong"),R.textContent=I,U=C(),T=L(B),j=C(),q&&q.c(),G=C(),z=h("div"),H=h("strong"),H.textContent=E,F=C(),P=h("pre"),K=L(N),this.h()},l(X){e=g(X,"DIV",{class:!0});var re=v(e);t=g(re,"DETAILS",{class:!0});var Q=v(t);r=g(Q,"SUMMARY",{class:!0,"data-svelte-h":!0}),Z(r)!=="svelte-tijuu7"&&(r.textContent=o),n=D(Q),i=g(Q,"DIV",{class:!0});var te=v(i);u=g(te,"DIV",{});var ee=v(u);c=g(ee,"STRONG",{"data-svelte-h":!0}),Z(c)!=="svelte-vdh0ps"&&(c.textContent=f),m=D(ee),b=O(ee,p),ee.forEach(d),w=D(te),_=g(te,"DIV",{});var oe=v(_);y=g(oe,"STRONG",{"data-svelte-h":!0}),Z(y)!=="svelte-1tjye7f"&&(y.textContent=V),S=D(oe),M=O(oe,k),oe.forEach(d),A=D(te),x=g(te,"DIV",{});var ne=v(x);R=g(ne,"STRONG",{"data-svelte-h":!0}),Z(R)!=="svelte-1200pla"&&(R.textContent=I),U=D(ne),T=O(ne,B),ne.forEach(d),j=D(te),q&&q.l(te),G=D(te),z=g(te,"DIV",{});var ke=v(z);H=g(ke,"STRONG",{"data-svelte-h":!0}),Z(H)!=="svelte-qmiw6"&&(H.textContent=E),F=D(ke),P=g(ke,"PRE",{class:!0});var ae=v(P);K=O(ae,N),ae.forEach(d),ke.forEach(d),te.forEach(d),Q.forEach(d),re.forEach(d),this.h()},h(){a(r,"class","text-sm font-medium text-dark-text cursor-pointer hover:text-magic-400 svelte-o4la6q"),a(P,"class","mt-1 p-2 bg-dark-base rounded text-xs overflow-x-auto svelte-o4la6q"),a(i,"class","mt-3 space-y-2 text-xs text-dark-text-muted"),a(t,"class","space-y-3 svelte-o4la6q"),a(e,"class","mt-6 pt-4 border-t border-gray-600")},m(X,re){Y(X,e,re),l(e,t),l(t,r),l(t,n),l(t,i),l(i,u),l(u,c),l(u,m),l(u,b),l(i,w),l(i,_),l(_,y),l(_,S),l(_,M),l(i,A),l(i,x),l(x,R),l(x,U),l(x,T),l(i,j),q&&q.m(i,null),l(i,G),l(i,z),l(z,H),l(z,F),l(z,P),l(P,K)},p(X,re){re&16&&p!==(p=X[4].category+"")&&pe(b,p),re&16&&k!==(k=X[4].severity+"")&&pe(M,k),re&16&&B!==(B=X[4].recoverable?"Yes":"No")&&pe(T,B),X[4].recommendedStrategy?q?q.p(X,re):(q=fn(X),q.c(),q.m(i,G)):q&&(q.d(1),q=null),re&16&&N!==(N=X[4].technicalMessage+"")&&pe(K,N)},d(X){X&&d(e),q&&q.d()}}}function fn(s){let e,t,r="Recommended Strategy:",o,n=s[4].recommendedStrategy+"",i;return{c(){e=h("div"),t=h("strong"),t.textContent=r,o=C(),i=L(n)},l(u){e=g(u,"DIV",{});var c=v(e);t=g(c,"STRONG",{"data-svelte-h":!0}),Z(t)!=="svelte-1fjhie8"&&(t.textContent=r),o=D(c),i=O(c,n),c.forEach(d)},m(u,c){Y(u,e,c),l(e,t),l(e,o),l(e,i)},p(u,c){c&16&&n!==(n=u[4].recommendedStrategy+"")&&pe(i,n)},d(u){u&&d(e)}}}function hn(s){let e,t,r;return{c(){e=h("div"),t=h("div"),this.h()},l(o){e=g(o,"DIV",{class:!0});var n=v(e);t=g(n,"DIV",{class:!0,style:!0}),v(t).forEach(d),n.forEach(d),this.h()},h(){a(t,"class",r="h-full "+et.getErrorBackgroundColor(s[4].severity)+" transition-all ease-linear svelte-o4la6q"),ge(t,"width","100%"),ge(t,"animation","countdown "+s[4].displayDuration+"ms linear"),a(e,"class","mt-4 h-1 bg-dark-base rounded-full overflow-hidden")},m(o,n){Y(o,e,n),l(e,t)},p(o,n){n&16&&r!==(r="h-full "+et.getErrorBackgroundColor(o[4].severity)+" transition-all ease-linear svelte-o4la6q")&&a(t,"class",r),n&16&&ge(t,"animation","countdown "+o[4].displayDuration+"ms linear")},d(o){o&&d(e)}}}function Yi(s){let e,t=s[6]&&s[4]&&sn(s);return{c(){t&&t.c(),e=cs()},l(r){t&&t.l(r),e=cs()},m(r,o){t&&t.m(r,o),Y(r,e,o)},p(r,[o]){r[6]&&r[4]?t?t.p(r,o):(t=sn(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ge,o:Ge,d(r){r&&d(e),t&&t.d(r)}}}function gn(s){const e={network:"M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0",file_validation:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",processing_failure:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z",browser_compatibility:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z",quota_exceeded:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z",server_error:"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2",unknown:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"};return e[s]||e.unknown}function mn(s){return s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}function Ki(s,e,t){let r,o,{error:n}=e,{context:i={}}=e,{showTechnicalDetails:u=!1}=e,{allowRetry:c=!0}=e,{autoHide:f=!0}=e;const m=Er();let p=Is(0,{duration:400,easing:to});is(s,p,x=>t(8,o=x));let b=Is(1,{duration:300,easing:to});is(s,b,x=>t(7,r=x));let w,_=!1,y,V=!0;Cr(()=>{p.set(1),S()});function S(){y&&clearTimeout(y),f&&(w!=null&&w.displayDuration)&&w.severity!=="critical"&&(y=setTimeout(()=>{M()},w.displayDuration))}function k(){m("retry")}function M(){y&&clearTimeout(y),b.set(0).then(()=>{t(6,V=!1),m("dismiss")})}function A(){t(5,_=!_),_&&m("showTechnical")}return s.$$set=x=>{"error"in x&&t(14,n=x.error),"context"in x&&t(0,i=x.context),"showTechnicalDetails"in x&&t(1,u=x.showTechnicalDetails),"allowRetry"in x&&t(2,c=x.allowRetry),"autoHide"in x&&t(3,f=x.autoHide)},s.$$.update=()=>{s.$$.dirty&16385&&(t(4,w=et.classifyError(n,i)),S())},[i,u,c,f,w,_,V,r,o,p,b,k,M,A,n]}class Ji extends Rs{constructor(e){super(),As(this,e,Ki,Yi,Ps,{error:14,context:0,showTechnicalDetails:1,allowRetry:2,autoHide:3})}}class Xi{constructor(){or(this,"isEnabled",!0);or(this,"sessionHash");or(this,"sessionStartTime");or(this,"sessionMetrics");this.sessionHash=this.generateSessionHash(),this.sessionStartTime=Date.now(),this.sessionMetrics={session_hash:this.sessionHash,start_time:this.sessionStartTime,images_processed:0,total_processing_time:0,successful_completions:0,failed_attempts:0,meets_continuity_target:!1,session_duration:0},this.initializeSession()}generateSessionHash(){const e=Date.now().toString(),t=Math.random().toString(36).substring(2),r=`${e}_${t}`;let o=0;for(let n=0;n<r.length;n++){const i=r.charCodeAt(n);o=(o<<5)-o+i,o=o&o}return`session_${Math.abs(o).toString(36)}`}async sendEvent(e){if(this.isEnabled)try{console.log("ðŸ“Š Analytics Event:",e)}catch(t){console.warn("Analytics event failed:",t)}}async initializeSession(){typeof window>"u"||await this.trackEvent("session_start",{user_agent:navigator.userAgent.substring(0,100),screen_resolution:`${screen.width}x${screen.height}`,viewport_size:`${window.innerWidth}x${window.innerHeight}`,referrer:(typeof document<"u"?document.referrer:"")||"direct",timestamp:new Date().toISOString()})}async trackEvent(e,t){const r={event_type:e,session_hash:this.sessionHash,timestamp:new Date().toISOString(),data:t||{}};await this.sendEvent(r)}async trackUniqueUser(e){await this.trackEvent("unique_session",{referrer:e||(typeof document<"u"?document.referrer:"")||"direct",is_return_user:this.isReturnUser()})}async trackProcessingStart(e,t){this.sessionMetrics.images_processed++,await this.trackEvent("processing_start",{input_method:t,file_size:e.file.size,file_type:e.file.type,image_dimensions:e.dimensions})}async trackTaskCompletion(e,t,r){this.sessionMetrics.total_processing_time+=t,e?this.sessionMetrics.successful_completions++:this.sessionMetrics.failed_attempts++,await this.trackEvent("task_completion",{success:e,processing_time_seconds:t,under_5_seconds:t<5,error_type:r?this.classifyError(r):void 0})}async trackBatchCompletion(e,t){const r=e>0,o=t>0?e/t*100:0;this.sessionMetrics.images_processed+=t,this.sessionMetrics.successful_completions+=e,this.sessionMetrics.failed_attempts+=t-e,await this.trackEvent("batch_completion",{successful_count:e,total_images:t,completion_rate:o,success:r,batch_size:t})}async trackSessionContinuity(){this.sessionMetrics.meets_continuity_target=this.sessionMetrics.images_processed>=2,await this.trackEvent("session_continuity",{images_processed:this.sessionMetrics.images_processed,meets_target:this.sessionMetrics.meets_continuity_target,avg_processing_time:this.sessionMetrics.total_processing_time/Math.max(1,this.sessionMetrics.successful_completions)})}async trackDownload(e,t){await this.trackEvent("download",{format:e,file_size:t,time_to_download:Date.now()-this.sessionStartTime})}async trackProcessAnother(){await this.trackEvent("process_another",{session_images_count:this.sessionMetrics.images_processed,session_duration:Date.now()-this.sessionStartTime})}async trackNPSResponse(e,t){await this.trackEvent("nps_response",{score:e,has_feedback:!!t,feedback_length:(t==null?void 0:t.length)||0,session_images_processed:this.sessionMetrics.images_processed})}async trackFeedbackSubmission(e,t){await this.trackEvent("feedback_submission",{feedback_type:e,content_length:t.length,session_context:{images_processed:this.sessionMetrics.images_processed,successful_completions:this.sessionMetrics.successful_completions,failed_attempts:this.sessionMetrics.failed_attempts}})}async endSession(){this.sessionMetrics.session_duration=Date.now()-this.sessionStartTime,await this.trackEvent("session_end",{session_summary:this.sessionMetrics,completion_rate:this.sessionMetrics.successful_completions/Math.max(1,this.sessionMetrics.images_processed),avg_processing_time:this.sessionMetrics.total_processing_time/Math.max(1,this.sessionMetrics.successful_completions)})}isReturnUser(){return typeof window>"u"?!1:localStorage.getItem("charactercut_visited")?!0:(localStorage.setItem("charactercut_visited","1"),!1)}classifyError(e){const t=e.toLowerCase();return t.includes("network")||t.includes("fetch")?"network":t.includes("size")||t.includes("large")?"file_size":t.includes("format")||t.includes("type")?"file_format":t.includes("timeout")?"timeout":"unknown"}get sessionId(){return this.sessionHash}get metrics(){return{...this.sessionMetrics}}setEnabled(e){this.isEnabled=e}}const ut=new Xi;typeof window<"u"&&window.addEventListener("beforeunload",()=>{ut.endSession()});function vn(s,e,t){const r=s.slice();return r[22]=e[t],r[24]=t,r}function pn(s){let e;function t(n,i){return n[5]?Qi:Zi}let r=t(s),o=r(s);return{c(){e=h("div"),o.c(),this.h()},l(n){e=g(n,"DIV",{class:!0,style:!0});var i=v(e);o.l(i),i.forEach(d),this.h()},h(){a(e,"class","nps-survey fixed bottom-6 right-6 max-w-sm bg-dark-elevated border border-magic-400/20 rounded-xl p-6 shadow-2xl z-50 svelte-gf0zay"),ge(e,"opacity",s[7]),ge(e,"transform","translateY("+(1-s[8])*20+"px)")},m(n,i){Y(n,e,i),o.m(e,null)},p(n,i){r===(r=t(n))&&o?o.p(n,i):(o.d(1),o=r(n),o&&(o.c(),o.m(e,null))),i&128&&ge(e,"opacity",n[7]),i&256&&ge(e,"transform","translateY("+(1-n[8])*20+"px)")},d(n){n&&d(e),o.d()}}}function Qi(s){let e,t,r='<svg class="w-6 h-6 text-green-400 svelte-gf0zay" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" class="svelte-gf0zay"></path></svg>',o,n,i='<h3 class="text-lg font-semibold text-green-400 mb-1 svelte-gf0zay">Thank you!</h3> <p class="text-sm text-dark-text-secondary svelte-gf0zay">Your feedback helps us make CharacterCut better for all developers.</p>',u,c=s[1]!==null&&s[1]>=9&&bn();return{c(){e=h("div"),t=h("div"),t.innerHTML=r,o=C(),n=h("div"),n.innerHTML=i,u=C(),c&&c.c(),this.h()},l(f){e=g(f,"DIV",{class:!0});var m=v(e);t=g(m,"DIV",{class:!0,"data-svelte-h":!0}),Z(t)!=="svelte-1bnve69"&&(t.innerHTML=r),o=D(m),n=g(m,"DIV",{class:!0,"data-svelte-h":!0}),Z(n)!=="svelte-czl7e"&&(n.innerHTML=i),u=D(m),c&&c.l(m),m.forEach(d),this.h()},h(){a(t,"class","w-12 h-12 mx-auto rounded-full bg-green-400/20 flex items-center justify-center svelte-gf0zay"),a(n,"class","svelte-gf0zay"),a(e,"class","text-center space-y-3 svelte-gf0zay")},m(f,m){Y(f,e,m),l(e,t),l(e,o),l(e,n),l(e,u),c&&c.m(e,null)},p(f,m){f[1]!==null&&f[1]>=9?c||(c=bn(),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},d(f){f&&d(e),c&&c.d()}}}function Zi(s){let e,t,r,o='<h3 class="text-lg font-semibold text-magic-gradient mb-1 svelte-gf0zay">Quick feedback?</h3> <p class="text-sm text-dark-text-secondary svelte-gf0zay">Help us improve CharacterCut for developers like you</p>',n,i,u='<svg class="w-4 h-4 svelte-gf0zay" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-gf0zay"></path></svg>',c,f,m,p="How likely are you to recommend CharacterCut to other developers?",b,w,_,y,V,S='<span class="svelte-gf0zay">Not likely</span> <span class="svelte-gf0zay">Very likely</span>',k,M,A,x,R=Ds(Array(11)),I=[];for(let T=0;T<R.length;T+=1)I[T]=_n(vn(s,R,T));let U=s[3]&&s[1]!==null&&kn(s),B=s[1]!==null&&yn(s);return{c(){e=h("div"),t=h("div"),r=h("div"),r.innerHTML=o,n=C(),i=h("button"),i.innerHTML=u,c=C(),f=h("div"),m=h("p"),m.textContent=p,b=C(),w=h("div"),_=h("div");for(let T=0;T<I.length;T+=1)I[T].c();y=C(),V=h("div"),V.innerHTML=S,k=C(),U&&U.c(),M=C(),B&&B.c(),this.h()},l(T){e=g(T,"DIV",{class:!0});var j=v(e);t=g(j,"DIV",{class:!0});var G=v(t);r=g(G,"DIV",{class:!0,"data-svelte-h":!0}),Z(r)!=="svelte-1034g7d"&&(r.innerHTML=o),n=D(G),i=g(G,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(i)!=="svelte-182shzu"&&(i.innerHTML=u),G.forEach(d),c=D(j),f=g(j,"DIV",{class:!0});var z=v(f);m=g(z,"P",{class:!0,"data-svelte-h":!0}),Z(m)!=="svelte-16p3lp3"&&(m.textContent=p),b=D(z),w=g(z,"DIV",{class:!0});var H=v(w);_=g(H,"DIV",{class:!0});var E=v(_);for(let F=0;F<I.length;F+=1)I[F].l(E);E.forEach(d),y=D(H),V=g(H,"DIV",{class:!0,"data-svelte-h":!0}),Z(V)!=="svelte-qpw09z"&&(V.innerHTML=S),H.forEach(d),z.forEach(d),k=D(j),U&&U.l(j),M=D(j),B&&B.l(j),j.forEach(d),this.h()},h(){a(r,"class","svelte-gf0zay"),a(i,"class","text-dark-text-muted hover:text-dark-text p-1 rounded transition-colors svelte-gf0zay"),a(t,"class","flex items-start justify-between svelte-gf0zay"),a(m,"class","text-sm text-dark-text svelte-gf0zay"),a(_,"class","grid grid-cols-11 gap-1 svelte-gf0zay"),a(V,"class","flex justify-between text-xs text-dark-text-muted svelte-gf0zay"),a(w,"class","space-y-2 svelte-gf0zay"),a(f,"class","space-y-3 svelte-gf0zay"),a(e,"class","space-y-4 svelte-gf0zay")},m(T,j){Y(T,e,j),l(e,t),l(t,r),l(t,n),l(t,i),l(e,c),l(e,f),l(f,m),l(f,b),l(f,w),l(w,_);for(let G=0;G<I.length;G+=1)I[G]&&I[G].m(_,null);l(w,y),l(w,V),l(e,k),U&&U.m(e,null),l(e,M),B&&B.m(e,null),A||(x=se(i,"click",s[13]),A=!0)},p(T,j){if(j&2050){R=Ds(Array(11));let G;for(G=0;G<R.length;G+=1){const z=vn(T,R,G);I[G]?I[G].p(z,j):(I[G]=_n(z),I[G].c(),I[G].m(_,null))}for(;G<I.length;G+=1)I[G].d(1);I.length=R.length}T[3]&&T[1]!==null?U?U.p(T,j):(U=kn(T),U.c(),U.m(e,M)):U&&(U.d(1),U=null),T[1]!==null?B?B.p(T,j):(B=yn(T),B.c(),B.m(e,null)):B&&(B.d(1),B=null)},d(T){T&&d(e),To(I,T),U&&U.d(),B&&B.d(),A=!1,x()}}}function bn(s){let e,t="ðŸš€ Consider sharing CharacterCut with your developer community!";return{c(){e=h("div"),e.textContent=t,this.h()},l(r){e=g(r,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-fnbpm1"&&(e.textContent=t),this.h()},h(){a(e,"class","text-xs text-magic-300 svelte-gf0zay")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function _n(s){let e,t,r,o,n;function i(){return s[17](s[24])}return{c(){e=h("button"),t=L(s[24]),r=C(),this.h()},l(u){e=g(u,"BUTTON",{class:!0});var c=v(e);t=O(c,s[24]),r=D(c),c.forEach(d),this.h()},h(){a(e,"class","score-button w-8 h-8 rounded-md border text-xs font-medium transition-all svelte-gf0zay"),ze(e,"selected",s[1]===s[24]),ze(e,"hover-effect",s[1]!==s[24]),ze(e,"border-magic-400",s[1]===s[24]),ze(e,"bg-magic-400",s[1]===s[24]),ze(e,"text-white",s[1]===s[24]),ze(e,"border-gray-600",s[1]!==s[24]),ze(e,"text-dark-text-muted",s[1]!==s[24]),ze(e,"hover:border-magic-400",s[1]!==s[24]),ze(e,"hover:text-magic-400",s[1]!==s[24])},m(u,c){Y(u,e,c),l(e,t),l(e,r),o||(n=se(e,"click",i),o=!0)},p(u,c){s=u,c&2&&ze(e,"selected",s[1]===s[24]),c&2&&ze(e,"hover-effect",s[1]!==s[24]),c&2&&ze(e,"border-magic-400",s[1]===s[24]),c&2&&ze(e,"bg-magic-400",s[1]===s[24]),c&2&&ze(e,"text-white",s[1]===s[24]),c&2&&ze(e,"border-gray-600",s[1]!==s[24]),c&2&&ze(e,"text-dark-text-muted",s[1]!==s[24]),c&2&&ze(e,"hover:border-magic-400",s[1]!==s[24]),c&2&&ze(e,"hover:text-magic-400",s[1]!==s[24])},d(u){u&&d(e),o=!1,n()}}}function kn(s){let e,t,r,o,n=En(s[1])+"",i,u,c,f,m,p=s[6]&&wn(s);return{c(){e=h("div"),p&&p.c(),t=C(),r=h("div"),o=h("label"),i=L(n),u=C(),c=h("textarea"),this.h()},l(b){e=g(b,"DIV",{class:!0});var w=v(e);p&&p.l(w),t=D(w),r=g(w,"DIV",{class:!0});var _=v(r);o=g(_,"LABEL",{class:!0});var y=v(o);i=O(y,n),y.forEach(d),u=D(_),c=g(_,"TEXTAREA",{placeholder:!0,class:!0,rows:!0}),v(c).forEach(d),_.forEach(d),w.forEach(d),this.h()},h(){a(o,"class","block text-sm text-dark-text mb-2 svelte-gf0zay"),a(c,"placeholder","Your thoughts help us improve..."),a(c,"class","w-full px-3 py-2 bg-dark-base border border-gray-600 rounded-lg text-dark-text placeholder-dark-text-muted text-sm resize-none focus:border-magic-400 focus:outline-none svelte-gf0zay"),a(c,"rows","3"),a(r,"class","svelte-gf0zay"),a(e,"class","space-y-3 pt-2 border-t border-gray-700 svelte-gf0zay")},m(b,w){Y(b,e,w),p&&p.m(e,null),l(e,t),l(e,r),l(r,o),l(o,i),l(r,u),l(r,c),os(c,s[2]),f||(m=se(c,"input",s[18]),f=!0)},p(b,w){b[6]?p?p.p(b,w):(p=wn(b),p.c(),p.m(e,t)):p&&(p.d(1),p=null),w&2&&n!==(n=En(b[1])+"")&&pe(i,n),w&4&&os(c,b[2])},d(b){b&&d(e),p&&p.d(),f=!1,m()}}}function wn(s){let e,t=s[6]==="promoter"?"ðŸŽ‰ Promoter":s[6]==="passive"?"ðŸ˜ Passive":"ðŸ˜Ÿ Detractor",r,o;return{c(){e=h("div"),r=L(t),this.h()},l(n){e=g(n,"DIV",{class:!0});var i=v(e);r=O(i,t),i.forEach(d),this.h()},h(){a(e,"class",o="text-xs "+s[14][s[6]]+" px-2 py-1 border rounded text-center svelte-gf0zay")},m(n,i){Y(n,e,i),l(e,r)},p(n,i){i&64&&t!==(t=n[6]==="promoter"?"ðŸŽ‰ Promoter":n[6]==="passive"?"ðŸ˜ Passive":"ðŸ˜Ÿ Detractor")&&pe(r,t),i&64&&o!==(o="text-xs "+n[14][n[6]]+" px-2 py-1 border rounded text-center svelte-gf0zay")&&a(e,"class",o)},d(n){n&&d(e)}}}function yn(s){let e,t,r,o,n="Skip",i,u;function c(p,b){return p[4]?ec:$i}let f=c(s),m=f(s);return{c(){e=h("div"),t=h("button"),m.c(),r=C(),o=h("button"),o.textContent=n,this.h()},l(p){e=g(p,"DIV",{class:!0});var b=v(e);t=g(b,"BUTTON",{class:!0});var w=v(t);m.l(w),w.forEach(d),r=D(b),o=g(b,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(o)!=="svelte-1xvqh9h"&&(o.textContent=n),b.forEach(d),this.h()},h(){t.disabled=s[4],a(t,"class","flex-1 btn btn-magic py-2 px-4 rounded-lg text-sm font-medium disabled:opacity-50 svelte-gf0zay"),a(o,"class","px-4 py-2 text-dark-text-muted hover:text-dark-text transition-colors text-sm svelte-gf0zay"),a(e,"class","flex space-x-2 pt-2 svelte-gf0zay")},m(p,b){Y(p,e,b),l(e,t),m.m(t,null),l(e,r),l(e,o),i||(u=[se(t,"click",s[12]),se(o,"click",s[13])],i=!0)},p(p,b){f!==(f=c(p))&&(m.d(1),m=f(p),m&&(m.c(),m.m(t,null))),b&16&&(t.disabled=p[4])},d(p){p&&d(e),m.d(),i=!1,Jt(u)}}}function $i(s){let e;return{c(){e=L("Submit")},l(t){e=O(t,"Submit")},m(t,r){Y(t,e,r)},d(t){t&&d(e)}}}function ec(s){let e,t,r;return{c(){e=Ce("svg"),t=Ce("path"),r=L(`\r
                Submitting...`),this.h()},l(o){e=De(o,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var n=v(e);t=De(n,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0,class:!0}),v(t).forEach(d),n.forEach(d),r=O(o,`\r
                Submitting...`),this.h()},h(){a(t,"stroke-linecap","round"),a(t,"stroke-linejoin","round"),a(t,"stroke-width","2"),a(t,"d","M12 6v6m0 0v6m0-6h6m-6 0H6"),a(t,"class","svelte-gf0zay"),a(e,"class","w-4 h-4 mr-2 animate-spin svelte-gf0zay"),a(e,"fill","none"),a(e,"stroke","currentColor"),a(e,"viewBox","0 0 24 24")},m(o,n){Y(o,e,n),l(e,t),Y(o,r,n)},d(o){o&&(d(e),d(r))}}}function tc(s){let e,t=s[0]&&pn(s);return{c(){t&&t.c(),e=cs()},l(r){t&&t.l(r),e=cs()},m(r,o){t&&t.m(r,o),Y(r,e,o)},p(r,[o]){r[0]?t?t.p(r,o):(t=pn(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ge,o:Ge,d(r){r&&d(e),t&&t.d(r)}}}function sc(s){return s>=9?"promoter":s>=7?"passive":"detractor"}function En(s){return s>=9?"What did you love most about CharacterCut?":s>=7?"What would make CharacterCut even better?":"What can we improve to make this more useful for you?"}function rc(s,e,t){let r,o,n,{visible:i=!1}=e,{imagesProcessed:u=0}=e,{autoShowDelay:c=5e3}=e;const f=Er();let m=null,p="",b=!1,w=!1,_=!1,y=Is(0,{duration:400,easing:to});is(s,y,I=>t(8,n=I));let V=Is(1,{duration:300,easing:to});is(s,V,I=>t(7,o=I)),Cr(()=>{i&&y.set(1)});function S(I){t(1,m=I),t(3,b=!0)}async function k(){if(m!==null){t(4,w=!0);try{await ut.trackNPSResponse(m,p),f("submit",{score:m,feedback:p.trim()||void 0}),t(5,_=!0),setTimeout(()=>{M()},2e3)}catch(I){console.error("Failed to submit NPS:",I),t(5,_=!0),setTimeout(()=>{M()},2e3)}finally{t(4,w=!1)}}}async function M(){V.set(0).then(()=>{t(0,i=!1),f("dismiss")})}const A={promoter:"text-green-400 border-green-400/30",passive:"text-yellow-400 border-yellow-400/30",detractor:"text-red-400 border-red-400/30"},x=I=>S(I);function R(){p=this.value,t(2,p)}return s.$$set=I=>{"visible"in I&&t(0,i=I.visible),"imagesProcessed"in I&&t(15,u=I.imagesProcessed),"autoShowDelay"in I&&t(16,c=I.autoShowDelay)},s.$$.update=()=>{s.$$.dirty&2&&t(6,r=m!==null?sc(m):null),s.$$.dirty&1&&i&&y.set(1)},[i,m,p,b,w,_,r,o,n,y,V,S,k,M,A,u,c,x,R]}class oc extends Rs{constructor(e){super(),As(this,e,rc,tc,Ps,{visible:0,imagesProcessed:15,autoShowDelay:16})}}function Cn(s,e,t){const r=s.slice();return r[23]=e[t][0],r[24]=e[t][1],r}function Dn(s){let e,t;function r(i,u){return i[7]?lc:nc}let o=r(s),n=o(s);return{c(){e=h("div"),t=h("div"),n.c(),this.h()},l(i){e=g(i,"DIV",{class:!0});var u=v(e);t=g(u,"DIV",{class:!0});var c=v(t);n.l(c),c.forEach(d),u.forEach(d),this.h()},h(){a(t,"class","feedback-modal bg-dark-elevated border border-magic-400/20 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto svelte-1adc9lu"),a(e,"class","fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50")},m(i,u){Y(i,e,u),l(e,t),n.m(t,null)},p(i,u){o===(o=r(i))&&n?n.p(i,u):(n.d(1),n=o(i),n&&(n.c(),n.m(t,null)))},d(i){i&&d(e),n.d()}}}function lc(s){let e,t,r='<svg class="w-8 h-8 text-green-400 svelte-1adc9lu" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" class="svelte-1adc9lu"></path></svg>',o,n,i,u="Thank you for your feedback!",c,f,m,p,b,w="ðŸš€ Keep an eye out for improvements based on your suggestions!",_=s[4]&&In();return{c(){e=h("div"),t=h("div"),t.innerHTML=r,o=C(),n=h("div"),i=h("h3"),i.textContent=u,c=C(),f=h("p"),m=L(`Your insights help us make CharacterCut better for developers everywhere.\r
              `),_&&_.c(),p=C(),b=h("div"),b.textContent=w,this.h()},l(y){e=g(y,"DIV",{class:!0});var V=v(e);t=g(V,"DIV",{class:!0,"data-svelte-h":!0}),Z(t)!=="svelte-19zowm5"&&(t.innerHTML=r),o=D(V),n=g(V,"DIV",{class:!0});var S=v(n);i=g(S,"H3",{class:!0,"data-svelte-h":!0}),Z(i)!=="svelte-1bd7jer"&&(i.textContent=u),c=D(S),f=g(S,"P",{class:!0});var k=v(f);m=O(k,`Your insights help us make CharacterCut better for developers everywhere.\r
              `),_&&_.l(k),k.forEach(d),S.forEach(d),p=D(V),b=g(V,"DIV",{class:!0,"data-svelte-h":!0}),Z(b)!=="svelte-1jbg583"&&(b.textContent=w),V.forEach(d),this.h()},h(){a(t,"class","w-16 h-16 mx-auto rounded-full bg-green-400/20 flex items-center justify-center svelte-1adc9lu"),a(i,"class","text-xl font-semibold text-green-400 mb-2 svelte-1adc9lu"),a(f,"class","text-dark-text-secondary svelte-1adc9lu"),a(n,"class","svelte-1adc9lu"),a(b,"class","text-sm text-magic-300 svelte-1adc9lu"),a(e,"class","p-8 text-center space-y-4 svelte-1adc9lu")},m(y,V){Y(y,e,V),l(e,t),l(e,o),l(e,n),l(n,i),l(n,c),l(n,f),l(f,m),_&&_.m(f,null),l(e,p),l(e,b)},p(y,V){y[4]?_||(_=In(),_.c(),_.m(f,null)):_&&(_.d(1),_=null)},d(y){y&&d(e),_&&_.d()}}}function nc(s){let e,t,r,o='<h3 class="text-xl font-semibold text-magic-gradient mb-2 svelte-1adc9lu">Share Your Feedback</h3> <p class="text-sm text-dark-text-secondary svelte-1adc9lu">Help us make CharacterCut better for developers like you</p>',n,i,u='<svg class="w-5 h-5 svelte-1adc9lu" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-1adc9lu"></path></svg>',c,f,m,p="What type of feedback is this?",b,w,_,y,V,S,k="Your feedback",M,A,x,R,I=s[8]<10?"(minimum 10)":"",U,B,T,j,G,z,H,E,F="Email (optional)",P,N,K,q,X="Only provide if you'd like us to follow up. We respect your privacy.",re,Q,te,ee,oe,ne,ke="Include technical context (helps us understand your situation better)",ae,be=s[5]&&Object.keys(s[1]).length>0,Ie,J,Ae,_e,ce,de,ue="Cancel",ye,Re,Qe=Ds(Object.entries(s[11])),Ue=[];for(let me=0;me<Qe.length;me+=1)Ue[me]=Sn(Cn(s,Qe,me));let Te=s[9].examples.length>0&&Mn(s),je=be&&Tn(s);function At(me,Se){return me[6]?ic:ac}let jt=At(s),qe=jt(s);return{c(){e=h("div"),t=h("div"),r=h("div"),r.innerHTML=o,n=C(),i=h("button"),i.innerHTML=u,c=C(),f=h("div"),m=h("label"),m.textContent=p,b=C(),w=h("div");for(let me=0;me<Ue.length;me+=1)Ue[me].c();_=C(),y=h("div"),V=h("div"),S=h("label"),S.textContent=k,M=C(),A=h("span"),x=L(s[8]),R=L(" characters "),U=L(I),B=C(),T=h("textarea"),G=C(),Te&&Te.c(),z=C(),H=h("div"),E=h("label"),E.textContent=F,P=C(),N=h("input"),K=C(),q=h("p"),q.textContent=X,re=C(),Q=h("div"),te=h("label"),ee=h("input"),oe=C(),ne=h("span"),ne.textContent=ke,ae=C(),je&&je.c(),Ie=C(),J=h("div"),Ae=h("button"),qe.c(),ce=C(),de=h("button"),de.textContent=ue,this.h()},l(me){e=g(me,"DIV",{class:!0});var Se=v(e);t=g(Se,"DIV",{class:!0});var Pe=v(t);r=g(Pe,"DIV",{class:!0,"data-svelte-h":!0}),Z(r)!=="svelte-179tctb"&&(r.innerHTML=o),n=D(Pe),i=g(Pe,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(i)!=="svelte-1jbsco1"&&(i.innerHTML=u),Pe.forEach(d),c=D(Se),f=g(Se,"DIV",{class:!0});var at=v(f);m=g(at,"LABEL",{class:!0,"data-svelte-h":!0}),Z(m)!=="svelte-p24gya"&&(m.textContent=p),b=D(at),w=g(at,"DIV",{class:!0});var pt=v(w);for(let ct=0;ct<Ue.length;ct+=1)Ue[ct].l(pt);pt.forEach(d),at.forEach(d),_=D(Se),y=g(Se,"DIV",{class:!0});var nt=v(y);V=g(nt,"DIV",{class:!0});var us=v(V);S=g(us,"LABEL",{class:!0,"data-svelte-h":!0}),Z(S)!=="svelte-103pnj1"&&(S.textContent=k),M=D(us),A=g(us,"SPAN",{class:!0});var mt=v(A);x=O(mt,s[8]),R=O(mt," characters "),U=O(mt,I),mt.forEach(d),us.forEach(d),B=D(nt),T=g(nt,"TEXTAREA",{placeholder:!0,class:!0,rows:!0}),v(T).forEach(d),G=D(nt),Te&&Te.l(nt),nt.forEach(d),z=D(Se),H=g(Se,"DIV",{class:!0});var it=v(H);E=g(it,"LABEL",{class:!0,"data-svelte-h":!0}),Z(E)!=="svelte-1ywtpsi"&&(E.textContent=F),P=D(it),N=g(it,"INPUT",{type:!0,placeholder:!0,class:!0}),K=D(it),q=g(it,"P",{class:!0,"data-svelte-h":!0}),Z(q)!=="svelte-va0wj3"&&(q.textContent=X),it.forEach(d),re=D(Se),Q=g(Se,"DIV",{class:!0});var St=v(Q);te=g(St,"LABEL",{class:!0});var ls=v(te);ee=g(ls,"INPUT",{type:!0,class:!0}),oe=D(ls),ne=g(ls,"SPAN",{class:!0,"data-svelte-h":!0}),Z(ne)!=="svelte-sohnzt"&&(ne.textContent=ke),ls.forEach(d),ae=D(St),je&&je.l(St),St.forEach(d),Ie=D(Se),J=g(Se,"DIV",{class:!0});var Xt=v(J);Ae=g(Xt,"BUTTON",{class:!0});var Qt=v(Ae);qe.l(Qt),Qt.forEach(d),ce=D(Xt),de=g(Xt,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(de)!=="svelte-1ibbsx6"&&(de.textContent=ue),Xt.forEach(d),Se.forEach(d),this.h()},h(){a(r,"class","svelte-1adc9lu"),a(i,"class","text-dark-text-muted hover:text-dark-text p-2 rounded transition-colors svelte-1adc9lu"),a(t,"class","flex items-start justify-between svelte-1adc9lu"),a(m,"class","block text-sm font-medium text-dark-text svelte-1adc9lu"),a(w,"class","grid grid-cols-1 sm:grid-cols-2 gap-3 svelte-1adc9lu"),a(f,"class","space-y-3 svelte-1adc9lu"),a(S,"class","block text-sm font-medium text-dark-text svelte-1adc9lu"),a(A,"class","text-xs text-dark-text-muted svelte-1adc9lu"),a(V,"class","flex items-center justify-between svelte-1adc9lu"),a(T,"placeholder",j=s[9].placeholder),a(T,"class","w-full px-4 py-3 bg-dark-base border border-gray-600 rounded-lg text-dark-text placeholder-dark-text-muted resize-none focus:border-magic-400 focus:outline-none transition-colors svelte-1adc9lu"),a(T,"rows","6"),a(y,"class","space-y-3 svelte-1adc9lu"),a(E,"class","block text-sm font-medium text-dark-text svelte-1adc9lu"),a(N,"type","email"),a(N,"placeholder","your.email@example.com"),a(N,"class","w-full px-4 py-3 bg-dark-base border border-gray-600 rounded-lg text-dark-text placeholder-dark-text-muted focus:border-magic-400 focus:outline-none transition-colors svelte-1adc9lu"),a(q,"class","text-xs text-dark-text-muted svelte-1adc9lu"),a(H,"class","space-y-3 svelte-1adc9lu"),a(ee,"type","checkbox"),a(ee,"class","w-4 h-4 text-magic-400 border-gray-600 rounded focus:ring-magic-400 svelte-1adc9lu"),a(ne,"class","text-sm text-dark-text svelte-1adc9lu"),a(te,"class","flex items-center space-x-3 svelte-1adc9lu"),a(Q,"class","space-y-3 svelte-1adc9lu"),Ae.disabled=_e=!s[10]||s[6],a(Ae,"class","flex-1 btn btn-magic py-3 px-6 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed svelte-1adc9lu"),a(de,"class","px-6 py-3 text-dark-text-muted hover:text-dark-text transition-colors font-medium svelte-1adc9lu"),a(J,"class","flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-700 svelte-1adc9lu"),a(e,"class","p-6 space-y-6 svelte-1adc9lu")},m(me,Se){Y(me,e,Se),l(e,t),l(t,r),l(t,n),l(t,i),l(e,c),l(e,f),l(f,m),l(f,b),l(f,w);for(let Pe=0;Pe<Ue.length;Pe+=1)Ue[Pe]&&Ue[Pe].m(w,null);l(e,_),l(e,y),l(y,V),l(V,S),l(V,M),l(V,A),l(A,x),l(A,R),l(A,U),l(y,B),l(y,T),os(T,s[3]),l(y,G),Te&&Te.m(y,null),l(e,z),l(e,H),l(H,E),l(H,P),l(H,N),os(N,s[4]),l(H,K),l(H,q),l(e,re),l(e,Q),l(Q,te),l(te,ee),ee.checked=s[5],l(te,oe),l(te,ne),l(Q,ae),je&&je.m(Q,null),l(e,Ie),l(e,J),l(J,Ae),qe.m(Ae,null),l(J,ce),l(J,de),ye||(Re=[se(i,"click",s[13]),se(T,"input",s[19]),se(N,"input",s[20]),se(ee,"change",s[21]),se(Ae,"click",s[12]),se(de,"click",s[13])],ye=!0)},p(me,Se){if(Se&18436){Qe=Ds(Object.entries(me[11]));let Pe;for(Pe=0;Pe<Qe.length;Pe+=1){const at=Cn(me,Qe,Pe);Ue[Pe]?Ue[Pe].p(at,Se):(Ue[Pe]=Sn(at),Ue[Pe].c(),Ue[Pe].m(w,null))}for(;Pe<Ue.length;Pe+=1)Ue[Pe].d(1);Ue.length=Qe.length}Se&256&&pe(x,me[8]),Se&256&&I!==(I=me[8]<10?"(minimum 10)":"")&&pe(U,I),Se&512&&j!==(j=me[9].placeholder)&&a(T,"placeholder",j),Se&8&&os(T,me[3]),me[9].examples.length>0?Te?Te.p(me,Se):(Te=Mn(me),Te.c(),Te.m(y,null)):Te&&(Te.d(1),Te=null),Se&16&&N.value!==me[4]&&os(N,me[4]),Se&32&&(ee.checked=me[5]),Se&34&&(be=me[5]&&Object.keys(me[1]).length>0),be?je?je.p(me,Se):(je=Tn(me),je.c(),je.m(Q,null)):je&&(je.d(1),je=null),jt!==(jt=At(me))&&(qe.d(1),qe=jt(me),qe&&(qe.c(),qe.m(Ae,null))),Se&1088&&_e!==(_e=!me[10]||me[6])&&(Ae.disabled=_e)},d(me){me&&d(e),To(Ue,me),Te&&Te.d(),je&&je.d(),qe.d(),ye=!1,Jt(Re)}}}function In(s){let e;return{c(){e=L("We'll follow up if we need any clarification.")},l(t){e=O(t,"We'll follow up if we need any clarification.")},m(t,r){Y(t,e,r)},d(t){t&&d(e)}}}function Sn(s){let e,t,r,o,n,i,u=s[24].icon+"",c,f,m,p,b=s[24].label+"",w,_,y,V=s[24].examples.slice(0,2).join(", ")+"",S,k,M,A,x;function R(){return s[18](s[23])}return M=Ta(s[17][0]),{c(){e=h("label"),t=h("input"),r=C(),o=h("div"),n=h("div"),i=h("span"),c=L(u),f=C(),m=h("div"),p=h("div"),w=L(b),_=C(),y=h("div"),S=L(V),k=C(),this.h()},l(I){e=g(I,"LABEL",{class:!0});var U=v(e);t=g(U,"INPUT",{type:!0,class:!0}),r=D(U),o=g(U,"DIV",{class:!0});var B=v(o);n=g(B,"DIV",{class:!0});var T=v(n);i=g(T,"SPAN",{class:!0});var j=v(i);c=O(j,u),j.forEach(d),f=D(T),m=g(T,"DIV",{class:!0});var G=v(m);p=g(G,"DIV",{class:!0});var z=v(p);w=O(z,b),z.forEach(d),_=D(G),y=g(G,"DIV",{class:!0});var H=v(y);S=O(H,V),H.forEach(d),G.forEach(d),T.forEach(d),B.forEach(d),k=D(U),U.forEach(d),this.h()},h(){a(t,"type","radio"),t.__value=s[23],os(t,t.__value),a(t,"class","sr-only svelte-1adc9lu"),a(i,"class","text-2xl svelte-1adc9lu"),a(p,"class","font-medium text-dark-text svelte-1adc9lu"),a(y,"class","text-xs text-dark-text-muted mt-1 svelte-1adc9lu"),a(m,"class","svelte-1adc9lu"),a(n,"class","flex items-center space-x-3 svelte-1adc9lu"),a(o,"class","feedback-type-card p-4 rounded-lg border border-gray-600 hover:border-magic-400 cursor-pointer transition-all svelte-1adc9lu"),a(e,"class","feedback-type-option svelte-1adc9lu"),M.p(t)},m(I,U){Y(I,e,U),l(e,t),t.checked=t.__value===s[2],l(e,r),l(e,o),l(o,n),l(n,i),l(i,c),l(n,f),l(n,m),l(m,p),l(p,w),l(m,_),l(m,y),l(y,S),l(e,k),A||(x=[se(t,"change",s[16]),se(t,"change",R)],A=!0)},p(I,U){s=I,U&4&&(t.checked=t.__value===s[2])},d(I){I&&d(e),M.r(),A=!1,Jt(x)}}}function Mn(s){let e,t,r="Examples:",o,n=s[9].examples.join(" â€¢ ")+"",i;return{c(){e=h("div"),t=h("span"),t.textContent=r,o=C(),i=L(n),this.h()},l(u){e=g(u,"DIV",{class:!0});var c=v(e);t=g(c,"SPAN",{class:!0,"data-svelte-h":!0}),Z(t)!=="svelte-3udf47"&&(t.textContent=r),o=D(c),i=O(c,n),c.forEach(d),this.h()},h(){a(t,"class","font-medium svelte-1adc9lu"),a(e,"class","text-xs text-dark-text-muted svelte-1adc9lu")},m(u,c){Y(u,e,c),l(e,t),l(e,o),l(e,i)},p(u,c){c&512&&n!==(n=u[9].examples.join(" â€¢ ")+"")&&pe(i,n)},d(u){u&&d(e)}}}function Tn(s){let e,t,r="Context includes:",o,n,i,u=s[1].images_processed&&xn(s),c=s[1].processing_time&&Pn(s);return{c(){e=h("div"),t=h("strong"),t.textContent=r,o=C(),u&&u.c(),n=C(),c&&c.c(),i=L(`\r
                Browser info, session data`),this.h()},l(f){e=g(f,"DIV",{class:!0});var m=v(e);t=g(m,"STRONG",{class:!0,"data-svelte-h":!0}),Z(t)!=="svelte-1m9jhps"&&(t.textContent=r),o=D(m),u&&u.l(m),n=D(m),c&&c.l(m),i=O(m,`\r
                Browser info, session data`),m.forEach(d),this.h()},h(){a(t,"class","svelte-1adc9lu"),a(e,"class","text-xs text-dark-text-muted bg-dark-base/50 rounded p-3 svelte-1adc9lu")},m(f,m){Y(f,e,m),l(e,t),l(e,o),u&&u.m(e,null),l(e,n),c&&c.m(e,null),l(e,i)},p(f,m){f[1].images_processed?u?u.p(f,m):(u=xn(f),u.c(),u.m(e,n)):u&&(u.d(1),u=null),f[1].processing_time?c?c.p(f,m):(c=Pn(f),c.c(),c.m(e,i)):c&&(c.d(1),c=null)},d(f){f&&d(e),u&&u.d(),c&&c.d()}}}function xn(s){let e,t=s[1].images_processed+"",r,o;return{c(){e=L("Images processed: "),r=L(t),o=L(" â€¢")},l(n){e=O(n,"Images processed: "),r=O(n,t),o=O(n," â€¢")},m(n,i){Y(n,e,i),Y(n,r,i),Y(n,o,i)},p(n,i){i&2&&t!==(t=n[1].images_processed+"")&&pe(r,t)},d(n){n&&(d(e),d(r),d(o))}}}function Pn(s){let e,t=s[1].processing_time.toFixed(1)+"",r,o;return{c(){e=L("Avg processing time: "),r=L(t),o=L("s â€¢")},l(n){e=O(n,"Avg processing time: "),r=O(n,t),o=O(n,"s â€¢")},m(n,i){Y(n,e,i),Y(n,r,i),Y(n,o,i)},p(n,i){i&2&&t!==(t=n[1].processing_time.toFixed(1)+"")&&pe(r,t)},d(n){n&&(d(e),d(r),d(o))}}}function ac(s){let e,t,r;return{c(){e=Ce("svg"),t=Ce("path"),r=L(`\r
                Submit Feedback`),this.h()},l(o){e=De(o,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var n=v(e);t=De(n,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0,class:!0}),v(t).forEach(d),n.forEach(d),r=O(o,`\r
                Submit Feedback`),this.h()},h(){a(t,"stroke-linecap","round"),a(t,"stroke-linejoin","round"),a(t,"stroke-width","2"),a(t,"d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"),a(t,"class","svelte-1adc9lu"),a(e,"class","w-5 h-5 mr-2 svelte-1adc9lu"),a(e,"fill","none"),a(e,"stroke","currentColor"),a(e,"viewBox","0 0 24 24")},m(o,n){Y(o,e,n),l(e,t),Y(o,r,n)},d(o){o&&(d(e),d(r))}}}function ic(s){let e,t,r;return{c(){e=Ce("svg"),t=Ce("path"),r=L(`\r
                Submitting...`),this.h()},l(o){e=De(o,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var n=v(e);t=De(n,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0,class:!0}),v(t).forEach(d),n.forEach(d),r=O(o,`\r
                Submitting...`),this.h()},h(){a(t,"stroke-linecap","round"),a(t,"stroke-linejoin","round"),a(t,"stroke-width","2"),a(t,"d","M12 6v6m0 0v6m0-6h6m-6 0H6"),a(t,"class","svelte-1adc9lu"),a(e,"class","w-5 h-5 mr-2 animate-spin svelte-1adc9lu"),a(e,"fill","none"),a(e,"stroke","currentColor"),a(e,"viewBox","0 0 24 24")},m(o,n){Y(o,e,n),l(e,t),Y(o,r,n)},d(o){o&&(d(e),d(r))}}}function cc(s){let e,t=s[0]&&Dn(s);return{c(){t&&t.c(),e=cs()},l(r){t&&t.l(r),e=cs()},m(r,o){t&&t.m(r,o),Y(r,e,o)},p(r,[o]){r[0]?t?t.p(r,o):(t=Dn(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ge,o:Ge,d(r){r&&d(e),t&&t.d(r)}}}function uc(s,e,t){let r,o,{visible:n=!1}=e,{feedbackType:i="general"}=e,{contextData:u={}}=e;const c=Er();let f=i,m="",p="",b=!0,w=!1,_=!1,y=0;const V={feature_request:{label:"Feature Request",placeholder:"Describe the feature you'd like to see in CharacterCut. How would it improve your developer workflow?",icon:"ðŸ’¡",examples:["Batch processing multiple images","API integration","Browser extension"]},bug_report:{label:"Bug Report",placeholder:"Describe the issue you encountered. What were you trying to do, and what happened instead?",icon:"ðŸ›",examples:["Processing failed unexpectedly","Image quality issues","Interface not responding"]},improvement:{label:"Improvement Suggestion",placeholder:"How can we make CharacterCut better for your specific use case?",icon:"âš¡",examples:["Faster processing","Better edge detection","More format support"]},general:{label:"General Feedback",placeholder:"Share your thoughts, suggestions, or experiences with CharacterCut.",icon:"ðŸ’¬",examples:["Overall experience","Interface feedback","Workflow suggestions"]}};async function S(){if(r){t(6,w=!0);try{await ut.trackFeedbackSubmission(f,m);const T={type:f,content:m.trim(),email:p.trim()||void 0,context:b?{...u,timestamp:new Date().toISOString(),user_agent:navigator.userAgent,session_id:ut.sessionId}:void 0};console.log("ðŸ“ Feedback Submission:",T),c("submit",T),t(7,_=!0),setTimeout(()=>{k()},3e3)}catch(T){console.error("Failed to submit feedback:",T),t(7,_=!0),setTimeout(()=>{k()},3e3)}finally{t(6,w=!1)}}}function k(){t(0,n=!1),c("dismiss")}function M(T){t(2,f=T),t(3,m="")}const A=[[]];function x(){f=this.__value,t(2,f)}const R=T=>M(T);function I(){m=this.value,t(3,m)}function U(){p=this.value,t(4,p)}function B(){b=this.checked,t(5,b)}return s.$$set=T=>{"visible"in T&&t(0,n=T.visible),"feedbackType"in T&&t(15,i=T.feedbackType),"contextData"in T&&t(1,u=T.contextData)},s.$$.update=()=>{s.$$.dirty&8&&t(8,y=m.length),s.$$.dirty&8&&t(10,r=m.trim().length>=10),s.$$.dirty&4&&t(9,o=V[f])},[n,u,f,m,p,b,w,_,y,o,r,V,S,k,M,i,x,A,R,I,U,B]}class dc extends Rs{constructor(e){super(),As(this,e,uc,cc,Ps,{visible:0,feedbackType:15,contextData:1})}}function Rn(s,e,t){const r=s.slice();return r[12]=e[t][0],r[13]=e[t][1],r}function An(s,e,t){const r=s.slice();return r[16]=e[t],r}function Vn(s){let e,t,r,o,n,i='<h2 class="text-2xl font-bold text-magic-gradient mb-2">CharacterCut Analytics Dashboard</h2> <p class="text-sm text-dark-text-secondary">Phase 5 Success Metrics Tracking â€¢ Dev Mode</p>',u,c,f,m="Export Data",p,b,w='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',_,y,V,S="Current Session",k,M,A,x,R=s[2].images_processed+"",I,U,B,T="Images Processed",j,G,z,H=s[2].meets_continuity_target?"âœ…":"â³",E,F,P,N,K="Continuity Target",q,X,re,Q=Math.round(s[2].session_duration/1e3)+"",te,ee,oe,ne,ke="Session Duration",ae,be,Ie,J=s[2].successful_completions+"",Ae,_e,ce=s[2].successful_completions+s[2].failed_attempts+"",de,ue,ye,Re,Qe="Success Rate",Ue,Te,je,At="Phase 5 KPIs Progress",jt,qe,me,Se,Pe,at="Unique Active Users",pt,nt,us=s[8].uniqueActiveUsers+"",mt,it,St=s[7].uniqueActiveUsers+"",ls,Xt,Qt,ct,Nt,Mt,Or=(s[8].uniqueActiveUsers/s[7].uniqueActiveUsers*100).toFixed(1)+"",cr,Dr,Lt,dt,kt,ds,Ir="Task Completion Rate",Sr,wt,Zt=s[5].toFixed(1)+"",Mr,Tr,$t,Vt,W,$,ie,Ee,He,he=s[7].taskCompletionRate+"",xe,we,tt,fe,Fe,Ve,Be="Avg Processing Time",We,Ke,st=s[8].avgProcessingTime.toFixed(2)+"",Xe,bt,Ye,Ze,rt,yt,Ne,Et,Ot=s[7].avgProcessingTime+"",zr,zt,fs=s[8].under5SecondRate.toFixed(1)+"",Vs,xo,so,Tt,Fs,Bs,hs="Session Continuity",Ss,Ut,ur=s[4].toFixed(1)+"",Ur,ro,js,xr,Ns,Ls,Ht,Os,dr=s[8].sessionContinuityCount+"",Po,oo,Ms,xt,zs,Us,Hs="NPS Score",es,Pt,ns=s[3]>0?"+":"",Hr,fr=s[3].toFixed(1)+"",Gr,Gt,gs,ts,Gs,qr,qs,Ws=s[8].npsResponses.length+"",Ys,Ro,lo,Ft,Bt,qt,Ao="Feedback Submissions",hr,Ks,Vo=s[8].feedbackSubmissions+"",no,gr,Wt=s[7].feedbackSubmissions+"",mr,ao,ms,vr,pr,Js,Pr="Detailed qualitative feedback",vs,Yt,Ts,Xs,Qs="Top Referrers",ps,bs,io,Ct,Zs,Wo="Error Categories",Dt,ot,It,Rt,lt=Ds(s[8].topReferrers.slice(0,5)),Oe=[];for(let le=0;le<lt.length;le+=1)Oe[le]=Bn(An(s,lt,le));let _t=null;lt.length||(_t=Fn());let as=Ds(Object.entries(s[8].errorCategories).slice(0,5)),Je=[];for(let le=0;le<as.length;le+=1)Je[le]=Nn(Rn(s,as,le));let ve=null;return as.length||(ve=jn()),{c(){e=h("div"),t=h("div"),r=h("div"),o=h("div"),n=h("div"),n.innerHTML=i,u=C(),c=h("div"),f=h("button"),f.textContent=m,p=C(),b=h("button"),b.innerHTML=w,_=C(),y=h("div"),V=h("h3"),V.textContent=S,k=C(),M=h("div"),A=h("div"),x=h("div"),I=L(R),U=C(),B=h("div"),B.textContent=T,j=C(),G=h("div"),z=h("div"),E=L(H),P=C(),N=h("div"),N.textContent=K,q=C(),X=h("div"),re=h("div"),te=L(Q),ee=L("s"),oe=C(),ne=h("div"),ne.textContent=ke,ae=C(),be=h("div"),Ie=h("div"),Ae=L(J),_e=L("/"),de=L(ce),ye=C(),Re=h("div"),Re.textContent=Qe,Ue=C(),Te=h("div"),je=h("h3"),je.textContent=At,jt=C(),qe=h("div"),me=h("div"),Se=h("div"),Pe=h("h4"),Pe.textContent=at,pt=C(),nt=h("span"),mt=L(us),it=L("/"),ls=L(St),Xt=C(),Qt=h("div"),ct=h("div"),Nt=C(),Mt=h("div"),cr=L(Or),Dr=L("% of target"),Lt=C(),dt=h("div"),kt=h("div"),ds=h("h4"),ds.textContent=Ir,Sr=C(),wt=h("span"),Mr=L(Zt),Tr=L("%"),Vt=C(),W=h("div"),$=h("div"),ie=C(),Ee=h("div"),He=L("Target: "),xe=L(he),we=L("%"),tt=C(),fe=h("div"),Fe=h("div"),Ve=h("h4"),Ve.textContent=Be,We=C(),Ke=h("span"),Xe=L(st),bt=L("s"),Ye=C(),Ze=h("div"),rt=h("div"),yt=C(),Ne=h("div"),Et=L("Target: <"),zr=L(Ot),zt=L("s â€¢ "),Vs=L(fs),xo=L("% under 5s"),so=C(),Tt=h("div"),Fs=h("div"),Bs=h("h4"),Bs.textContent=hs,Ss=C(),Ut=h("span"),Ur=L(ur),ro=L("%"),xr=C(),Ns=h("div"),Ls=h("div"),Ht=C(),Os=h("div"),Po=L(dr),oo=L(" sessions with 2+ images"),Ms=C(),xt=h("div"),zs=h("div"),Us=h("h4"),Us.textContent=Hs,es=C(),Pt=h("span"),Hr=L(ns),Gr=L(fr),gs=C(),ts=h("div"),Gs=h("div"),qr=C(),qs=h("div"),Ys=L(Ws),Ro=L(" responses â€¢ Target: positive"),lo=C(),Ft=h("div"),Bt=h("div"),qt=h("h4"),qt.textContent=Ao,hr=C(),Ks=h("span"),no=L(Vo),gr=L("/"),mr=L(Wt),ao=C(),ms=h("div"),vr=h("div"),pr=C(),Js=h("div"),Js.textContent=Pr,vs=C(),Yt=h("div"),Ts=h("div"),Xs=h("h4"),Xs.textContent=Qs,ps=C(),bs=h("div");for(let le=0;le<Oe.length;le+=1)Oe[le].c();_t&&_t.c(),io=C(),Ct=h("div"),Zs=h("h4"),Zs.textContent=Wo,Dt=C(),ot=h("div");for(let le=0;le<Je.length;le+=1)Je[le].c();ve&&ve.c(),this.h()},l(le){e=g(le,"DIV",{class:!0});var Le=v(e);t=g(Le,"DIV",{class:!0});var Me=v(t);r=g(Me,"DIV",{class:!0});var _s=v(r);o=g(_s,"DIV",{class:!0});var ks=v(o);n=g(ks,"DIV",{"data-svelte-h":!0}),Z(n)!=="svelte-1ryvpqg"&&(n.innerHTML=i),u=D(ks),c=g(ks,"DIV",{class:!0});var Rr=v(c);f=g(Rr,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(f)!=="svelte-1hzqfkc"&&(f.textContent=m),p=D(Rr),b=g(Rr,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(b)!=="svelte-9m0buy"&&(b.innerHTML=w),Rr.forEach(d),ks.forEach(d),_s.forEach(d),_=D(Me),y=g(Me,"DIV",{class:!0});var co=v(y);V=g(co,"H3",{class:!0,"data-svelte-h":!0}),Z(V)!=="svelte-1y0f3ps"&&(V.textContent=S),k=D(co),M=g(co,"DIV",{class:!0});var vt=v(M);A=g(vt,"DIV",{class:!0});var ws=v(A);x=g(ws,"DIV",{class:!0});var $s=v(x);I=O($s,R),$s.forEach(d),U=D(ws),B=g(ws,"DIV",{class:!0,"data-svelte-h":!0}),Z(B)!=="svelte-ehd65n"&&(B.textContent=T),ws.forEach(d),j=D(vt),G=g(vt,"DIV",{class:!0});var er=v(G);z=g(er,"DIV",{class:!0});var uo=v(z);E=O(uo,H),uo.forEach(d),P=D(er),N=g(er,"DIV",{class:!0,"data-svelte-h":!0}),Z(N)!=="svelte-158k1ee"&&(N.textContent=K),er.forEach(d),q=D(vt),X=g(vt,"DIV",{class:!0});var Wr=v(X);re=g(Wr,"DIV",{class:!0});var Yr=v(re);te=O(Yr,Q),ee=O(Yr,"s"),Yr.forEach(d),oe=D(Wr),ne=g(Wr,"DIV",{class:!0,"data-svelte-h":!0}),Z(ne)!=="svelte-1sdj5gt"&&(ne.textContent=ke),Wr.forEach(d),ae=D(vt),be=g(vt,"DIV",{class:!0});var Ar=v(be);Ie=g(Ar,"DIV",{class:!0});var fo=v(Ie);Ae=O(fo,J),_e=O(fo,"/"),de=O(fo,ce),fo.forEach(d),ye=D(Ar),Re=g(Ar,"DIV",{class:!0,"data-svelte-h":!0}),Z(Re)!=="svelte-s2mmy6"&&(Re.textContent=Qe),Ar.forEach(d),vt.forEach(d),co.forEach(d),Ue=D(Me),Te=g(Me,"DIV",{class:!0});var tr=v(Te);je=g(tr,"H3",{class:!0,"data-svelte-h":!0}),Z(je)!=="svelte-wnxoev"&&(je.textContent=At),jt=D(tr),qe=g(tr,"DIV",{class:!0});var ss=v(qe);me=g(ss,"DIV",{class:!0});var rs=v(me);Se=g(rs,"DIV",{class:!0});var Kr=v(Se);Pe=g(Kr,"H4",{class:!0,"data-svelte-h":!0}),Z(Pe)!=="svelte-1p1xeb3"&&(Pe.textContent=at),pt=D(Kr),nt=g(Kr,"SPAN",{class:!0});var ho=v(nt);mt=O(ho,us),it=O(ho,"/"),ls=O(ho,St),ho.forEach(d),Kr.forEach(d),Xt=D(rs),Qt=g(rs,"DIV",{class:!0});var Fo=v(Qt);ct=g(Fo,"DIV",{class:!0,style:!0}),v(ct).forEach(d),Fo.forEach(d),Nt=D(rs),Mt=g(rs,"DIV",{class:!0});var Bo=v(Mt);cr=O(Bo,Or),Dr=O(Bo,"% of target"),Bo.forEach(d),rs.forEach(d),Lt=D(ss),dt=g(ss,"DIV",{class:!0});var br=v(dt);kt=g(br,"DIV",{class:!0});var go=v(kt);ds=g(go,"H4",{class:!0,"data-svelte-h":!0}),Z(ds)!=="svelte-tx3wcr"&&(ds.textContent=Ir),Sr=D(go),wt=g(go,"SPAN",{class:!0});var mo=v(wt);Mr=O(mo,Zt),Tr=O(mo,"%"),mo.forEach(d),go.forEach(d),Vt=D(br),W=g(br,"DIV",{class:!0});var Yo=v(W);$=g(Yo,"DIV",{class:!0,style:!0}),v($).forEach(d),Yo.forEach(d),ie=D(br),Ee=g(br,"DIV",{class:!0});var Vr=v(Ee);He=O(Vr,"Target: "),xe=O(Vr,he),we=O(Vr,"%"),Vr.forEach(d),br.forEach(d),tt=D(ss),fe=g(ss,"DIV",{class:!0});var sr=v(fe);Fe=g(sr,"DIV",{class:!0});var Jr=v(Fe);Ve=g(Jr,"H4",{class:!0,"data-svelte-h":!0}),Z(Ve)!=="svelte-1pjdus8"&&(Ve.textContent=Be),We=D(Jr),Ke=g(Jr,"SPAN",{class:!0});var _r=v(Ke);Xe=O(_r,st),bt=O(_r,"s"),_r.forEach(d),Jr.forEach(d),Ye=D(sr),Ze=g(sr,"DIV",{class:!0});var Fr=v(Ze);rt=g(Fr,"DIV",{class:!0,style:!0}),v(rt).forEach(d),Fr.forEach(d),yt=D(sr),Ne=g(sr,"DIV",{class:!0});var rr=v(Ne);Et=O(rr,"Target: <"),zr=O(rr,Ot),zt=O(rr,"s â€¢ "),Vs=O(rr,fs),xo=O(rr,"% under 5s"),rr.forEach(d),sr.forEach(d),so=D(ss),Tt=g(ss,"DIV",{class:!0});var kr=v(Tt);Fs=g(kr,"DIV",{class:!0});var vo=v(Fs);Bs=g(vo,"H4",{class:!0,"data-svelte-h":!0}),Z(Bs)!=="svelte-1sx6yj2"&&(Bs.textContent=hs),Ss=D(vo),Ut=g(vo,"SPAN",{class:!0});var wr=v(Ut);Ur=O(wr,ur),ro=O(wr,"%"),wr.forEach(d),vo.forEach(d),xr=D(kr),Ns=g(kr,"DIV",{class:!0});var Br=v(Ns);Ls=g(Br,"DIV",{class:!0,style:!0}),v(Ls).forEach(d),Br.forEach(d),Ht=D(kr),Os=g(kr,"DIV",{class:!0});var Xr=v(Os);Po=O(Xr,dr),oo=O(Xr," sessions with 2+ images"),Xr.forEach(d),kr.forEach(d),Ms=D(ss),xt=g(ss,"DIV",{class:!0});var yr=v(xt);zs=g(yr,"DIV",{class:!0});var po=v(zs);Us=g(po,"H4",{class:!0,"data-svelte-h":!0}),Z(Us)!=="svelte-jzhokp"&&(Us.textContent=Hs),es=D(po),Pt=g(po,"SPAN",{class:!0});var Qr=v(Pt);Hr=O(Qr,ns),Gr=O(Qr,fr),Qr.forEach(d),po.forEach(d),gs=D(yr),ts=g(yr,"DIV",{class:!0});var bo=v(ts);Gs=g(bo,"DIV",{class:!0,style:!0}),v(Gs).forEach(d),bo.forEach(d),qr=D(yr),qs=g(yr,"DIV",{class:!0});var _o=v(qs);Ys=O(_o,Ws),Ro=O(_o," responses â€¢ Target: positive"),_o.forEach(d),yr.forEach(d),lo=D(ss),Ft=g(ss,"DIV",{class:!0});var jr=v(Ft);Bt=g(jr,"DIV",{class:!0});var Zr=v(Bt);qt=g(Zr,"H4",{class:!0,"data-svelte-h":!0}),Z(qt)!=="svelte-86cqka"&&(qt.textContent=Ao),hr=D(Zr),Ks=g(Zr,"SPAN",{class:!0});var ko=v(Ks);no=O(ko,Vo),gr=O(ko,"/"),mr=O(ko,Wt),ko.forEach(d),Zr.forEach(d),ao=D(jr),ms=g(jr,"DIV",{class:!0});var wo=v(ms);vr=g(wo,"DIV",{class:!0,style:!0}),v(vr).forEach(d),wo.forEach(d),pr=D(jr),Js=g(jr,"DIV",{class:!0,"data-svelte-h":!0}),Z(Js)!=="svelte-4uopxu"&&(Js.textContent=Pr),jr.forEach(d),ss.forEach(d),vs=D(tr),Yt=g(tr,"DIV",{class:!0});var yo=v(Yt);Ts=g(yo,"DIV",{class:!0});var Nr=v(Ts);Xs=g(Nr,"H4",{class:!0,"data-svelte-h":!0}),Z(Xs)!=="svelte-1q20frz"&&(Xs.textContent=Qs),ps=D(Nr),bs=g(Nr,"DIV",{class:!0});var jo=v(bs);for(let xs=0;xs<Oe.length;xs+=1)Oe[xs].l(jo);_t&&_t.l(jo),jo.forEach(d),Nr.forEach(d),io=D(yo),Ct=g(yo,"DIV",{class:!0});var ys=v(Ct);Zs=g(ys,"H4",{class:!0,"data-svelte-h":!0}),Z(Zs)!=="svelte-1ncaf6w"&&(Zs.textContent=Wo),Dt=D(ys),ot=g(ys,"DIV",{class:!0});var No=v(ot);for(let xs=0;xs<Je.length;xs+=1)Je[xs].l(No);ve&&ve.l(No),No.forEach(d),ys.forEach(d),yo.forEach(d),tr.forEach(d),Me.forEach(d),Le.forEach(d),this.h()},h(){a(f,"class","btn btn-outline border-magic-400 text-magic-400 hover:bg-magic-400 hover:text-white px-4 py-2 rounded text-sm"),a(b,"class","text-dark-text-muted hover:text-dark-text p-2 rounded transition-colors"),a(c,"class","flex items-center space-x-3"),a(o,"class","flex items-center justify-between"),a(r,"class","p-6 border-b border-gray-700"),a(V,"class","text-lg font-semibold text-dark-text mb-4"),a(x,"class","text-2xl font-bold text-magic-400"),a(B,"class","text-sm text-dark-text-muted"),a(A,"class","metric-card bg-dark-base/50 rounded-lg p-4 svelte-1dl4xtl"),a(z,"class",F="text-2xl font-bold "+(s[2].meets_continuity_target?"text-green-400":"text-yellow-400")),a(N,"class","text-sm text-dark-text-muted"),a(G,"class","metric-card bg-dark-base/50 rounded-lg p-4 svelte-1dl4xtl"),a(re,"class","text-2xl font-bold text-blue-400"),a(ne,"class","text-sm text-dark-text-muted"),a(X,"class","metric-card bg-dark-base/50 rounded-lg p-4 svelte-1dl4xtl"),a(Ie,"class",ue="text-2xl font-bold "+(s[2].failed_attempts===0?"text-green-400":"text-red-400")),a(Re,"class","text-sm text-dark-text-muted"),a(be,"class","metric-card bg-dark-base/50 rounded-lg p-4 svelte-1dl4xtl"),a(M,"class","grid grid-cols-2 md:grid-cols-4 gap-4"),a(y,"class","p-6 border-b border-gray-700"),a(je,"class","text-lg font-semibold text-dark-text mb-6"),a(Pe,"class","font-medium text-dark-text"),a(nt,"class",Oo(s[8].uniqueActiveUsers,s[7].uniqueActiveUsers)+" text-sm font-medium svelte-1dl4xtl"),a(Se,"class","flex items-center justify-between mb-4"),a(ct,"class","bg-magic-400 h-2 rounded-full transition-all duration-500 svelte-1dl4xtl"),ge(ct,"width",Ln(s[8].uniqueActiveUsers,s[7].uniqueActiveUsers)+"%"),a(Qt,"class","progress-bar bg-dark-elevated rounded-full h-2 mb-2 svelte-1dl4xtl"),a(Mt,"class","text-xs text-dark-text-muted"),a(me,"class","kpi-card bg-dark-base/30 rounded-lg p-6 border border-gray-700 svelte-1dl4xtl"),a(ds,"class","font-medium text-dark-text"),a(wt,"class",$t=Oo(s[5],s[7].taskCompletionRate,!0)+" text-sm font-medium svelte-1dl4xtl"),a(kt,"class","flex items-center justify-between mb-4"),a($,"class","bg-green-400 h-2 rounded-full transition-all duration-500 svelte-1dl4xtl"),ge($,"width",Math.min(s[5],100)+"%"),a(W,"class","progress-bar bg-dark-elevated rounded-full h-2 mb-2 svelte-1dl4xtl"),a(Ee,"class","text-xs text-dark-text-muted"),a(dt,"class","kpi-card bg-dark-base/30 rounded-lg p-6 border border-gray-700 svelte-1dl4xtl"),a(Ve,"class","font-medium text-dark-text"),a(Ke,"class",(s[8].avgProcessingTime<=s[7].avgProcessingTime?"text-green-400":"text-red-400")+" text-sm font-medium"),a(Fe,"class","flex items-center justify-between mb-4"),a(rt,"class","bg-blue-400 h-2 rounded-full transition-all duration-500 svelte-1dl4xtl"),ge(rt,"width",Math.min(s[7].avgProcessingTime/Math.max(s[8].avgProcessingTime,s[7].avgProcessingTime)*100,100)+"%"),a(Ze,"class","progress-bar bg-dark-elevated rounded-full h-2 mb-2 svelte-1dl4xtl"),a(Ne,"class","text-xs text-dark-text-muted"),a(fe,"class","kpi-card bg-dark-base/30 rounded-lg p-6 border border-gray-700 svelte-1dl4xtl"),a(Bs,"class","font-medium text-dark-text"),a(Ut,"class",js=Oo(s[4],s[7].sessionContinuityRate,!0)+" text-sm font-medium svelte-1dl4xtl"),a(Fs,"class","flex items-center justify-between mb-4"),a(Ls,"class","bg-yellow-400 h-2 rounded-full transition-all duration-500 svelte-1dl4xtl"),ge(Ls,"width",Math.min(s[4],100)+"%"),a(Ns,"class","progress-bar bg-dark-elevated rounded-full h-2 mb-2 svelte-1dl4xtl"),a(Os,"class","text-xs text-dark-text-muted"),a(Tt,"class","kpi-card bg-dark-base/30 rounded-lg p-6 border border-gray-700 svelte-1dl4xtl"),a(Us,"class","font-medium text-dark-text"),a(Pt,"class",Gt=(s[3]>=0?"text-green-400":"text-red-400")+" text-sm font-medium"),a(zs,"class","flex items-center justify-between mb-4"),a(Gs,"class","bg-purple-400 h-2 rounded-full transition-all duration-500 svelte-1dl4xtl"),ge(Gs,"width",(s[3]+10)/20*100+"%"),a(ts,"class","progress-bar bg-dark-elevated rounded-full h-2 mb-2 svelte-1dl4xtl"),a(qs,"class","text-xs text-dark-text-muted"),a(xt,"class","kpi-card bg-dark-base/30 rounded-lg p-6 border border-gray-700 svelte-1dl4xtl"),a(qt,"class","font-medium text-dark-text"),a(Ks,"class",Oo(s[8].feedbackSubmissions,s[7].feedbackSubmissions)+" text-sm font-medium svelte-1dl4xtl"),a(Bt,"class","flex items-center justify-between mb-4"),a(vr,"class","bg-orange-400 h-2 rounded-full transition-all duration-500 svelte-1dl4xtl"),ge(vr,"width",Ln(s[8].feedbackSubmissions,s[7].feedbackSubmissions)+"%"),a(ms,"class","progress-bar bg-dark-elevated rounded-full h-2 mb-2 svelte-1dl4xtl"),a(Js,"class","text-xs text-dark-text-muted"),a(Ft,"class","kpi-card bg-dark-base/30 rounded-lg p-6 border border-gray-700 svelte-1dl4xtl"),a(qe,"class","grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"),a(Xs,"class","font-medium text-dark-text mb-4"),a(bs,"class","space-y-2"),a(Ts,"class","insights-card bg-dark-base/30 rounded-lg p-6 border border-gray-700 svelte-1dl4xtl"),a(Zs,"class","font-medium text-dark-text mb-4"),a(ot,"class","space-y-2"),a(Ct,"class","insights-card bg-dark-base/30 rounded-lg p-6 border border-gray-700 svelte-1dl4xtl"),a(Yt,"class","mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6"),a(Te,"class","p-6"),a(t,"class","analytics-dashboard bg-dark-elevated border border-magic-400/20 rounded-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto svelte-1dl4xtl"),a(e,"class","fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50")},m(le,Le){Y(le,e,Le),l(e,t),l(t,r),l(r,o),l(o,n),l(o,u),l(o,c),l(c,f),l(c,p),l(c,b),l(t,_),l(t,y),l(y,V),l(y,k),l(y,M),l(M,A),l(A,x),l(x,I),l(A,U),l(A,B),l(M,j),l(M,G),l(G,z),l(z,E),l(G,P),l(G,N),l(M,q),l(M,X),l(X,re),l(re,te),l(re,ee),l(X,oe),l(X,ne),l(M,ae),l(M,be),l(be,Ie),l(Ie,Ae),l(Ie,_e),l(Ie,de),l(be,ye),l(be,Re),l(t,Ue),l(t,Te),l(Te,je),l(Te,jt),l(Te,qe),l(qe,me),l(me,Se),l(Se,Pe),l(Se,pt),l(Se,nt),l(nt,mt),l(nt,it),l(nt,ls),l(me,Xt),l(me,Qt),l(Qt,ct),l(me,Nt),l(me,Mt),l(Mt,cr),l(Mt,Dr),l(qe,Lt),l(qe,dt),l(dt,kt),l(kt,ds),l(kt,Sr),l(kt,wt),l(wt,Mr),l(wt,Tr),l(dt,Vt),l(dt,W),l(W,$),l(dt,ie),l(dt,Ee),l(Ee,He),l(Ee,xe),l(Ee,we),l(qe,tt),l(qe,fe),l(fe,Fe),l(Fe,Ve),l(Fe,We),l(Fe,Ke),l(Ke,Xe),l(Ke,bt),l(fe,Ye),l(fe,Ze),l(Ze,rt),l(fe,yt),l(fe,Ne),l(Ne,Et),l(Ne,zr),l(Ne,zt),l(Ne,Vs),l(Ne,xo),l(qe,so),l(qe,Tt),l(Tt,Fs),l(Fs,Bs),l(Fs,Ss),l(Fs,Ut),l(Ut,Ur),l(Ut,ro),l(Tt,xr),l(Tt,Ns),l(Ns,Ls),l(Tt,Ht),l(Tt,Os),l(Os,Po),l(Os,oo),l(qe,Ms),l(qe,xt),l(xt,zs),l(zs,Us),l(zs,es),l(zs,Pt),l(Pt,Hr),l(Pt,Gr),l(xt,gs),l(xt,ts),l(ts,Gs),l(xt,qr),l(xt,qs),l(qs,Ys),l(qs,Ro),l(qe,lo),l(qe,Ft),l(Ft,Bt),l(Bt,qt),l(Bt,hr),l(Bt,Ks),l(Ks,no),l(Ks,gr),l(Ks,mr),l(Ft,ao),l(Ft,ms),l(ms,vr),l(Ft,pr),l(Ft,Js),l(Te,vs),l(Te,Yt),l(Yt,Ts),l(Ts,Xs),l(Ts,ps),l(Ts,bs);for(let Me=0;Me<Oe.length;Me+=1)Oe[Me]&&Oe[Me].m(bs,null);_t&&_t.m(bs,null),l(Yt,io),l(Yt,Ct),l(Ct,Zs),l(Ct,Dt),l(Ct,ot);for(let Me=0;Me<Je.length;Me+=1)Je[Me]&&Je[Me].m(ot,null);ve&&ve.m(ot,null),It||(Rt=[se(f,"click",s[9]),se(b,"click",s[10])],It=!0)},p(le,Le){if(Le&4&&R!==(R=le[2].images_processed+"")&&pe(I,R),Le&4&&H!==(H=le[2].meets_continuity_target?"âœ…":"â³")&&pe(E,H),Le&4&&F!==(F="text-2xl font-bold "+(le[2].meets_continuity_target?"text-green-400":"text-yellow-400"))&&a(z,"class",F),Le&4&&Q!==(Q=Math.round(le[2].session_duration/1e3)+"")&&pe(te,Q),Le&4&&J!==(J=le[2].successful_completions+"")&&pe(Ae,J),Le&4&&ce!==(ce=le[2].successful_completions+le[2].failed_attempts+"")&&pe(de,ce),Le&4&&ue!==(ue="text-2xl font-bold "+(le[2].failed_attempts===0?"text-green-400":"text-red-400"))&&a(Ie,"class",ue),Le&32&&Zt!==(Zt=le[5].toFixed(1)+"")&&pe(Mr,Zt),Le&32&&$t!==($t=Oo(le[5],le[7].taskCompletionRate,!0)+" text-sm font-medium svelte-1dl4xtl")&&a(wt,"class",$t),Le&32&&ge($,"width",Math.min(le[5],100)+"%"),Le&16&&ur!==(ur=le[4].toFixed(1)+"")&&pe(Ur,ur),Le&16&&js!==(js=Oo(le[4],le[7].sessionContinuityRate,!0)+" text-sm font-medium svelte-1dl4xtl")&&a(Ut,"class",js),Le&16&&ge(Ls,"width",Math.min(le[4],100)+"%"),Le&8&&ns!==(ns=le[3]>0?"+":"")&&pe(Hr,ns),Le&8&&fr!==(fr=le[3].toFixed(1)+"")&&pe(Gr,fr),Le&8&&Gt!==(Gt=(le[3]>=0?"text-green-400":"text-red-400")+" text-sm font-medium")&&a(Pt,"class",Gt),Le&8&&ge(Gs,"width",(le[3]+10)/20*100+"%"),Le&256){lt=Ds(le[8].topReferrers.slice(0,5));let Me;for(Me=0;Me<lt.length;Me+=1){const _s=An(le,lt,Me);Oe[Me]?Oe[Me].p(_s,Le):(Oe[Me]=Bn(_s),Oe[Me].c(),Oe[Me].m(bs,null))}for(;Me<Oe.length;Me+=1)Oe[Me].d(1);Oe.length=lt.length,!lt.length&&_t?_t.p(le,Le):lt.length?_t&&(_t.d(1),_t=null):(_t=Fn(),_t.c(),_t.m(bs,null))}if(Le&256){as=Ds(Object.entries(le[8].errorCategories).slice(0,5));let Me;for(Me=0;Me<as.length;Me+=1){const _s=Rn(le,as,Me);Je[Me]?Je[Me].p(_s,Le):(Je[Me]=Nn(_s),Je[Me].c(),Je[Me].m(ot,null))}for(;Me<Je.length;Me+=1)Je[Me].d(1);Je.length=as.length,!as.length&&ve?ve.p(le,Le):as.length?ve&&(ve.d(1),ve=null):(ve=jn(),ve.c(),ve.m(ot,null))}},d(le){le&&d(e),To(Oe,le),_t&&_t.d(),To(Je,le),ve&&ve.d(),It=!1,Jt(Rt)}}}function Fn(s){let e,t="No referrer data available";return{c(){e=h("div"),e.textContent=t,this.h()},l(r){e=g(r,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-vgmp68"&&(e.textContent=t),this.h()},h(){a(e,"class","text-sm text-dark-text-muted")},m(r,o){Y(r,e,o)},p:Ge,d(r){r&&d(e)}}}function Bn(s){let e,t,r=s[16].source+"",o,n,i,u=s[16].count+"",c,f;return{c(){e=h("div"),t=h("span"),o=L(r),n=C(),i=h("span"),c=L(u),f=C(),this.h()},l(m){e=g(m,"DIV",{class:!0});var p=v(e);t=g(p,"SPAN",{class:!0});var b=v(t);o=O(b,r),b.forEach(d),n=D(p),i=g(p,"SPAN",{class:!0});var w=v(i);c=O(w,u),w.forEach(d),f=D(p),p.forEach(d),this.h()},h(){a(t,"class","text-dark-text-secondary"),a(i,"class","text-magic-400"),a(e,"class","flex items-center justify-between text-sm")},m(m,p){Y(m,e,p),l(e,t),l(t,o),l(e,n),l(e,i),l(i,c),l(e,f)},p:Ge,d(m){m&&d(e)}}}function jn(s){let e,t="No error data (good!)";return{c(){e=h("div"),e.textContent=t,this.h()},l(r){e=g(r,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-b9oudv"&&(e.textContent=t),this.h()},h(){a(e,"class","text-sm text-dark-text-muted")},m(r,o){Y(r,e,o)},p:Ge,d(r){r&&d(e)}}}function Nn(s){let e,t,r=s[12]+"",o,n,i,u=s[13]+"",c,f;return{c(){e=h("div"),t=h("span"),o=L(r),n=C(),i=h("span"),c=L(u),f=C(),this.h()},l(m){e=g(m,"DIV",{class:!0});var p=v(e);t=g(p,"SPAN",{class:!0});var b=v(t);o=O(b,r),b.forEach(d),n=D(p),i=g(p,"SPAN",{class:!0});var w=v(i);c=O(w,u),w.forEach(d),f=D(p),p.forEach(d),this.h()},h(){a(t,"class","text-dark-text-secondary"),a(i,"class","text-red-400"),a(e,"class","flex items-center justify-between text-sm")},m(m,p){Y(m,e,p),l(e,t),l(t,o),l(e,n),l(e,i),l(i,c),l(e,f)},p:Ge,d(m){m&&d(e)}}}function fc(s){let e,t=s[0]&&s[1]&&Vn(s);return{c(){t&&t.c(),e=cs()},l(r){t&&t.l(r),e=cs()},m(r,o){t&&t.m(r,o),Y(r,e,o)},p(r,[o]){r[0]&&r[1]?t?t.p(r,o):(t=Vn(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ge,o:Ge,d(r){r&&d(e),t&&t.d(r)}}}function Oo(s,e,t=!1){const r=t?s:s/e*100;return r>=90?"text-green-400":r>=70?"text-yellow-400":"text-red-400"}function Ln(s,e){return Math.min(s/e*100,100)}function hc(s,e,t){let r,o,n,{visible:i=!1}=e,{isDevMode:u=!1}=e;const c=Er();let f=ut.metrics,m;const p={uniqueActiveUsers:250,taskCompletionRate:95,sessionContinuityRate:15,avgProcessingTime:5,npsScore:0,feedbackSubmissions:15};let b={uniqueActiveUsers:0,totalSessions:0,totalImages:0,successfulProcessings:0,failedProcessings:0,avgProcessingTime:0,under5SecondRate:0,sessionContinuityCount:0,npsResponses:[],feedbackSubmissions:0,topReferrers:[],errorCategories:{},hourlyMetrics:[]};Cr(()=>(i&&u&&(m=setInterval(()=>{t(2,f=ut.metrics)},5e3)),()=>{m&&clearInterval(m)}));function w(){const y={timestamp:new Date().toISOString(),sessionMetrics:f,analyticsData:b,kpiTargets:p},V=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),S=URL.createObjectURL(V),k=document.createElement("a");k.href=S,k.download=`charactercut-analytics-${Date.now()}.json`,k.click(),URL.revokeObjectURL(S)}const _=()=>c("close");return s.$$set=y=>{"visible"in y&&t(0,i=y.visible),"isDevMode"in y&&t(1,u=y.isDevMode)},t(5,r=b.totalImages>0?b.successfulProcessings/b.totalImages*100:0),t(4,o=b.totalSessions>0?b.sessionContinuityCount/b.totalSessions*100:0),t(3,n=b.npsResponses.length>0?b.npsResponses.reduce((y,V)=>y+V,0)/b.npsResponses.length:0),[i,u,f,n,o,r,c,p,b,w,_]}class gc extends Rs{constructor(e){super(),As(this,e,hc,fc,Ps,{visible:0,isDevMode:1})}}function On(s){let e,t,r,o,n="Refine Your Character",i,u,c="Use the brush tools to restore or remove parts as needed",f,m,p='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',b,w,_,y,V='<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',S,k,M,A,x,R,I,U,B,T,j,G="Tools",z,H,E,F,P="Quick Background Tools",N,K,q="Quickly erase or restore similar background colors",X,re,Q,te,ee,oe,ne,ke,ae="Tolerance",be,Ie,J,Ae,_e='<span class="slider-label-left svelte-1uc1frf">Precise</span> <span class="slider-label-right svelte-1uc1frf">Broad</span>',ce,de,ue,ye,Re,Qe,Ue,Te,je,At,jt,qe,me,Se,Pe,at,pt,nt,us,mt,it,St,ls,Xt,Qt,ct,Nt,Mt,Or,cr,Dr,Lt,dt,kt,ds,Ir,Sr,wt,Zt,Mr="Brush Size",Tr,$t,Vt,W,$,ie,Ee,He,he,xe,we="Background Sensitivity",tt,fe,Fe="Adjust how aggressively backgrounds are removed",Ve,Be,We,Ke,st,Xe,bt,Ye,Ze=s[4]<30?"Aggressive":s[4]>70?"Conservative":"Balanced",rt,yt,Ne,Et,Ot,zr='<span class="slider-label-left svelte-1uc1frf">Aggressive</span> <span class="slider-label-right svelte-1uc1frf">Conservative</span>',zt,fs,Vs,xo="Edge Refinement",so,Tt,Fs="Smooth and refine edges around complex areas",Bs,hs,Ss,Ut,ur,Ur,ro,js,xr=s[5]<30?"Sharp":s[5]>70?"Smooth":"Balanced",Ns,Ls,Ht,Os,dr,Po='<span class="slider-label-left svelte-1uc1frf">Sharp</span> <span class="slider-label-right svelte-1uc1frf">Smooth</span>',oo,Ms,xt,zs="Actions",Us,Hs,es,Pt,ns,Hr,fr,Gr,Gt,gs,ts,Gs,qr,qs,Ws,Ys,Ro="Preview",lo,Ft,Bt,qt,Ao,hr,Ks="Show Original Background",Vo,no,gr,Wt,mr,ao,ms,vr,pr,Js,Pr,vs,Yt,Ts,Xs,Qs,ps,bs,io,Ct,Zs,Wo,Dt=!s[21]&&zn(),ot=s[22]&&Un(),It=s[8]&&Hn(),Rt=s[8]&&Gn(),lt=s[21]&&qn(),Oe=s[17]&&Wn(s);function _t(ve,le){return ve[20]?kc:_c}let as=_t(s),Je=as(s);return{c(){e=h("div"),t=h("div"),r=h("div"),o=h("h3"),o.textContent=n,i=C(),u=h("p"),u.textContent=c,f=C(),m=h("button"),m.innerHTML=p,b=C(),w=h("div"),_=h("div"),y=h("button"),y.innerHTML=V,S=C(),k=h("button"),M=Ce("svg"),A=Ce("path"),R=C(),Dt&&Dt.c(),U=C(),B=h("div"),T=h("div"),j=h("h4"),j.textContent=G,z=C(),ot&&ot.c(),H=C(),E=h("div"),F=h("h4"),F.textContent=P,N=C(),K=h("p"),K.textContent=q,X=C(),re=h("div"),Q=h("div"),te=h("span"),ee=L(s[7]),oe=L("%"),ne=C(),ke=h("span"),ke.textContent=ae,be=C(),Ie=h("input"),J=C(),Ae=h("div"),Ae.innerHTML=_e,ce=C(),de=h("div"),ue=h("button"),ye=Ce("svg"),Re=Ce("path"),Qe=L(`\r
                  Smart Background Erase\r
                  `),It&&It.c(),Ue=C(),Te=h("button"),je=Ce("svg"),At=Ce("path"),jt=L(`\r
                  Smart Background Restore\r
                  `),Rt&&Rt.c(),qe=C(),me=h("div"),Se=h("button"),Pe=Ce("svg"),at=Ce("path"),pt=L(`\r
                Restore`),us=C(),mt=h("button"),it=Ce("svg"),St=Ce("path"),ls=L(`\r
                Erase`),Qt=C(),ct=h("button"),Nt=Ce("svg"),Mt=Ce("path"),Or=L(`\r
                Precision Erase`),Dr=C(),Lt=h("button"),dt=Ce("svg"),kt=Ce("path"),ds=L(`\r
                Edge Refine`),Sr=C(),wt=h("div"),Zt=h("h4"),Zt.textContent=Mr,Tr=C(),$t=h("div"),Vt=h("input"),W=C(),$=h("span"),ie=L(s[0]),Ee=L("px"),He=C(),he=h("div"),xe=h("h4"),xe.textContent=we,tt=C(),fe=h("p"),fe.textContent=Fe,Ve=C(),Be=h("div"),We=h("div"),Ke=h("span"),st=L(s[4]),Xe=L("%"),bt=C(),Ye=h("span"),rt=L(Ze),yt=C(),Ne=h("input"),Et=C(),Ot=h("div"),Ot.innerHTML=zr,zt=C(),fs=h("div"),Vs=h("h4"),Vs.textContent=xo,so=C(),Tt=h("p"),Tt.textContent=Fs,Bs=C(),hs=h("div"),Ss=h("div"),Ut=h("span"),ur=L(s[5]),Ur=L("%"),ro=C(),js=h("span"),Ns=L(xr),Ls=C(),Ht=h("input"),Os=C(),dr=h("div"),dr.innerHTML=Po,oo=C(),Ms=h("div"),xt=h("h4"),xt.textContent=zs,Us=C(),Hs=h("div"),es=h("button"),Pt=Ce("svg"),ns=Ce("path"),Hr=L(`\r
                Undo`),Gr=C(),Gt=h("button"),gs=Ce("svg"),ts=Ce("path"),Gs=L(`\r
                Clear`),qs=C(),Ws=h("div"),Ys=h("h4"),Ys.textContent=Ro,lo=C(),Ft=h("div"),Bt=h("label"),qt=h("input"),Ao=C(),hr=h("span"),hr.textContent=Ks,Vo=C(),lt&&lt.c(),no=C(),gr=h("div"),Wt=h("div"),mr=h("canvas"),ao=C(),ms=h("canvas"),vr=C(),pr=h("canvas"),Js=C(),Pr=h("div"),vs=h("div"),Yt=h("canvas"),Ts=C(),Oe&&Oe.c(),Xs=C(),Qs=h("div"),ps=h("button"),bs=L("Cancel"),io=C(),Ct=h("button"),Je.c(),this.h()},l(ve){e=g(ve,"DIV",{class:!0});var le=v(e);t=g(le,"DIV",{class:!0});var Le=v(t);r=g(Le,"DIV",{class:!0});var Me=v(r);o=g(Me,"H3",{class:!0,"data-svelte-h":!0}),Z(o)!=="svelte-11bkcbn"&&(o.textContent=n),i=D(Me),u=g(Me,"P",{class:!0,"data-svelte-h":!0}),Z(u)!=="svelte-1m78v9d"&&(u.textContent=c),f=D(Me),m=g(Me,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),Z(m)!=="svelte-by1gp6"&&(m.innerHTML=p),Me.forEach(d),b=D(Le),w=g(Le,"DIV",{class:!0});var _s=v(w);_=g(_s,"DIV",{class:!0});var ks=v(_);y=g(ks,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Z(y)!=="svelte-1n89qtf"&&(y.innerHTML=V),S=D(ks),k=g(ks,"BUTTON",{class:!0,title:!0});var Rr=v(k);M=De(Rr,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var co=v(M);A=De(co,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(A).forEach(d),co.forEach(d),R=D(Rr),Dt&&Dt.l(Rr),Rr.forEach(d),U=D(ks),B=g(ks,"DIV",{class:!0});var vt=v(B);T=g(vt,"DIV",{class:!0});var ws=v(T);j=g(ws,"H4",{class:!0,"data-svelte-h":!0}),Z(j)!=="svelte-1vaf36c"&&(j.textContent=G),z=D(ws),ot&&ot.l(ws),H=D(ws),E=g(ws,"DIV",{class:!0});var $s=v(E);F=g($s,"H4",{class:!0,"data-svelte-h":!0}),Z(F)!=="svelte-14zij43"&&(F.textContent=P),N=D($s),K=g($s,"P",{class:!0,"data-svelte-h":!0}),Z(K)!=="svelte-bbfgqr"&&(K.textContent=q),X=D($s),re=g($s,"DIV",{class:!0});var er=v(re);Q=g(er,"DIV",{class:!0});var uo=v(Q);te=g(uo,"SPAN",{class:!0});var Wr=v(te);ee=O(Wr,s[7]),oe=O(Wr,"%"),Wr.forEach(d),ne=D(uo),ke=g(uo,"SPAN",{class:!0,"data-svelte-h":!0}),Z(ke)!=="svelte-16j1jyi"&&(ke.textContent=ae),uo.forEach(d),be=D(er),Ie=g(er,"INPUT",{type:!0,min:!0,max:!0,class:!0,title:!0}),J=D(er),Ae=g(er,"DIV",{class:!0,"data-svelte-h":!0}),Z(Ae)!=="svelte-1oviiyu"&&(Ae.innerHTML=_e),er.forEach(d),ce=D($s),de=g($s,"DIV",{class:!0});var Yr=v(de);ue=g(Yr,"BUTTON",{class:!0,title:!0});var Ar=v(ue);ye=De(Ar,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var fo=v(ye);Re=De(fo,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(Re).forEach(d),fo.forEach(d),Qe=O(Ar,`\r
                  Smart Background Erase\r
                  `),It&&It.l(Ar),Ar.forEach(d),Ue=D(Yr),Te=g(Yr,"BUTTON",{class:!0,title:!0});var tr=v(Te);je=De(tr,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var ss=v(je);At=De(ss,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(At).forEach(d),ss.forEach(d),jt=O(tr,`\r
                  Smart Background Restore\r
                  `),Rt&&Rt.l(tr),tr.forEach(d),Yr.forEach(d),$s.forEach(d),qe=D(ws),me=g(ws,"DIV",{class:!0});var rs=v(me);Se=g(rs,"BUTTON",{class:!0,title:!0});var Kr=v(Se);Pe=De(Kr,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var ho=v(Pe);at=De(ho,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(at).forEach(d),ho.forEach(d),pt=O(Kr,`\r
                Restore`),Kr.forEach(d),us=D(rs),mt=g(rs,"BUTTON",{class:!0,title:!0});var Fo=v(mt);it=De(Fo,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var Bo=v(it);St=De(Bo,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(St).forEach(d),Bo.forEach(d),ls=O(Fo,`\r
                Erase`),Fo.forEach(d),Qt=D(rs),ct=g(rs,"BUTTON",{class:!0,title:!0});var br=v(ct);Nt=De(br,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var go=v(Nt);Mt=De(go,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(Mt).forEach(d),go.forEach(d),Or=O(br,`\r
                Precision Erase`),br.forEach(d),Dr=D(rs),Lt=g(rs,"BUTTON",{class:!0,title:!0});var mo=v(Lt);dt=De(mo,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var Yo=v(dt);kt=De(Yo,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(kt).forEach(d),Yo.forEach(d),ds=O(mo,`\r
                Edge Refine`),mo.forEach(d),rs.forEach(d),ws.forEach(d),Sr=D(vt),wt=g(vt,"DIV",{class:!0});var Vr=v(wt);Zt=g(Vr,"H4",{class:!0,"data-svelte-h":!0}),Z(Zt)!=="svelte-146efaw"&&(Zt.textContent=Mr),Tr=D(Vr),$t=g(Vr,"DIV",{class:!0});var sr=v($t);Vt=g(sr,"INPUT",{type:!0,min:!0,max:!0,class:!0}),W=D(sr),$=g(sr,"SPAN",{class:!0});var Jr=v($);ie=O(Jr,s[0]),Ee=O(Jr,"px"),Jr.forEach(d),sr.forEach(d),Vr.forEach(d),He=D(vt),he=g(vt,"DIV",{class:!0});var _r=v(he);xe=g(_r,"H4",{class:!0,"data-svelte-h":!0}),Z(xe)!=="svelte-9gml6u"&&(xe.textContent=we),tt=D(_r),fe=g(_r,"P",{class:!0,"data-svelte-h":!0}),Z(fe)!=="svelte-kxjk38"&&(fe.textContent=Fe),Ve=D(_r),Be=g(_r,"DIV",{class:!0});var Fr=v(Be);We=g(Fr,"DIV",{class:!0});var rr=v(We);Ke=g(rr,"SPAN",{class:!0});var kr=v(Ke);st=O(kr,s[4]),Xe=O(kr,"%"),kr.forEach(d),bt=D(rr),Ye=g(rr,"SPAN",{class:!0});var vo=v(Ye);rt=O(vo,Ze),vo.forEach(d),rr.forEach(d),yt=D(Fr),Ne=g(Fr,"INPUT",{type:!0,min:!0,max:!0,class:!0,title:!0}),Et=D(Fr),Ot=g(Fr,"DIV",{class:!0,"data-svelte-h":!0}),Z(Ot)!=="svelte-5u3kng"&&(Ot.innerHTML=zr),Fr.forEach(d),_r.forEach(d),zt=D(vt),fs=g(vt,"DIV",{class:!0});var wr=v(fs);Vs=g(wr,"H4",{class:!0,"data-svelte-h":!0}),Z(Vs)!=="svelte-12zcvhb"&&(Vs.textContent=xo),so=D(wr),Tt=g(wr,"P",{class:!0,"data-svelte-h":!0}),Z(Tt)!=="svelte-n26lkc"&&(Tt.textContent=Fs),Bs=D(wr),hs=g(wr,"DIV",{class:!0});var Br=v(hs);Ss=g(Br,"DIV",{class:!0});var Xr=v(Ss);Ut=g(Xr,"SPAN",{class:!0});var yr=v(Ut);ur=O(yr,s[5]),Ur=O(yr,"%"),yr.forEach(d),ro=D(Xr),js=g(Xr,"SPAN",{class:!0});var po=v(js);Ns=O(po,xr),po.forEach(d),Xr.forEach(d),Ls=D(Br),Ht=g(Br,"INPUT",{type:!0,min:!0,max:!0,class:!0,title:!0}),Os=D(Br),dr=g(Br,"DIV",{class:!0,"data-svelte-h":!0}),Z(dr)!=="svelte-1641p63"&&(dr.innerHTML=Po),Br.forEach(d),wr.forEach(d),oo=D(vt),Ms=g(vt,"DIV",{class:!0});var Qr=v(Ms);xt=g(Qr,"H4",{class:!0,"data-svelte-h":!0}),Z(xt)!=="svelte-ak7yp4"&&(xt.textContent=zs),Us=D(Qr),Hs=g(Qr,"DIV",{class:!0});var bo=v(Hs);es=g(bo,"BUTTON",{class:!0,title:!0});var _o=v(es);Pt=De(_o,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var jr=v(Pt);ns=De(jr,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(ns).forEach(d),jr.forEach(d),Hr=O(_o,`\r
                Undo`),_o.forEach(d),Gr=D(bo),Gt=g(bo,"BUTTON",{class:!0,title:!0});var Zr=v(Gt);gs=De(Zr,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var ko=v(gs);ts=De(ko,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(ts).forEach(d),ko.forEach(d),Gs=O(Zr,`\r
                Clear`),Zr.forEach(d),bo.forEach(d),Qr.forEach(d),qs=D(vt),Ws=g(vt,"DIV",{class:!0});var wo=v(Ws);Ys=g(wo,"H4",{class:!0,"data-svelte-h":!0}),Z(Ys)!=="svelte-pucr7p"&&(Ys.textContent=Ro),lo=D(wo),Ft=g(wo,"DIV",{class:!0});var yo=v(Ft);Bt=g(yo,"LABEL",{class:!0});var Nr=v(Bt);qt=g(Nr,"INPUT",{type:!0,class:!0}),Ao=D(Nr),hr=g(Nr,"SPAN",{"data-svelte-h":!0}),Z(hr)!=="svelte-1x3nz3i"&&(hr.textContent=Ks),Nr.forEach(d),yo.forEach(d),wo.forEach(d),vt.forEach(d),Vo=D(ks),lt&&lt.l(ks),ks.forEach(d),no=D(_s),gr=g(_s,"DIV",{class:!0});var jo=v(gr);Wt=g(jo,"DIV",{class:!0});var ys=v(Wt);mr=g(ys,"CANVAS",{class:!0}),v(mr).forEach(d),ao=D(ys),ms=g(ys,"CANVAS",{class:!0}),v(ms).forEach(d),vr=D(ys),pr=g(ys,"CANVAS",{class:!0}),v(pr).forEach(d),Js=D(ys),Pr=g(ys,"DIV",{class:!0});var No=v(Pr);vs=g(No,"DIV",{class:!0});var xs=v(vs);Yt=g(xs,"CANVAS",{class:!0,style:!0}),v(Yt).forEach(d),Ts=D(xs),Oe&&Oe.l(xs),xs.forEach(d),No.forEach(d),ys.forEach(d),jo.forEach(d),_s.forEach(d),Xs=D(Le),Qs=g(Le,"DIV",{class:!0});var sl=v(Qs);ps=g(sl,"BUTTON",{class:!0});var Cl=v(ps);bs=O(Cl,"Cancel"),Cl.forEach(d),io=D(sl),Ct=g(sl,"BUTTON",{class:!0});var Dl=v(Ct);Je.l(Dl),Dl.forEach(d),sl.forEach(d),Le.forEach(d),le.forEach(d),this.h()},h(){a(o,"class","text-xl font-semibold text-magic-gradient"),a(u,"class","text-sm text-dark-text-secondary mt-1"),a(m,"class","close-button svelte-1uc1frf"),a(m,"aria-label","Close refinement editor"),a(r,"class","refinement-header svelte-1uc1frf"),a(y,"class","tool-info-button-header svelte-1uc1frf"),a(y,"title","Show tool descriptions"),a(A,"stroke-linecap","round"),a(A,"stroke-linejoin","round"),a(A,"stroke-width","2"),a(A,"d","M15 19l-7-7 7-7"),a(M,"class",x="w-4 h-4 "+(s[21]?"rotate-180":"")+" svelte-1uc1frf"),a(M,"fill","none"),a(M,"stroke","currentColor"),a(M,"viewBox","0 0 24 24"),a(k,"class","collapse-toggle svelte-1uc1frf"),a(k,"title",I=s[21]?"Expand Controls":"Collapse Controls"),a(j,"class","section-title svelte-1uc1frf"),a(F,"class","section-title svelte-1uc1frf"),a(K,"class","control-description svelte-1uc1frf"),a(te,"class","slider-value svelte-1uc1frf"),a(ke,"class","slider-status svelte-1uc1frf"),a(Q,"class","slider-value-display svelte-1uc1frf"),a(Ie,"type","range"),a(Ie,"min","1"),a(Ie,"max","50"),a(Ie,"class","tolerance-slider svelte-1uc1frf"),a(Ie,"title","Color similarity tolerance for background operations"),a(Ae,"class","slider-labels svelte-1uc1frf"),a(re,"class","background-tolerance-controls svelte-1uc1frf"),a(Re,"stroke-linecap","round"),a(Re,"stroke-linejoin","round"),a(Re,"stroke-width","2"),a(Re,"d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"),a(ye,"class","w-3 h-3"),a(ye,"fill","none"),a(ye,"stroke","currentColor"),a(ye,"viewBox","0 0 24 24"),a(ue,"class","quick-bg-btn erase svelte-1uc1frf"),a(ue,"title","Click on background area to erase similar colors (hover to preview affected areas)"),ue.disabled=s[3],a(At,"stroke-linecap","round"),a(At,"stroke-linejoin","round"),a(At,"stroke-width","2"),a(At,"d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"),a(je,"class","w-3 h-3"),a(je,"fill","none"),a(je,"stroke","currentColor"),a(je,"viewBox","0 0 24 24"),a(Te,"class","quick-bg-btn restore svelte-1uc1frf"),a(Te,"title","Click on area to restore similar background colors (hover to preview affected areas)"),Te.disabled=s[3],a(de,"class","quick-background-buttons svelte-1uc1frf"),a(E,"class","background-tools-section svelte-1uc1frf"),a(at,"stroke-linecap","round"),a(at,"stroke-linejoin","round"),a(at,"stroke-width","2"),a(at,"d","M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"),a(Pe,"class","w-3 h-3 svelte-1uc1frf"),a(Pe,"fill","none"),a(Pe,"stroke","currentColor"),a(Pe,"viewBox","0 0 24 24"),a(Se,"class",nt="tool-button "+(s[13]==="restore"?"active":"")+" svelte-1uc1frf"),a(Se,"title","Basic brush - restore original pixels"),a(St,"stroke-linecap","round"),a(St,"stroke-linejoin","round"),a(St,"stroke-width","2"),a(St,"d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"),a(it,"class","w-3 h-3 svelte-1uc1frf"),a(it,"fill","none"),a(it,"stroke","currentColor"),a(it,"viewBox","0 0 24 24"),a(mt,"class",Xt="tool-button "+(s[13]==="erase"?"active":"")+" svelte-1uc1frf"),a(mt,"title","Basic eraser - remove pixels to make transparent"),a(Mt,"stroke-linecap","round"),a(Mt,"stroke-linejoin","round"),a(Mt,"stroke-width","2"),a(Mt,"d","M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"),a(Nt,"class","w-3 h-3 svelte-1uc1frf"),a(Nt,"fill","none"),a(Nt,"stroke","currentColor"),a(Nt,"viewBox","0 0 24 24"),a(ct,"class",cr="tool-button "+(s[13]==="precision-erase"?"active":"")+" svelte-1uc1frf"),a(ct,"title","Precision eraser - smaller, more accurate removal"),a(kt,"stroke-linecap","round"),a(kt,"stroke-linejoin","round"),a(kt,"stroke-width","2"),a(kt,"d","M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"),a(dt,"class","w-3 h-3 svelte-1uc1frf"),a(dt,"fill","none"),a(dt,"stroke","currentColor"),a(dt,"viewBox","0 0 24 24"),a(Lt,"class",Ir="tool-button "+(s[13]==="edge-refine"?"active":"")+" svelte-1uc1frf"),a(Lt,"title","Edge refine - smooth and blend edge transitions"),a(me,"class","tool-buttons svelte-1uc1frf"),a(T,"class","tool-section"),a(Zt,"class","section-title svelte-1uc1frf"),a(Vt,"type","range"),a(Vt,"min","5"),a(Vt,"max","100"),a(Vt,"class","brush-slider svelte-1uc1frf"),a($,"class","brush-size-display svelte-1uc1frf"),a($t,"class","brush-controls svelte-1uc1frf"),a(wt,"class","brush-section"),a(xe,"class","section-title svelte-1uc1frf"),a(fe,"class","control-description svelte-1uc1frf"),a(Ke,"class","slider-value svelte-1uc1frf"),a(Ye,"class","slider-status svelte-1uc1frf"),a(We,"class","slider-value-display svelte-1uc1frf"),a(Ne,"type","range"),a(Ne,"min","0"),a(Ne,"max","100"),a(Ne,"class","sensitivity-slider svelte-1uc1frf"),a(Ne,"title","Lower = Remove more background, Higher = Keep more detail"),a(Ot,"class","slider-labels svelte-1uc1frf"),a(Be,"class","sensitivity-controls svelte-1uc1frf"),a(he,"class","sensitivity-section"),a(Vs,"class","section-title svelte-1uc1frf"),a(Tt,"class","control-description svelte-1uc1frf"),a(Ut,"class","slider-value svelte-1uc1frf"),a(js,"class","slider-status svelte-1uc1frf"),a(Ss,"class","slider-value-display svelte-1uc1frf"),a(Ht,"type","range"),a(Ht,"min","0"),a(Ht,"max","100"),a(Ht,"class","edge-slider svelte-1uc1frf"),a(Ht,"title","Higher values create smoother, softer edges"),a(dr,"class","slider-labels svelte-1uc1frf"),a(hs,"class","edge-controls svelte-1uc1frf"),a(fs,"class","edge-section"),a(xt,"class","section-title svelte-1uc1frf"),a(ns,"stroke-linecap","round"),a(ns,"stroke-linejoin","round"),a(ns,"stroke-width","2"),a(ns,"d","M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"),a(Pt,"class","w-3 h-3"),a(Pt,"fill","none"),a(Pt,"stroke","currentColor"),a(Pt,"viewBox","0 0 24 24"),a(es,"class","action-btn svelte-1uc1frf"),a(es,"title","Undo last stroke"),es.disabled=fr=!s[23],a(ts,"stroke-linecap","round"),a(ts,"stroke-linejoin","round"),a(ts,"stroke-width","2"),a(ts,"d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"),a(gs,"class","w-3 h-3"),a(gs,"fill","none"),a(gs,"stroke","currentColor"),a(gs,"viewBox","0 0 24 24"),a(Gt,"class","action-btn svelte-1uc1frf"),a(Gt,"title","Clear all changes"),Gt.disabled=qr=!s[19],a(Hs,"class","action-buttons svelte-1uc1frf"),a(Ms,"class","actions-section"),a(Ys,"class","section-title svelte-1uc1frf"),a(qt,"type","checkbox"),a(qt,"class","svelte-1uc1frf"),a(Bt,"class","preview-toggle svelte-1uc1frf"),a(Ft,"class","preview-controls"),a(Ws,"class","preview-section"),a(B,"class","controls-content svelte-1uc1frf"),ze(B,"hidden",s[21]),a(_,"class","controls-panel svelte-1uc1frf"),ze(_,"collapsed",s[21]),a(mr,"class","hidden svelte-1uc1frf"),a(ms,"class","hidden svelte-1uc1frf"),a(pr,"class","hidden svelte-1uc1frf"),a(Yt,"class","editing-canvas svelte-1uc1frf"),ge(Yt,"cursor","none"),a(vs,"class","canvas-container svelte-1uc1frf"),a(Pr,"class","editing-canvas-wrapper svelte-1uc1frf"),a(Wt,"class","main-canvas-container svelte-1uc1frf"),a(gr,"class","canvas-area svelte-1uc1frf"),a(w,"class","editor-layout svelte-1uc1frf"),a(ps,"class","btn btn-outline border-dark-border text-dark-text-secondary hover:bg-dark-border hover:text-white px-6 py-3 rounded-lg font-medium"),ps.disabled=s[20],a(Ct,"class","btn btn-magic px-6 py-3 rounded-lg font-medium"),Ct.disabled=s[20],a(Qs,"class","refinement-footer svelte-1uc1frf"),a(t,"class","refinement-container svelte-1uc1frf"),a(e,"class","refinement-overlay svelte-1uc1frf")},m(ve,le){Y(ve,e,le),l(e,t),l(t,r),l(r,o),l(r,i),l(r,u),l(r,f),l(r,m),l(t,b),l(t,w),l(w,_),l(_,y),l(_,S),l(_,k),l(k,M),l(M,A),l(k,R),Dt&&Dt.m(k,null),l(_,U),l(_,B),l(B,T),l(T,j),l(T,z),ot&&ot.m(T,null),l(T,H),l(T,E),l(E,F),l(E,N),l(E,K),l(E,X),l(E,re),l(re,Q),l(Q,te),l(te,ee),l(te,oe),l(Q,ne),l(Q,ke),l(re,be),l(re,Ie),os(Ie,s[7]),l(re,J),l(re,Ae),l(E,ce),l(E,de),l(de,ue),l(ue,ye),l(ye,Re),l(ue,Qe),It&&It.m(ue,null),l(de,Ue),l(de,Te),l(Te,je),l(je,At),l(Te,jt),Rt&&Rt.m(Te,null),l(T,qe),l(T,me),l(me,Se),l(Se,Pe),l(Pe,at),l(Se,pt),l(me,us),l(me,mt),l(mt,it),l(it,St),l(mt,ls),l(me,Qt),l(me,ct),l(ct,Nt),l(Nt,Mt),l(ct,Or),l(me,Dr),l(me,Lt),l(Lt,dt),l(dt,kt),l(Lt,ds),l(B,Sr),l(B,wt),l(wt,Zt),l(wt,Tr),l(wt,$t),l($t,Vt),os(Vt,s[0]),l($t,W),l($t,$),l($,ie),l($,Ee),l(B,He),l(B,he),l(he,xe),l(he,tt),l(he,fe),l(he,Ve),l(he,Be),l(Be,We),l(We,Ke),l(Ke,st),l(Ke,Xe),l(We,bt),l(We,Ye),l(Ye,rt),l(Be,yt),l(Be,Ne),os(Ne,s[4]),l(Be,Et),l(Be,Ot),l(B,zt),l(B,fs),l(fs,Vs),l(fs,so),l(fs,Tt),l(fs,Bs),l(fs,hs),l(hs,Ss),l(Ss,Ut),l(Ut,ur),l(Ut,Ur),l(Ss,ro),l(Ss,js),l(js,Ns),l(hs,Ls),l(hs,Ht),os(Ht,s[5]),l(hs,Os),l(hs,dr),l(B,oo),l(B,Ms),l(Ms,xt),l(Ms,Us),l(Ms,Hs),l(Hs,es),l(es,Pt),l(Pt,ns),l(es,Hr),l(Hs,Gr),l(Hs,Gt),l(Gt,gs),l(gs,ts),l(Gt,Gs),l(B,qs),l(B,Ws),l(Ws,Ys),l(Ws,lo),l(Ws,Ft),l(Ft,Bt),l(Bt,qt),qt.checked=s[6],l(Bt,Ao),l(Bt,hr),l(_,Vo),lt&&lt.m(_,null),l(w,no),l(w,gr),l(gr,Wt),l(Wt,mr),s[54](mr),l(Wt,ao),l(Wt,ms),s[55](ms),l(Wt,vr),l(Wt,pr),s[56](pr),l(Wt,Js),l(Wt,Pr),l(Pr,vs),l(vs,Yt),s[57](Yt),l(vs,Ts),Oe&&Oe.m(vs,null),s[58](Wt),l(t,Xs),l(t,Qs),l(Qs,ps),l(ps,bs),l(Qs,io),l(Qs,Ct),Je.m(Ct,null),Zs||(Wo=[se(m,"click",s[32]),se(y,"click",s[43]),se(k,"click",s[44]),se(Ie,"change",s[45]),se(Ie,"input",s[45]),se(ue,"click",s[26]),se(ue,"mouseenter",s[28]),se(ue,"mouseleave",s[29]),se(Te,"click",s[27]),se(Te,"mouseenter",s[28]),se(Te,"mouseleave",s[29]),se(Se,"click",s[46]),se(mt,"click",s[47]),se(ct,"click",s[48]),se(Lt,"click",s[49]),se(Vt,"change",s[50]),se(Vt,"input",s[50]),se(Ne,"change",s[51]),se(Ne,"input",s[51]),se(Ht,"change",s[52]),se(Ht,"input",s[52]),se(es,"click",s[30]),se(Gt,"click",s[25]),se(qt,"change",s[53]),se(ps,"click",s[32]),se(Ct,"click",s[31]),se(e,"click",ga(s[32]))],Zs=!0)},p(ve,le){le[0]&2097152&&x!==(x="w-4 h-4 "+(ve[21]?"rotate-180":"")+" svelte-1uc1frf")&&a(M,"class",x),ve[21]?Dt&&(Dt.d(1),Dt=null):Dt||(Dt=zn(),Dt.c(),Dt.m(k,null)),le[0]&2097152&&I!==(I=ve[21]?"Expand Controls":"Collapse Controls")&&a(k,"title",I),ve[22]?ot||(ot=Un(),ot.c(),ot.m(T,H)):ot&&(ot.d(1),ot=null),le[0]&128&&pe(ee,ve[7]),le[0]&128&&os(Ie,ve[7]),ve[8]?It||(It=Hn(),It.c(),It.m(ue,null)):It&&(It.d(1),It=null),le[0]&8&&(ue.disabled=ve[3]),ve[8]?Rt||(Rt=Gn(),Rt.c(),Rt.m(Te,null)):Rt&&(Rt.d(1),Rt=null),le[0]&8&&(Te.disabled=ve[3]),le[0]&8192&&nt!==(nt="tool-button "+(ve[13]==="restore"?"active":"")+" svelte-1uc1frf")&&a(Se,"class",nt),le[0]&8192&&Xt!==(Xt="tool-button "+(ve[13]==="erase"?"active":"")+" svelte-1uc1frf")&&a(mt,"class",Xt),le[0]&8192&&cr!==(cr="tool-button "+(ve[13]==="precision-erase"?"active":"")+" svelte-1uc1frf")&&a(ct,"class",cr),le[0]&8192&&Ir!==(Ir="tool-button "+(ve[13]==="edge-refine"?"active":"")+" svelte-1uc1frf")&&a(Lt,"class",Ir),le[0]&1&&os(Vt,ve[0]),le[0]&1&&pe(ie,ve[0]),le[0]&16&&pe(st,ve[4]),le[0]&16&&Ze!==(Ze=ve[4]<30?"Aggressive":ve[4]>70?"Conservative":"Balanced")&&pe(rt,Ze),le[0]&16&&os(Ne,ve[4]),le[0]&32&&pe(ur,ve[5]),le[0]&32&&xr!==(xr=ve[5]<30?"Sharp":ve[5]>70?"Smooth":"Balanced")&&pe(Ns,xr),le[0]&32&&os(Ht,ve[5]),le[0]&8388608&&fr!==(fr=!ve[23])&&(es.disabled=fr),le[0]&524288&&qr!==(qr=!ve[19])&&(Gt.disabled=qr),le[0]&64&&(qt.checked=ve[6]),le[0]&2097152&&ze(B,"hidden",ve[21]),ve[21]?lt||(lt=qn(),lt.c(),lt.m(_,null)):lt&&(lt.d(1),lt=null),le[0]&2097152&&ze(_,"collapsed",ve[21]),ve[17]?Oe?Oe.p(ve,le):(Oe=Wn(ve),Oe.c(),Oe.m(vs,null)):Oe&&(Oe.d(1),Oe=null),le[0]&1048576&&(ps.disabled=ve[20]),as===(as=_t(ve))&&Je?Je.p(ve,le):(Je.d(1),Je=as(ve),Je&&(Je.c(),Je.m(Ct,null))),le[0]&1048576&&(Ct.disabled=ve[20])},d(ve){ve&&d(e),Dt&&Dt.d(),ot&&ot.d(),It&&It.d(),Rt&&Rt.d(),lt&&lt.d(),s[54](null),s[55](null),s[56](null),s[57](null),Oe&&Oe.d(),s[58](null),Je.d(),Zs=!1,Jt(Wo)}}}function zn(s){let e,t="Collapse";return{c(){e=h("span"),e.textContent=t,this.h()},l(r){e=g(r,"SPAN",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-s9sp67"&&(e.textContent=t),this.h()},h(){a(e,"class","collapse-text")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function Un(s){let e,t='<div class="tool-info-item svelte-1uc1frf"><strong class="svelte-1uc1frf">Restore:</strong> Basic brush to bring back original background areas</div> <div class="tool-info-item svelte-1uc1frf"><strong class="svelte-1uc1frf">Smart Restore:</strong> Intelligent restoration with better edge blending and gradient effects</div> <div class="tool-info-item svelte-1uc1frf"><strong class="svelte-1uc1frf">Erase:</strong> Remove unwanted parts with a standard eraser</div> <div class="tool-info-item svelte-1uc1frf"><strong class="svelte-1uc1frf">Precision Erase:</strong> Smaller, more accurate eraser for detailed work</div> <div class="tool-info-item svelte-1uc1frf"><strong class="svelte-1uc1frf">Edge Refine:</strong> Smooth and blend edge transitions with gradient effects</div>';return{c(){e=h("div"),e.innerHTML=t,this.h()},l(r){e=g(r,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-sh0kv7"&&(e.innerHTML=t),this.h()},h(){a(e,"class","tool-info-panel svelte-1uc1frf")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function Hn(s){let e,t="ðŸ‘ï¸";return{c(){e=h("span"),e.textContent=t,this.h()},l(r){e=g(r,"SPAN",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-e6md0u"&&(e.textContent=t),this.h()},h(){a(e,"class","tolerance-preview-indicator svelte-1uc1frf")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function Gn(s){let e,t="ðŸ‘ï¸";return{c(){e=h("span"),e.textContent=t,this.h()},l(r){e=g(r,"SPAN",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-e6md0u"&&(e.textContent=t),this.h()},h(){a(e,"class","tolerance-preview-indicator svelte-1uc1frf")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function qn(s){let e,t='<div class="tool-indicator svelte-1uc1frf">ðŸ–Œï¸</div> <div class="collapse-help svelte-1uc1frf">Click arrow to expand tools</div>';return{c(){e=h("div"),e.innerHTML=t,this.h()},l(r){e=g(r,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-aoc44a"&&(e.innerHTML=t),this.h()},h(){a(e,"class","collapsed-hint svelte-1uc1frf")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function Wn(s){let e,t,r,o,n=s[18]&&!s[14]&&Yn(s);return{c(){e=h("div"),t=h("div"),r=C(),n&&n.c(),this.h()},l(i){e=g(i,"DIV",{class:!0,style:!0});var u=v(e);t=g(u,"DIV",{class:!0}),v(t).forEach(d),r=D(u),n&&n.l(u),u.forEach(d),this.h()},h(){a(t,"class","cursor-center svelte-1uc1frf"),a(e,"class",o="dynamic-brush-cursor "+s[13]+" svelte-1uc1frf"),ge(e,"left",s[15]+"px"),ge(e,"top",s[16]+"px"),ge(e,"width",s[24]+"px"),ge(e,"height",s[24]+"px"),ge(e,"opacity",s[14]?.3:.6),ze(e,"drawing",s[14])},m(i,u){Y(i,e,u),l(e,t),l(e,r),n&&n.m(e,null)},p(i,u){i[18]&&!i[14]?n?n.p(i,u):(n=Yn(i),n.c(),n.m(e,null)):n&&(n.d(1),n=null),u[0]&8192&&o!==(o="dynamic-brush-cursor "+i[13]+" svelte-1uc1frf")&&a(e,"class",o),u[0]&32768&&ge(e,"left",i[15]+"px"),u[0]&65536&&ge(e,"top",i[16]+"px"),u[0]&16777216&&ge(e,"width",i[24]+"px"),u[0]&16777216&&ge(e,"height",i[24]+"px"),u[0]&16384&&ge(e,"opacity",i[14]?.3:.6),u[0]&24576&&ze(e,"drawing",i[14])},d(i){i&&d(e),n&&n.d()}}}function Yn(s){let e,t,r;function o(u,c){if(u[13]==="restore")return bc;if(u[13]==="erase")return pc;if(u[13]==="precision-erase")return vc;if(u[13]==="edge-refine")return mc}let n=o(s),i=n&&n(s);return{c(){e=h("div"),t=h("div"),i&&i.c(),this.h()},l(u){e=g(u,"DIV",{class:!0});var c=v(e);t=g(c,"DIV",{class:!0});var f=v(t);i&&i.l(f),f.forEach(d),c.forEach(d),this.h()},h(){a(t,"class","preview-indicator svelte-1uc1frf"),a(e,"class",r="brush-preview-ring "+s[13]+" svelte-1uc1frf")},m(u,c){Y(u,e,c),l(e,t),i&&i.m(t,null)},p(u,c){n!==(n=o(u))&&(i&&i.d(1),i=n&&n(u),i&&(i.c(),i.m(t,null))),c[0]&8192&&r!==(r="brush-preview-ring "+u[13]+" svelte-1uc1frf")&&a(e,"class",r)},d(u){u&&d(e),i&&i.d()}}}function mc(s){let e;return{c(){e=L("âœ¨")},l(t){e=O(t,"âœ¨")},m(t,r){Y(t,e,r)},d(t){t&&d(e)}}}function vc(s){let e;return{c(){e=L("âœ•")},l(t){e=O(t,"âœ•")},m(t,r){Y(t,e,r)},d(t){t&&d(e)}}}function pc(s){let e;return{c(){e=L("âŒ«")},l(t){e=O(t,"âŒ«")},m(t,r){Y(t,e,r)},d(t){t&&d(e)}}}function bc(s){let e;return{c(){e=L("â†º")},l(t){e=O(t,"â†º")},m(t,r){Y(t,e,r)},d(t){t&&d(e)}}}function _c(s){let e=s[19]?"Apply Changes":"Use Current Image",t;return{c(){t=L(e)},l(r){t=O(r,e)},m(r,o){Y(r,t,o)},p(r,o){o[0]&524288&&e!==(e=r[19]?"Apply Changes":"Use Current Image")&&pe(t,e)},d(r){r&&d(t)}}}function kc(s){let e,t,r,o;return{c(){e=Ce("svg"),t=Ce("circle"),r=Ce("path"),o=L(`\r
            Applying...`),this.h()},l(n){e=De(n,"svg",{class:!0,fill:!0,viewBox:!0});var i=v(e);t=De(i,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),v(t).forEach(d),r=De(i,"path",{class:!0,fill:!0,d:!0}),v(r).forEach(d),i.forEach(d),o=O(n,`\r
            Applying...`),this.h()},h(){a(t,"class","opacity-25"),a(t,"cx","12"),a(t,"cy","12"),a(t,"r","10"),a(t,"stroke","currentColor"),a(t,"stroke-width","4"),a(r,"class","opacity-75"),a(r,"fill","currentColor"),a(r,"d","m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),a(e,"class","animate-spin w-5 h-5 mr-2"),a(e,"fill","none"),a(e,"viewBox","0 0 24 24")},m(n,i){Y(n,e,i),l(e,t),l(e,r),Y(n,o,i)},p:Ge,d(n){n&&(d(e),d(o))}}}function wc(s){let e,t=s[1]&&On(s);return{c(){t&&t.c(),e=cs()},l(r){t&&t.l(r),e=cs()},m(r,o){t&&t.m(r,o),Y(r,e,o)},p(r,o){r[1]?t?t.p(r,o):(t=On(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ge,o:Ge,d(r){r&&d(e),t&&t.d(r)}}}let Kn=20;function Jn(s,e,t,r,o,n){return Math.sqrt(Math.pow(r-s,2)+Math.pow(o-e,2)+Math.pow(n-t,2))}function yc(s,e,t){let r,o,{originalImage:n}=e,{processedImage:i}=e,{isVisible:u=!1}=e,{brushSize:c=20}=e;const f=Er();let m,p,b,w,_,y,V,S,k,M="restore",A=!1,x=!1,R=600,I=400,U=50,B=50,T=0,j=0,G=!1,z=!1,H,E,F=!1,P=!1,N=!1,K=!1,q=10,X=!1,re,Q,te=!1,ee=[],oe=-1;Cr(()=>{u&&Ie();const W=()=>{u&&H&&E&&(console.log("Window resized, adjusting canvas dimensions"),Ae(),_e())};return window.addEventListener("resize",W),()=>{window.removeEventListener("resize",W)}});let ne,ke,ae=U,be=B;async function Ie(){if(!(!p||!b||!w||!_)){console.log("Initializing canvas..."),console.log("Canvas elements:",{originalCanvas:p,processedCanvas:b,maskCanvas:w,previewCanvas:_}),y=p.getContext("2d",{willReadFrequently:!0}),V=b.getContext("2d",{willReadFrequently:!0}),S=w.getContext("2d",{willReadFrequently:!0}),t(35,k=_.getContext("2d",{willReadFrequently:!0}));try{console.log("Loading images..."),await J(),console.log("Setting up canvas dimensions..."),Ae(),console.log("Drawing images..."),_e(),setTimeout(()=>{console.log("ðŸš€ Applying initial slider settings on load"),at()},100),console.log("Initializing mask..."),ce(),console.log("Setting up event listeners..."),ye(),console.log("Canvas initialization complete!")}catch(W){console.error("Canvas initialization failed:",W),f("error",{message:"Failed to load images for editing"})}}}async function J(){return new Promise((W,$)=>{let ie=0,Ee=0;H=new Image,E=new Image,H.crossOrigin="anonymous",E.crossOrigin="anonymous";const He=()=>{ie++,console.log(`Image ${ie} loaded successfully`),ie===2&&(console.log("All images loaded, resolving"),W())},he=xe=>{Ee++,console.error("Image loading failed:",xe),Ee+ie===2&&$(new Error("Failed to load images"))};H.onload=He,E.onload=He,H.onerror=he,E.onerror=he,console.log("Loading original image:",n),console.log("Loading processed image:",i),H.src=n,E.src=i})}function Ae(){const W=(m==null?void 0:m.clientWidth)||600,$=(m==null?void 0:m.clientHeight)||400,ie=W-40,Ee=$-40,He=Math.min(400,ie),he=Math.min(400,Ee),xe=(H==null?void 0:H.width)||(E==null?void 0:E.width)||600,we=(H==null?void 0:H.height)||(E==null?void 0:E.height)||400,tt=xe/we;console.log("ðŸŽ¨ Image dimensions:",{imgWidth:xe,imgHeight:we,aspectRatio:tt}),console.log("ðŸŽ¨ Container dimensions:",{containerWidth:W,containerHeight:$}),console.log("ðŸŽ¨ Available space (HEIGHT PRIORITY):",{maxWidth:ie,maxHeight:Ee,minHeight:he});let fe,Fe;Fe=Math.min(Ee,$*.85),fe=Fe*tt,fe>ie&&(fe=ie,Fe=fe/tt),fe<He&&ie>=He&&(fe=He,Fe=fe/tt),Fe<he&&Ee>=he&&(Fe=he,fe=Fe*tt),fe=Math.min(fe,ie),Fe=Math.min(Fe,Ee),t(36,R=Math.round(fe)),I=Math.round(Fe),console.log("ðŸŽ¨ Final canvas dimensions (HEIGHT OPTIMIZED):",{canvasWidth:R,canvasHeight:I}),console.log("ðŸŽ¨ Height usage:",`${Math.round(I/$*100)}% of container`),console.log("ðŸŽ¨ Fits in container:",{widthOk:R<=ie,heightOk:I<=Ee}),[p,b,w,_].forEach(Ve=>{Ve&&(Ve.width=R,Ve.height=I,Ve.style.width=`${R}px`,Ve.style.height=`${I}px`)})}function _e(){console.log("Drawing images to canvas..."),y&&H&&(y.clearRect(0,0,R,I),y.drawImage(H,0,0,R,I),console.log("Original image drawn")),V&&E&&(V.clearRect(0,0,R,I),V.drawImage(E,0,0,R,I),console.log("Processed image drawn")),pt()}function ce(){S.clearRect(0,0,R,I),S.fillStyle="rgba(0, 0, 0, 0)",S.fillRect(0,0,R,I),de()}function de(){if(S)try{const W=S.getImageData(0,0,R,I);t(37,ee=[W]),t(38,oe=0),console.log("Initial mask state saved to history")}catch(W){console.error("Failed to save initial mask state:",W),t(37,ee=[]),t(38,oe=-1)}}function ue(){if(!S){console.warn("Cannot save stroke: maskCtx not available");return}try{const W=S.getImageData(0,0,R,I);if(oe<ee.length-1){const $=ee.length-1-oe;t(37,ee=ee.slice(0,oe+1)),console.log(`Removed ${$} future history states`)}if(ee.push(W),t(38,oe=ee.length-1),ee.length>Kn){const $=ee.length-Kn;ee.splice(0,$),t(38,oe=ee.length-1),console.log(`Trimmed ${$} old history states for memory management`)}console.log(`Stroke saved to history. Index: ${oe}, Total: ${ee.length}`)}catch(W){console.error("Failed to save stroke to history:",W),ee.length===0&&(console.log("Attempting to recover by reinitializing mask state"),ce())}}function ye(){_&&(_.addEventListener("mousedown",Re),_.addEventListener("mousemove",Qe),_.addEventListener("mouseup",jt),_.addEventListener("mouseout",je),_.addEventListener("mouseenter",Te),_.addEventListener("touchstart",qe),_.addEventListener("touchmove",me),_.addEventListener("touchend",Se))}function Re(W){if(console.log("Starting drawing with tool:",M),M==="smart-background-erase"||M==="smart-background-restore"){const $=_.getBoundingClientRect(),ie=Math.round((W.clientX-$.left)*(R/$.width)),Ee=Math.round((W.clientY-$.top)*(I/$.height));console.log(`Smart background operation at (${ie}, ${Ee})`),ie>=0&&ie<R&&Ee>=0&&Ee<I&&ls(ie,Ee,M==="smart-background-erase"?"erase":"restore");return}t(14,A=!0),t(3,x=!0),At(W)}function Qe(W){if(Ue(W),!A&&G&&Nt(W),A){const $=_.getBoundingClientRect(),ie=(W.clientX-$.left)*(R/$.width),Ee=(W.clientY-$.top)*(I/$.height);console.log("Mouse drawing at:",{clientX:W.clientX,clientY:W.clientY,rectLeft:$.left,rectTop:$.top,rectWidth:$.width,rectHeight:$.height,canvasWidth:R,canvasHeight:I,scaledX:ie,scaledY:Ee,mouseX:T,mouseY:j,isDrawing:A,currentTool:M}),Pe(ie,Ee),pt(),t(19,F=!0)}}function Ue(W){const $=_.getBoundingClientRect();t(15,T=W.clientX-$.left),t(16,j=W.clientY-$.top)}function Te(W){t(17,G=!0),t(18,z=!0),Ue(W),Nt(W)}function je(){t(17,G=!1),t(18,z=!1),jt()}function At(W){Qe(W)}function jt(){A&&(console.log("Stopping drawing"),ue()),t(14,A=!1),t(3,x=!1)}function qe(W){W.preventDefault();const $=W.touches[0],ie=new MouseEvent("mousedown",{clientX:$.clientX,clientY:$.clientY});Re(ie)}function me(W){W.preventDefault();const $=W.touches[0],ie=new MouseEvent("mousemove",{clientX:$.clientX,clientY:$.clientY});At(ie)}function Se(W){jt()}function Pe(W,$){if(console.log("Drawing brush stroke:",{tool:M,x:W,y:$,brushSize:c,canvasWidth:R,canvasHeight:I,inBounds:W>=0&&W<=R&&$>=0&&$<=I}),W<0||W>R||$<0||$>I){console.warn("Brush stroke out of bounds:",{x:W,y:$,canvasWidth:R,canvasHeight:I});return}switch(M){case"restore":S.globalCompositeOperation="source-over",S.beginPath(),S.arc(W,$,c/2,0,2*Math.PI),S.fillStyle="rgba(255, 255, 255, 0.8)",S.fill(),console.log("Painted basic restore stroke at:",{x:W,y:$,radius:c/2});break;case"erase":S.globalCompositeOperation="source-over",S.beginPath(),S.arc(W,$,c/2,0,2*Math.PI),S.fillStyle="rgba(0, 0, 0, 0.8)",S.fill(),console.log("Painted basic erase stroke at:",{x:W,y:$,radius:c/2});break;case"precision-erase":S.globalCompositeOperation="destination-out",S.beginPath();const ie=c*.7;S.arc(W,$,ie/2,0,2*Math.PI),S.fillStyle="rgba(255, 255, 255, 1.0)",S.fill(),console.log("Painted erase stroke at:",{x:W,y:$,radius:ie/2,operation:"destination-out"});break;case"edge-refine":S.globalCompositeOperation="source-over";const Ee=S.createRadialGradient(W,$,0,W,$,c/2);Ee.addColorStop(0,"rgba(255, 255, 255, 0.6)"),Ee.addColorStop(.7,"rgba(255, 255, 255, 0.3)"),Ee.addColorStop(1,"rgba(255, 255, 255, 0)"),S.beginPath(),S.arc(W,$,c/2,0,2*Math.PI),S.fillStyle=Ee,S.fill(),console.log("Painted edge-refine stroke at:",{x:W,y:$,radius:c/2,type:"gradient"});break}}function at(){if(!k||!b||!y){console.log("Full reprocessing skipped - missing contexts");return}console.log("ðŸ”„ FULL REPROCESSING with sliders - Sensitivity:",U,"Edge:",B),k.clearRect(0,0,R,I),k.drawImage(b,0,0);try{const W=y.getImageData(0,0,R,I),$=k.getImageData(0,0,R,I),ie=U/100,Ee=1-ie,He=B/100;console.log("ðŸŽ›ï¸ Processing entire image with aggressiveness:",Ee,"smoothing:",He);for(let he=0;he<$.data.length;he+=4){const xe=he/4,we=xe%R,tt=Math.floor(xe/R),fe=$.data[he+3];if(fe>0&&fe<255){const Fe=($.data[he]*.299+$.data[he+1]*.587+$.data[he+2]*.114)/255;let Ve=fe;if(Ee>.5){const Be=Math.max(0,1-Fe*1.2),We=Ee*Be*.8;Ve=Math.max(0,fe*(1-We))}if(Ee<.3){const Be=80+ie*120;Ve=fe>Be?fe:fe*ie}else{const Be=40+ie*180;if(fe<Be){const We=Ee*1.5;Ve=Math.max(0,fe-(Be-fe)*We*.01)}}$.data[he+3]=Math.round(Math.max(0,Math.min(255,Ve)))}if(He>.1&&fe>10&&fe<240){let Fe=0,Ve=0;for(let Be=-1;Be<=1;Be++)for(let We=-1;We<=1;We++){const Ke=we+We,st=tt+Be;if(Ke>=0&&Ke<R&&st>=0&&st<I){const Xe=(st*R+Ke)*4;Xe<$.data.length&&(Fe+=$.data[Xe+3],Ve++)}}if(Ve>0){const Be=Fe/Ve,We=Math.abs(fe-Be)/255;if(We>.1){const Ke=He*.6*Math.min(We*2,1),st=fe+(Be-fe)*Ke;$.data[he+3]=Math.round(Math.max(0,Math.min(255,st)))}}}}if(S){const he=S.getImageData(0,0,R,I);for(let xe=0;xe<he.data.length;xe+=4)if(he.data[xe+3]/255>0){const tt=W.data[xe],fe=W.data[xe+1],Fe=W.data[xe+2],Ve=W.data[xe+3];$.data[xe]=tt,$.data[xe+1]=fe,$.data[xe+2]=Fe,$.data[xe+3]=Ve}}k.putImageData($,0,0),console.log("ðŸŽ¯ Full reprocessing complete!")}catch(W){console.error("Full reprocessing failed:",W),pt()}}function pt(){if(!k||!b||!S||!y){console.log("Preview update skipped - missing contexts");return}console.log("Updating preview..."),k.clearRect(0,0,R,I),N?k.drawImage(p,0,0):k.drawImage(b,0,0),t(35,k.globalCompositeOperation="source-over",k);try{const W=S.getImageData(0,0,R,I),$=y.getImageData(0,0,R,I),ie=k.getImageData(0,0,R,I),Ee=U/100,He=1-Ee,he=B/100;let xe=0;for(let we=3;we<W.data.length;we+=4)W.data[we]>0&&xe++;console.log("Mask has",xe,"painted pixels"),console.log("Applying REAL sensitivity:",U,"aggressiveness:",He),console.log("Applying REAL edge refinement:",B,"smoothing:",he);for(let we=0;we<W.data.length;we+=4){const tt=we/4,fe=tt%R,Fe=Math.floor(tt/R),Ve=W.data[we+3]/255,Be=$.data[we],We=$.data[we+1],Ke=$.data[we+2],st=$.data[we+3],Xe=ie.data[we+3];if(Ve>0){const bt=W.data[we],Ye=W.data[we+1],Ze=W.data[we+2];if(bt+Ye+Ze>384)if(Ve>.9){const Ne=ie.data[we],Et=ie.data[we+1],Ot=ie.data[we+2],zr=Math.abs(Be*.299+We*.587+Ke*.114-(Ne*.299+Et*.587+Ot*.114)),zt=Math.min(Ve,1-zr/255*.3);ie.data[we]=Math.round(Be*zt+Ne*(1-zt)),ie.data[we+1]=Math.round(We*zt+Et*(1-zt)),ie.data[we+2]=Math.round(Ke*zt+Ot*(1-zt)),ie.data[we+3]=Math.round(st*zt+ie.data[we+3]*(1-zt))}else ie.data[we]=Be,ie.data[we+1]=We,ie.data[we+2]=Ke,ie.data[we+3]=st;else{const yt=Ve,Ne=ie.data[we+3],Et=Math.round(Ne*(1-yt));ie.data[we+3]=Math.max(0,Et),console.log(`Erasing pixel at (${fe}, ${Fe}): alpha ${Ne} -> ${Et}`)}}else{if(Xe>0){const bt=(ie.data[we]*.299+ie.data[we+1]*.587+ie.data[we+2]*.114)/255;let Ye=Xe;if(He>.5){const Ze=Math.max(0,1-bt),rt=He*Ze;Ye=Math.max(0,Xe*(1-rt))}if(He<.3){const Ze=50+Ee*150;Ye=Xe<Ze?0:Xe}else{const Ze=30+Ee*200,rt=He*2;Xe<Ze&&(Ye=Math.max(0,Xe-(Ze-Xe)*rt))}ie.data[we+3]=Math.round(Ye)}if(he>0&&ie.data[we+3]>0){const bt=ie.data[we+3];if(bt>0&&bt<255){let Ye=0,Ze=0;for(let rt=-1;rt<=1;rt++)for(let yt=-1;yt<=1;yt++){const Ne=fe+yt,Et=Fe+rt;if(Ne>=0&&Ne<R&&Et>=0&&Et<I){const Ot=(Et*R+Ne)*4;Ot<ie.data.length&&(Ye+=ie.data[Ot+3],Ze++)}}if(Ze>0){const rt=Ye/Ze,yt=Math.abs(bt-rt)/255;if(yt>.2){const Ne=he*.4*yt,Et=bt+(rt-bt)*Ne;ie.data[we+3]=Math.round(Math.max(0,Math.min(255,Et)))}}}}}}k.putImageData(ie,0,0),t(35,k.globalCompositeOperation="source-over",k),console.log("Preview updated with REAL slider functionality")}catch(W){console.error("Failed to update preview:",W)}}function nt(){console.log("Clearing mask..."),S&&(S.clearRect(0,0,R,I),S.fillStyle="rgba(0, 0, 0, 0)",S.fillRect(0,0,R,I),de(),pt(),t(19,F=!1),console.log("Mask cleared and history reset"))}function us(){t(13,M="smart-background-erase"),console.log("Smart background erase activated with tolerance:",q)}function mt(){t(13,M="smart-background-restore"),console.log("Smart background restore activated with tolerance:",q)}function it(){if(!(!y||!_)){t(8,X=!0),re||(re=document.createElement("canvas"),re.width=R,re.height=I,Q=re.getContext("2d"));try{const W=y.getImageData(0,0,R,I),$=Q.createImageData(R,I),ie=q/100*255,Ee=Math.floor(R/2),he=(Math.floor(I/2)*R+Ee)*4,xe=W.data[he],we=W.data[he+1],tt=W.data[he+2];console.log(`Showing tolerance preview with ${q}% tolerance`),console.log(`Background sample color: RGB(${xe}, ${we}, ${tt})`);for(let fe=0;fe<W.data.length;fe+=4){const Fe=W.data[fe],Ve=W.data[fe+1],Be=W.data[fe+2];Jn(xe,we,tt,Fe,Ve,Be)<=ie?($.data[fe]=255,$.data[fe+1]=255,$.data[fe+2]=0,$.data[fe+3]=80):($.data[fe]=0,$.data[fe+1]=0,$.data[fe+2]=0,$.data[fe+3]=0)}Q.putImageData($,0,0),k.save(),t(35,k.globalCompositeOperation="source-over",k),k.drawImage(re,0,0),k.restore()}catch(W){console.error("Failed to show tolerance preview:",W)}}}function St(){t(8,X=!1),pt()}function ls(W,$,ie){if(!(!S||!y||!V))try{const Ee=y.getImageData(0,0,R,I),He=S.getImageData(0,0,R,I),he=Ee.data,xe=He.data,we=($*R+W)*4,tt=he[we],fe=he[we+1],Fe=he[we+2],Ve=q/100*255,Be=new Set,We=[{x:W,y:$}];console.log(`Starting flood fill at (${W}, ${$}) with color RGB(${tt}, ${fe}, ${Fe}) and tolerance ${Ve}`);let Ke=0;for(;We.length>0&&Ke<1e4;){const{x:st,y:Xe}=We.shift(),bt=`${st},${Xe}`;if(Be.has(bt)||st<0||st>=R||Xe<0||Xe>=I)continue;Be.add(bt),Ke++;const Ye=(Xe*R+st)*4,Ze=he[Ye],rt=he[Ye+1],yt=he[Ye+2];Jn(tt,fe,Fe,Ze,rt,yt)<=Ve&&(ie==="erase"?(xe[Ye]=0,xe[Ye+1]=0,xe[Ye+2]=0,xe[Ye+3]=255):(xe[Ye]=255,xe[Ye+1]=255,xe[Ye+2]=255,xe[Ye+3]=255),We.push({x:st+1,y:Xe},{x:st-1,y:Xe},{x:st,y:Xe+1},{x:st,y:Xe-1}))}console.log(`Flood fill completed: processed ${Ke} pixels, visited ${Be.size} locations`),S.putImageData(He,0,0),ue(),pt(),t(19,F=!0)}catch(Ee){console.error("Flood fill operation failed:",Ee)}}function Xt(){if(oe<=0||ee.length===0){console.log("No strokes to undo - at initial state");return}if(!S){console.error("Cannot undo: maskCtx not available");return}try{t(38,oe--,oe);const W=ee[oe];if(!W)throw new Error(`No history state found at index ${oe}`);S.putImageData(W,0,0),pt(),t(19,F=oe>0),console.log(`Undo to history index: ${oe}. HasChanges: ${F}`)}catch(W){if(console.error("Failed to undo stroke:",W),console.error("History state:",{currentIndex:oe,historyLength:ee.length,state:ee[oe]?"exists":"missing"}),ee.length>0){console.log("Attempting recovery by resetting to initial state"),t(38,oe=0);try{S.putImageData(ee[0],0,0),pt(),t(19,F=!1)}catch($){console.error("Recovery failed, clearing mask:",$),nt()}}else console.log("No history available, clearing mask"),nt()}}async function Qt(){F||console.log("No changes made - using current processed image"),console.log("=== APPLYING REFINEMENTS ==="),t(20,P=!0);try{if(!_)throw new Error("Preview canvas not available");console.log("Canvas dimensions:",_.width,_.height),console.log("Canvas context:",k),console.log("Converting canvas to data URL...");const W=_.toDataURL("image/png",.95);if(!W||W==="data:,")throw new Error("Canvas is empty or corrupted");console.log("Refined image data length:",W.length),console.log("Data URL preview:",W.substring(0,100)+"..."),console.log("Dispatching refined event..."),f("refined",{refinedImage:W,hasChanges:!0}),console.log("Refinement dispatch successful")}catch(W){console.error("=== REFINEMENT ERROR ==="),console.error("Error details:",W);const $=W instanceof Error?W.message:"Unknown error";console.error("Error message:",$),W instanceof Error&&console.error("Error stack:",W.stack),f("error",{message:`Failed to apply refinements: ${$}`})}finally{t(20,P=!1)}}function ct(){f("cancel")}function Nt(W){if(!_||!k)return;const $=_.getBoundingClientRect(),ie=(W.clientX-$.left)*(R/$.width),Ee=(W.clientY-$.top)*(I/$.height),He=document.createElement("canvas");He.width=R,He.height=I;const he=He.getContext("2d");switch(he.drawImage(_,0,0),he.globalCompositeOperation="source-over",he.beginPath(),he.arc(ie,Ee,c/2,0,2*Math.PI),M){case"restore":he.fillStyle="rgba(0, 255, 136, 0.3)",he.strokeStyle="rgba(0, 255, 136, 0.8)";break;case"erase":he.fillStyle="rgba(255, 136, 68, 0.4)",he.strokeStyle="rgba(255, 136, 68, 1.0)";break;case"precision-erase":he.fillStyle="rgba(255, 68, 68, 0.4)",he.strokeStyle="rgba(255, 68, 68, 1.0)";break;case"edge-refine":he.fillStyle="rgba(136, 136, 255, 0.3)",he.strokeStyle="rgba(136, 136, 255, 0.8)";break}he.lineWidth=2,he.fill(),he.stroke(),he.getImageData(0,0,R,I)}const Mt=()=>t(22,te=!te),Or=()=>t(21,K=!K);function cr(){q=rl(this.value),t(7,q)}const Dr=()=>t(13,M="restore"),Lt=()=>t(13,M="erase"),dt=()=>t(13,M="precision-erase"),kt=()=>t(13,M="edge-refine");function ds(){c=rl(this.value),t(0,c)}function Ir(){U=rl(this.value),t(4,U)}function Sr(){B=rl(this.value),t(5,B)}function wt(){N=this.checked,t(6,N)}function Zt(W){Cs[W?"unshift":"push"](()=>{p=W,t(10,p)})}function Mr(W){Cs[W?"unshift":"push"](()=>{b=W,t(11,b)})}function Tr(W){Cs[W?"unshift":"push"](()=>{w=W,t(12,w)})}function $t(W){Cs[W?"unshift":"push"](()=>{_=W,t(2,_)})}function Vt(W){Cs[W?"unshift":"push"](()=>{m=W,t(9,m)})}return s.$$set=W=>{"originalImage"in W&&t(33,n=W.originalImage),"processedImage"in W&&t(34,i=W.processedImage),"isVisible"in W&&t(1,u=W.isVisible),"brushSize"in W&&t(0,c=W.brushSize)},s.$$.update=()=>{s.$$.dirty[0]&5|s.$$.dirty[1]&32&&t(24,r=_?c*(_.getBoundingClientRect().width/R):c),s.$$.dirty[1]&192&&t(23,o=oe>0&&ee.length>1),s.$$.dirty[0]&2|s.$$.dirty[1]&12&&u&&n&&i&&Ie(),s.$$.dirty[0]&64|s.$$.dirty[1]&16&&N!==void 0&&k&&pt(),s.$$.dirty[0]&24|s.$$.dirty[1]&1296&&U!==ae&&k&&!x&&(console.log("ðŸŽ›ï¸ Background sensitivity changed from",ae,"to:",U),t(41,ae=U),clearTimeout(ne),t(39,ne=setTimeout(()=>{x||(console.log("ðŸŽ›ï¸ Applying ENHANCED background sensitivity update:",U),at())},200))),s.$$.dirty[0]&40|s.$$.dirty[1]&2576&&B!==be&&k&&!x&&(console.log("âœ¨ Edge refinement changed from",be,"to:",B),t(42,be=B),clearTimeout(ke),t(40,ke=setTimeout(()=>{x||(console.log("âœ¨ Applying ENHANCED edge refinement update:",B),at())},200))),s.$$.dirty[0]&384&&X&&q!==void 0&&it()},[c,u,_,x,U,B,N,q,X,m,p,b,w,M,A,T,j,G,z,F,P,K,te,o,r,nt,us,mt,it,St,Xt,Qt,ct,n,i,k,R,ee,oe,ne,ke,ae,be,Mt,Or,cr,Dr,Lt,dt,kt,ds,Ir,Sr,wt,Zt,Mr,Tr,$t,Vt]}class Ec extends Rs{constructor(e){super(),As(this,e,yc,wc,Ps,{originalImage:33,processedImage:34,isVisible:1,brushSize:0},null,[-1,-1,-1,-1])}}function Xn(s,e,t){const r=s.slice();return r[28]=e[t],r[30]=t,r}function Qn(s){let e,t,r,o,n="Batch Processing",i,u,c,f,m,p,b,w='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',_,y,V,S,k=s[3].length===0&&Zn(s),M=s[3].length>0&&$n(s);return{c(){e=h("div"),t=h("div"),r=h("div"),o=h("h3"),o.textContent=n,i=C(),u=h("p"),c=L("Process multiple images simultaneously (max "),f=L(s[1]),m=L(" files)"),p=C(),b=h("button"),b.innerHTML=w,_=C(),k&&k.c(),y=C(),M&&M.c(),this.h()},l(A){e=g(A,"DIV",{class:!0});var x=v(e);t=g(x,"DIV",{class:!0});var R=v(t);r=g(R,"DIV",{class:!0});var I=v(r);o=g(I,"H3",{class:!0,"data-svelte-h":!0}),Z(o)!=="svelte-fvixf7"&&(o.textContent=n),i=D(I),u=g(I,"P",{class:!0});var U=v(u);c=O(U,"Process multiple images simultaneously (max "),f=O(U,s[1]),m=O(U," files)"),U.forEach(d),p=D(I),b=g(I,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),Z(b)!=="svelte-1x1er5t"&&(b.innerHTML=w),I.forEach(d),_=D(R),k&&k.l(R),y=D(R),M&&M.l(R),R.forEach(d),x.forEach(d),this.h()},h(){a(o,"class","text-xl font-semibold text-magic-gradient"),a(u,"class","text-sm text-dark-text-secondary mt-1"),a(b,"class","close-button svelte-8o0g4x"),a(b,"aria-label","Close batch processor"),a(r,"class","batch-header svelte-8o0g4x"),a(t,"class","batch-container svelte-8o0g4x"),a(e,"class","batch-overlay svelte-8o0g4x")},m(A,x){Y(A,e,x),l(e,t),l(t,r),l(r,o),l(r,i),l(r,u),l(u,c),l(u,f),l(u,m),l(r,p),l(r,b),l(t,_),k&&k.m(t,null),l(t,y),M&&M.m(t,null),V||(S=[se(b,"click",s[19]),se(e,"click",ga(s[19]))],V=!0)},p(A,x){x&2&&pe(f,A[1]),A[3].length===0?k?k.p(A,x):(k=Zn(A),k.c(),k.m(t,y)):k&&(k.d(1),k=null),A[3].length>0?M?M.p(A,x):(M=$n(A),M.c(),M.m(t,null)):M&&(M.d(1),M=null)},d(A){A&&d(e),k&&k.d(),M&&M.d(),V=!1,Jt(S)}}}function Zn(s){let e,t,r,o,n,i,u="Drop images here or click to select",c,f,m,p,b,w,_,y,V,S,k,M,A,x,R;return{c(){e=h("div"),t=h("div"),r=Ce("svg"),o=Ce("path"),n=C(),i=h("h4"),i.textContent=u,c=C(),f=h("p"),m=L("Support for JPG, PNG, WebP â€¢ Max 10MB per file â€¢ Up to "),p=L(s[1]),b=L(" files"),w=C(),_=h("button"),y=Ce("svg"),V=Ce("path"),S=L(`\r
              Select Files`),k=C(),M=h("input"),this.h()},l(I){e=g(I,"DIV",{class:!0});var U=v(e);t=g(U,"DIV",{class:!0});var B=v(t);r=De(B,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var T=v(r);o=De(T,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(o).forEach(d),T.forEach(d),n=D(B),i=g(B,"H4",{class:!0,"data-svelte-h":!0}),Z(i)!=="svelte-7cq59c"&&(i.textContent=u),c=D(B),f=g(B,"P",{class:!0});var j=v(f);m=O(j,"Support for JPG, PNG, WebP â€¢ Max 10MB per file â€¢ Up to "),p=O(j,s[1]),b=O(j," files"),j.forEach(d),w=D(B),_=g(B,"BUTTON",{class:!0});var G=v(_);y=De(G,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var z=v(y);V=De(z,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(V).forEach(d),z.forEach(d),S=O(G,`\r
              Select Files`),G.forEach(d),B.forEach(d),k=D(U),M=g(U,"INPUT",{type:!0,accept:!0,class:!0}),U.forEach(d),this.h()},h(){a(o,"stroke-linecap","round"),a(o,"stroke-linejoin","round"),a(o,"stroke-width","2"),a(o,"d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"),a(r,"class","w-12 h-12 text-magic-400 mb-4"),a(r,"fill","none"),a(r,"stroke","currentColor"),a(r,"viewBox","0 0 24 24"),a(i,"class","text-lg font-semibold text-dark-text mb-2"),a(f,"class","text-sm text-dark-text-secondary mb-4"),a(V,"stroke-linecap","round"),a(V,"stroke-linejoin","round"),a(V,"stroke-width","2"),a(V,"d","M12 6v6m0 0v6m0-6h6m-6 0H6"),a(y,"class","w-5 h-5 mr-2"),a(y,"fill","none"),a(y,"stroke","currentColor"),a(y,"viewBox","0 0 24 24"),a(_,"class","btn btn-magic"),_.disabled=s[5],a(t,"class","drop-zone-content svelte-8o0g4x"),a(M,"type","file"),M.multiple=!0,a(M,"accept","image/*"),a(M,"class","hidden svelte-8o0g4x"),a(e,"class",A="drop-zone "+(s[2]?"drag-active":"")+" svelte-8o0g4x")},m(I,U){Y(I,e,U),l(e,t),l(t,r),l(r,o),l(t,n),l(t,i),l(t,c),l(t,f),l(f,m),l(f,p),l(f,b),l(t,w),l(t,_),l(_,y),l(y,V),l(_,S),l(e,k),l(e,M),s[21](M),x||(R=[se(_,"click",s[20]),se(M,"change",s[14]),se(e,"dragenter",s[11]),se(e,"dragleave",s[12]),se(e,"dragover",Ac),se(e,"drop",s[13])],x=!0)},p(I,U){U&2&&pe(p,I[1]),U&32&&(_.disabled=I[5]),U&4&&A!==(A="drop-zone "+(I[2]?"drag-active":"")+" svelte-8o0g4x")&&a(e,"class",A)},d(I){I&&d(e),s[21](null),x=!1,Jt(R)}}}function $n(s){let e,t,r,o,n=s[3].length+"",i,u,c,f,m,p,b,w,_,y,V,S,k,M,A,x,R,I,U,B,T=Ds(s[3]),j=[];for(let E=0;E<T.length;E+=1)j[E]=ra(Xn(s,T,E));function G(E,F){if(!E[5]&&E[6]===null)return xc;if(E[5])return Tc;if(E[6])return Mc}let z=G(s),H=z&&z(s);return{c(){e=h("div"),t=h("div"),r=h("h4"),o=L("Selected Files ("),i=L(n),u=L("/"),c=L(s[1]),f=L(")"),m=C(),p=h("div"),b=h("button"),w=L("Add More"),y=C(),V=h("button"),S=L("Clear All"),k=C(),M=h("div");for(let E=0;E<j.length;E+=1)j[E].c();A=C(),x=h("input"),R=C(),I=h("div"),H&&H.c(),this.h()},l(E){e=g(E,"DIV",{class:!0});var F=v(e);t=g(F,"DIV",{class:!0});var P=v(t);r=g(P,"H4",{class:!0});var N=v(r);o=O(N,"Selected Files ("),i=O(N,n),u=O(N,"/"),c=O(N,s[1]),f=O(N,")"),N.forEach(d),m=D(P),p=g(P,"DIV",{class:!0});var K=v(p);b=g(K,"BUTTON",{class:!0});var q=v(b);w=O(q,"Add More"),q.forEach(d),y=D(K),V=g(K,"BUTTON",{class:!0});var X=v(V);S=O(X,"Clear All"),X.forEach(d),K.forEach(d),P.forEach(d),k=D(F),M=g(F,"DIV",{class:!0});var re=v(M);for(let te=0;te<j.length;te+=1)j[te].l(re);re.forEach(d),A=D(F),x=g(F,"INPUT",{type:!0,accept:!0,class:!0}),F.forEach(d),R=D(E),I=g(E,"DIV",{class:!0});var Q=v(I);H&&H.l(Q),Q.forEach(d),this.h()},h(){a(r,"class","text-lg font-semibold text-dark-text"),a(b,"class","btn btn-outline btn-sm"),b.disabled=_=s[5]||s[3].length>=s[1],a(V,"class","btn btn-outline btn-sm"),V.disabled=s[5],a(p,"class","file-list-actions svelte-8o0g4x"),a(t,"class","file-list-header svelte-8o0g4x"),a(M,"class","file-list svelte-8o0g4x"),a(x,"type","file"),x.multiple=!0,a(x,"accept","image/*"),a(x,"class","hidden svelte-8o0g4x"),a(e,"class","file-list-container svelte-8o0g4x"),a(I,"class","processing-controls svelte-8o0g4x")},m(E,F){Y(E,e,F),l(e,t),l(t,r),l(r,o),l(r,i),l(r,u),l(r,c),l(r,f),l(t,m),l(t,p),l(p,b),l(b,w),l(p,y),l(p,V),l(V,S),l(e,k),l(e,M);for(let P=0;P<j.length;P+=1)j[P]&&j[P].m(M,null);l(e,A),l(e,x),s[25](x),Y(E,R,F),Y(E,I,F),H&&H.m(I,null),U||(B=[se(b,"click",s[22]),se(V,"click",s[16]),se(x,"change",s[14])],U=!0)},p(E,F){if(F&8&&n!==(n=E[3].length+"")&&pe(i,n),F&2&&pe(c,E[1]),F&42&&_!==(_=E[5]||E[3].length>=E[1])&&(b.disabled=_),F&32&&(V.disabled=E[5]),F&33336){T=Ds(E[3]);let P;for(P=0;P<T.length;P+=1){const N=Xn(E,T,P);j[P]?j[P].p(N,F):(j[P]=ra(N),j[P].c(),j[P].m(M,null))}for(;P<j.length;P+=1)j[P].d(1);j.length=T.length}z===(z=G(E))&&H?H.p(E,F):(H&&H.d(1),H=z&&z(E),H&&(H.c(),H.m(I,null)))},d(E){E&&(d(e),d(R),d(I)),To(j,E),s[25](null),H&&H.d(),U=!1,Jt(B)}}}function ea(s){let e,t,r,o;function n(f,m){if(f[9][f[30]].status==="pending")return Sc;if(f[9][f[30]].status==="processing")return Ic;if(f[9][f[30]].status==="completed")return Dc;if(f[9][f[30]].status==="failed")return Cc}let i=n(s),u=i&&i(s),c=s[9][s[30]].error&&ta(s);return{c(){e=h("div"),u&&u.c(),r=C(),c&&c.c(),o=cs(),this.h()},l(f){e=g(f,"DIV",{class:!0});var m=v(e);u&&u.l(m),m.forEach(d),r=D(f),c&&c.l(f),o=cs(),this.h()},h(){a(e,"class",t="file-status status-"+s[9][s[30]].status+" svelte-8o0g4x")},m(f,m){Y(f,e,m),u&&u.m(e,null),Y(f,r,m),c&&c.m(f,m),Y(f,o,m)},p(f,m){i!==(i=n(f))&&(u&&u.d(1),u=i&&i(f),u&&(u.c(),u.m(e,null))),m&512&&t!==(t="file-status status-"+f[9][f[30]].status+" svelte-8o0g4x")&&a(e,"class",t),f[9][f[30]].error?c?c.p(f,m):(c=ta(f),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(f){f&&(d(e),d(r),d(o)),u&&u.d(),c&&c.d(f)}}}function Cc(s){let e,t="âœ— Failed";return{c(){e=h("span"),e.textContent=t,this.h()},l(r){e=g(r,"SPAN",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-hchxnj"&&(e.textContent=t),this.h()},h(){a(e,"class","text-red-400")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function Dc(s){let e,t="âœ“ Completed";return{c(){e=h("span"),e.textContent=t,this.h()},l(r){e=g(r,"SPAN",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-1hum4cp"&&(e.textContent=t),this.h()},h(){a(e,"class","text-green-400")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function Ic(s){let e,t='<div class="spinner svelte-8o0g4x"></div> <span>Processing...</span>';return{c(){e=h("div"),e.innerHTML=t,this.h()},l(r){e=g(r,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-jkqr7"&&(e.innerHTML=t),this.h()},h(){a(e,"class","processing-indicator svelte-8o0g4x")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function Sc(s){let e,t="Ready";return{c(){e=h("span"),e.textContent=t},l(r){e=g(r,"SPAN",{"data-svelte-h":!0}),Z(e)!=="svelte-1cs9spj"&&(e.textContent=t)},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function ta(s){let e,t=s[9][s[30]].error+"",r;return{c(){e=h("div"),r=L(t),this.h()},l(o){e=g(o,"DIV",{class:!0});var n=v(e);r=O(n,t),n.forEach(d),this.h()},h(){a(e,"class","file-error svelte-8o0g4x")},m(o,n){Y(o,e,n),l(e,r)},p(o,n){n&512&&t!==(t=o[9][o[30]].error+"")&&pe(r,t)},d(o){o&&d(e)}}}function sa(s){let e,t='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-4-4m4 4l4-4"></path></svg>',r,o;function n(){return s[23](s[30],s[28])}return{c(){e=h("button"),e.innerHTML=t,this.h()},l(i){e=g(i,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Z(e)!=="svelte-wys4yr"&&(e.innerHTML=t),this.h()},h(){a(e,"class","btn btn-sm btn-magic"),a(e,"title","Download processed image")},m(i,u){Y(i,e,u),r||(o=se(e,"click",n),r=!0)},p(i,u){s=i},d(i){i&&d(e),r=!1,o()}}}function ra(s){var z;let e,t,r,o,n,i,u,c,f=s[28].name+"",m,p,b,w=(s[28].size/(1024*1024)).toFixed(2)+"",_,y,V,S,k,M,A,x,R,I,U,B,T=s[9][s[30]]&&ea(s),j=((z=s[9][s[30]])==null?void 0:z.status)==="completed"&&s[9][s[30]].downloadUrl&&sa(s);function G(){return s[24](s[30])}return{c(){e=h("div"),t=h("div"),r=h("img"),i=C(),u=h("div"),c=h("div"),m=L(f),p=C(),b=h("div"),_=L(w),y=L(" MB"),V=C(),T&&T.c(),S=C(),k=h("div"),j&&j.c(),M=C(),A=h("button"),x=Ce("svg"),R=Ce("path"),I=C(),this.h()},l(H){e=g(H,"DIV",{class:!0});var E=v(e);t=g(E,"DIV",{class:!0});var F=v(t);r=g(F,"IMG",{src:!0,alt:!0,class:!0}),F.forEach(d),i=D(E),u=g(E,"DIV",{class:!0});var P=v(u);c=g(P,"DIV",{class:!0});var N=v(c);m=O(N,f),N.forEach(d),p=D(P),b=g(P,"DIV",{class:!0});var K=v(b);_=O(K,w),y=O(K," MB"),K.forEach(d),V=D(P),T&&T.l(P),P.forEach(d),S=D(E),k=g(E,"DIV",{class:!0});var q=v(k);j&&j.l(q),M=D(q),A=g(q,"BUTTON",{class:!0,title:!0});var X=v(A);x=De(X,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var re=v(x);R=De(re,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(R).forEach(d),re.forEach(d),X.forEach(d),q.forEach(d),I=D(E),E.forEach(d),this.h()},h(){zo(r.src,o=s[4][s[30]])||a(r,"src",o),a(r,"alt",n=s[28].name),a(r,"class","preview-image svelte-8o0g4x"),a(t,"class","file-preview svelte-8o0g4x"),a(c,"class","file-name svelte-8o0g4x"),a(b,"class","file-size svelte-8o0g4x"),a(u,"class","file-info svelte-8o0g4x"),a(R,"stroke-linecap","round"),a(R,"stroke-linejoin","round"),a(R,"stroke-width","2"),a(R,"d","M6 18L18 6M6 6l12 12"),a(x,"class","w-4 h-4"),a(x,"fill","none"),a(x,"stroke","currentColor"),a(x,"viewBox","0 0 24 24"),a(A,"class","btn btn-sm btn-outline border-red-500 text-red-400 hover:bg-red-500 hover:text-white"),A.disabled=s[5],a(A,"title","Remove file"),a(k,"class","file-actions svelte-8o0g4x"),a(e,"class","file-item svelte-8o0g4x")},m(H,E){Y(H,e,E),l(e,t),l(t,r),l(e,i),l(e,u),l(u,c),l(c,m),l(u,p),l(u,b),l(b,_),l(b,y),l(u,V),T&&T.m(u,null),l(e,S),l(e,k),j&&j.m(k,null),l(k,M),l(k,A),l(A,x),l(x,R),l(e,I),U||(B=se(A,"click",G),U=!0)},p(H,E){var F;s=H,E&16&&!zo(r.src,o=s[4][s[30]])&&a(r,"src",o),E&8&&n!==(n=s[28].name)&&a(r,"alt",n),E&8&&f!==(f=s[28].name+"")&&pe(m,f),E&8&&w!==(w=(s[28].size/(1024*1024)).toFixed(2)+"")&&pe(_,w),s[9][s[30]]?T?T.p(s,E):(T=ea(s),T.c(),T.m(u,null)):T&&(T.d(1),T=null),((F=s[9][s[30]])==null?void 0:F.status)==="completed"&&s[9][s[30]].downloadUrl?j?j.p(s,E):(j=sa(s),j.c(),j.m(k,M)):j&&(j.d(1),j=null),E&32&&(A.disabled=s[5])},d(H){H&&d(e),T&&T.d(),j&&j.d(),U=!1,B()}}}function Mc(s){let e,t,r,o="Processing Complete!",n,i,u=s[6].successful_count+"",c,f,m=s[6].total_images+"",p,b,w=s[6].processing_time.toFixed(2)+"",_,y,V,S,k,M,A,x,R=s[6].successful_count+"",I,U,B,T,j,G="Process New Batch",z,H;return{c(){e=h("div"),t=h("div"),r=h("h4"),r.textContent=o,n=C(),i=h("p"),c=L(u),f=L(" of "),p=L(m),b=L(` images processed successfully\r
                  in `),_=L(w),y=L("s"),V=C(),S=h("div"),k=h("button"),M=Ce("svg"),A=Ce("path"),x=L(`\r
                  Download All (`),I=L(R),U=L(")"),T=C(),j=h("button"),j.textContent=G,this.h()},l(E){e=g(E,"DIV",{class:!0});var F=v(e);t=g(F,"DIV",{class:!0});var P=v(t);r=g(P,"H4",{class:!0,"data-svelte-h":!0}),Z(r)!=="svelte-1f02vfq"&&(r.textContent=o),n=D(P),i=g(P,"P",{class:!0});var N=v(i);c=O(N,u),f=O(N," of "),p=O(N,m),b=O(N,` images processed successfully\r
                  in `),_=O(N,w),y=O(N,"s"),N.forEach(d),P.forEach(d),V=D(F),S=g(F,"DIV",{class:!0});var K=v(S);k=g(K,"BUTTON",{class:!0});var q=v(k);M=De(q,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var X=v(M);A=De(X,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(A).forEach(d),X.forEach(d),x=O(q,`\r
                  Download All (`),I=O(q,R),U=O(q,")"),q.forEach(d),T=D(K),j=g(K,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(j)!=="svelte-1ogk3lr"&&(j.textContent=G),K.forEach(d),F.forEach(d),this.h()},h(){a(r,"class","text-lg font-semibold text-magic-gradient mb-2"),a(i,"class","text-dark-text-secondary mb-4"),a(t,"class","results-summary svelte-8o0g4x"),a(A,"stroke-linecap","round"),a(A,"stroke-linejoin","round"),a(A,"stroke-width","2"),a(A,"d","M12 10v6m0 0l-4-4m4 4l4-4m-4-4V3"),a(M,"class","w-5 h-5 mr-2"),a(M,"fill","none"),a(M,"stroke","currentColor"),a(M,"viewBox","0 0 24 24"),a(k,"class","btn btn-magic"),k.disabled=B=s[6].successful_count===0,a(j,"class","btn btn-outline"),a(S,"class","results-actions svelte-8o0g4x"),a(e,"class","batch-results svelte-8o0g4x")},m(E,F){Y(E,e,F),l(e,t),l(t,r),l(t,n),l(t,i),l(i,c),l(i,f),l(i,p),l(i,b),l(i,_),l(i,y),l(e,V),l(e,S),l(S,k),l(k,M),l(M,A),l(k,x),l(k,I),l(k,U),l(S,T),l(S,j),z||(H=[se(k,"click",s[18]),se(j,"click",s[16])],z=!0)},p(E,F){F&64&&u!==(u=E[6].successful_count+"")&&pe(c,u),F&64&&m!==(m=E[6].total_images+"")&&pe(p,m),F&64&&w!==(w=E[6].processing_time.toFixed(2)+"")&&pe(_,w),F&64&&R!==(R=E[6].successful_count+"")&&pe(I,R),F&64&&B!==(B=E[6].successful_count===0)&&(k.disabled=B)},d(E){E&&d(e),z=!1,Jt(H)}}}function Tc(s){let e,t,r,o,n,i,u;return{c(){e=h("div"),t=h("div"),r=h("div"),o=h("div"),n=C(),i=h("span"),u=L(s[8]),this.h()},l(c){e=g(c,"DIV",{class:!0});var f=v(e);t=g(f,"DIV",{class:!0});var m=v(t);r=g(m,"DIV",{class:!0});var p=v(r);o=g(p,"DIV",{class:!0,style:!0}),v(o).forEach(d),p.forEach(d),n=D(m),i=g(m,"SPAN",{class:!0});var b=v(i);u=O(b,s[8]),b.forEach(d),m.forEach(d),f.forEach(d),this.h()},h(){a(o,"class","progress-fill svelte-8o0g4x"),ge(o,"width",s[7]+"%"),a(r,"class","progress-bar svelte-8o0g4x"),a(i,"class","progress-text svelte-8o0g4x"),a(t,"class","processing-progress svelte-8o0g4x"),a(e,"class","processing-status svelte-8o0g4x")},m(c,f){Y(c,e,f),l(e,t),l(t,r),l(r,o),l(t,n),l(t,i),l(i,u)},p(c,f){f&128&&ge(o,"width",c[7]+"%"),f&256&&pe(u,c[8])},d(c){c&&d(e)}}}function xc(s){let e,t,r,o,n=s[3].length+"",i,u,c=s[3].length>1?"s":"",f,m,p,b;return{c(){e=h("button"),t=Ce("svg"),r=Ce("path"),o=L(`\r
              Process `),i=L(n),u=L(" Image"),f=L(c),this.h()},l(w){e=g(w,"BUTTON",{class:!0});var _=v(e);t=De(_,"svg",{class:!0,fill:!0,stroke:!0,viewBox:!0});var y=v(t);r=De(y,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(r).forEach(d),y.forEach(d),o=O(_,`\r
              Process `),i=O(_,n),u=O(_," Image"),f=O(_,c),_.forEach(d),this.h()},h(){a(r,"stroke-linecap","round"),a(r,"stroke-linejoin","round"),a(r,"stroke-width","2"),a(r,"d","M13 10V3L4 14h7v7l9-11h-7z"),a(t,"class","w-5 h-5 mr-2"),a(t,"fill","none"),a(t,"stroke","currentColor"),a(t,"viewBox","0 0 24 24"),a(e,"class","btn btn-magic btn-lg"),e.disabled=m=s[3].length===0},m(w,_){Y(w,e,_),l(e,t),l(t,r),l(e,o),l(e,i),l(e,u),l(e,f),p||(b=se(e,"click",s[17]),p=!0)},p(w,_){_&8&&n!==(n=w[3].length+"")&&pe(i,n),_&8&&c!==(c=w[3].length>1?"s":"")&&pe(f,c),_&8&&m!==(m=w[3].length===0)&&(e.disabled=m)},d(w){w&&d(e),p=!1,b()}}}function Pc(s){let e,t=s[0]&&Qn(s);return{c(){t&&t.c(),e=cs()},l(r){t&&t.l(r),e=cs()},m(r,o){t&&t.m(r,o),Y(r,e,o)},p(r,[o]){r[0]?t?t.p(r,o):(t=Qn(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ge,o:Ge,d(r){r&&d(e),t&&t.d(r)}}}function il(s){s.preventDefault()}function Rc(s){return!(!s.type.startsWith("image/")||s.size>10*1024*1024)}function Ac(s){s.preventDefault()}function Vc(s,e){const t=document.createElement("a");t.href=s,t.download=`processed_${e}`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Fc(s,e,t){let{isVisible:r=!1}=e,{maxFiles:o=10}=e;const n=Er();let i=!1,u=[],c=[],f=!1,m=null,p=0,b="",w=[],_;Cr(()=>(document.addEventListener("dragover",il),document.addEventListener("drop",il),()=>{document.removeEventListener("dragover",il),document.removeEventListener("drop",il)}));function y(E){E.preventDefault(),t(2,i=!0)}function V(E){E.preventDefault(),t(2,i=!1)}async function S(E){var P;E.preventDefault(),t(2,i=!1);const F=Array.from(((P=E.dataTransfer)==null?void 0:P.files)||[]);await M(F)}async function k(E){const F=E.target,P=Array.from(F.files||[]);await M(P),F.value=""}async function M(E){const F=E.filter(Rc);if(F.length===0){n("error",{message:"No valid image files selected. Please select PNG, JPG, or WebP images under 10MB."});return}if(u.length+F.length>o){const K=o-u.length;if(K<=0){n("error",{message:`Maximum ${o} files allowed. Please remove some files before adding more.`});return}else{n("error",{message:`Can only add ${K} more file${K===1?"":"s"}. You tried to add ${F.length} files, but the maximum is ${o} total.`});return}}if(E.length!==F.length){const K=E.length-F.length;console.warn(`${K} file${K===1?"":"s"} skipped (invalid format or too large)`)}t(3,u=[...u,...F]);for(const K of F){const q=URL.createObjectURL(K);t(4,c=[...c,q])}const N=F.map((K,q)=>({index:u.length-F.length+q,filename:K.name,status:"pending",progress:0}));t(9,w=[...w,...N])}function A(E){URL.revokeObjectURL(c[E]),t(3,u=u.filter((F,P)=>P!==E)),t(4,c=c.filter((F,P)=>P!==E)),t(9,w=w.filter((F,P)=>P!==E)),t(9,w=w.map((F,P)=>({...F,index:P})))}function x(){c.forEach(E=>URL.revokeObjectURL(E)),t(3,u=[]),t(4,c=[]),t(9,w=[]),t(6,m=null),t(7,p=0),t(8,b="")}async function R(){if(u.length===0){n("error",{message:"No files selected for processing"});return}t(5,f=!0),t(7,p=0),t(8,b="Preparing batch processing..."),t(9,w=w.map(E=>({...E,status:"processing",progress:0})));try{const E=new FormData;u.forEach(N=>{E.append("files",N)}),t(8,b="Processing images...");const F=await fetch("http://localhost:8000/process-batch",{method:"POST",body:E});if(!F.ok)throw new Error(`HTTP ${F.status}: ${F.statusText}`);const P=await F.json();t(6,m=P),t(9,w=w.map(N=>{const K=P.results.find(q=>q.index===N.index);return K?{...N,status:K.success?"completed":"failed",progress:100,downloadUrl:K.download_url,error:K.error}:N})),t(7,p=100),t(8,b=`Processing complete! ${P.successful_count}/${P.total_images} images processed successfully.`),n("completed",{batchResults:P})}catch(E){console.error("Batch processing failed:",E),t(9,w=w.map(F=>({...F,status:"failed",progress:0,error:E instanceof Error?E.message:"Processing failed"}))),t(8,b="Batch processing failed. Please try again."),n("error",{message:b})}finally{t(5,f=!1)}}function I(){m&&m.results.forEach(E=>{if(E.success&&E.download_url){const F=document.createElement("a");F.href=E.download_url,F.download=`processed_${E.filename}`,document.body.appendChild(F),F.click(),document.body.removeChild(F)}})}function U(){x(),n("close")}const B=()=>_==null?void 0:_.click();function T(E){Cs[E?"unshift":"push"](()=>{_=E,t(10,_)})}const j=()=>_==null?void 0:_.click(),G=(E,F)=>Vc(w[E].downloadUrl,F.name),z=E=>A(E);function H(E){Cs[E?"unshift":"push"](()=>{_=E,t(10,_)})}return s.$$set=E=>{"isVisible"in E&&t(0,r=E.isVisible),"maxFiles"in E&&t(1,o=E.maxFiles)},[r,o,i,u,c,f,m,p,b,w,_,y,V,S,k,A,x,R,I,U,B,T,j,G,z,H]}class Bc extends Rs{constructor(e){super(),As(this,e,Fc,Pc,Ps,{isVisible:0,maxFiles:1})}}const Es=el({currentState:"idle",inputMethod:"none",isDragActive:!1,isClipboardReady:!1,errorMessage:null,successMessage:null,canAcceptInput:!0,showPasteHint:!0});El(Es,s=>({isIdle:s.currentState==="idle",isActive:s.currentState==="active"||s.isDragActive,isProcessing:s.currentState==="processing",hasError:s.currentState==="error",hasSuccess:s.currentState==="success",showDropZone:s.canAcceptInput&&["idle","hover","active"].includes(s.currentState)}));const Qo=el({dragEvents:0,pasteEvents:0,uploadEvents:0,successfulInputs:0,failedInputs:0,averageInputTime:0}),jc=[{from:"idle",to:"hover",trigger:"DRAG_ENTER"},{from:"idle",to:"active",trigger:"PASTE_READY",method:"paste"},{from:"idle",to:"active",trigger:"UPLOAD_CLICK",method:"upload"},{from:"idle",to:"processing",trigger:"FILE_SELECTED"},{from:"hover",to:"idle",trigger:"DRAG_LEAVE"},{from:"hover",to:"active",trigger:"DRAG_OVER"},{from:"hover",to:"hover",trigger:"DRAG_ENTER"},{from:"hover",to:"processing",trigger:"DROP",method:"drop"},{from:"active",to:"idle",trigger:"CANCEL"},{from:"active",to:"processing",trigger:"FILE_SELECTED"},{from:"active",to:"processing",trigger:"DROP",method:"drop"},{from:"active",to:"active",trigger:"DRAG_OVER"},{from:"active",to:"hover",trigger:"DRAG_LEAVE"},{from:"active",to:"success",trigger:"PROCESS_COMPLETE"},{from:"active",to:"error",trigger:"PROCESS_ERROR"},{from:"processing",to:"success",trigger:"PROCESS_COMPLETE"},{from:"processing",to:"error",trigger:"PROCESS_ERROR"},{from:"success",to:"idle",trigger:"RESET"},{from:"success",to:"processing",trigger:"PROCESS_ANOTHER"},{from:"error",to:"idle",trigger:"RESET"},{from:"error",to:"processing",trigger:"RETRY"}],gt={transition(s,e,t){Es.update(r=>{const o=jc.find(i=>i.from===r.currentState&&i.trigger===s);if(!o)return console.warn(`Invalid transition: ${r.currentState} -> ${s}`),r;const n={...r,currentState:o.to,inputMethod:o.method||e||r.inputMethod,errorMessage:o.to!=="error"?null:r.errorMessage,successMessage:o.to!=="success"?null:r.successMessage,...t};return console.log(`Input state: ${r.currentState} -> ${n.currentState} (${s})`),n})},dragEnter(){gt.transition("DRAG_ENTER"),Es.update(s=>({...s,isDragActive:!0}))},dragLeave(){gt.transition("DRAG_LEAVE"),Es.update(s=>({...s,isDragActive:!1}))},dragOver(){gt.transition("DRAG_OVER")},drop(s){s.length!==0&&(gt.transition("DROP","drop"),Es.update(e=>({...e,isDragActive:!1,canAcceptInput:!1})),Qo.update(e=>({...e,dragEvents:e.dragEvents+1})))},pasteReady(){gt.transition("PASTE_READY","paste")},paste(){gt.transition("FILE_SELECTED","paste"),Es.update(s=>({...s,canAcceptInput:!1})),Qo.update(s=>({...s,pasteEvents:s.pasteEvents+1}))},uploadClick(){gt.transition("UPLOAD_CLICK","upload")},uploadSelected(s){gt.transition("FILE_SELECTED","upload"),Es.update(e=>({...e,canAcceptInput:!1})),Qo.update(e=>({...e,uploadEvents:e.uploadEvents+1}))},startProcessing(){gt.transition("FILE_SELECTED")},completeProcessing(s="Processing complete!"){gt.transition("PROCESS_COMPLETE"),Es.update(e=>({...e,successMessage:s,canAcceptInput:!0})),Qo.update(e=>({...e,successfulInputs:e.successfulInputs+1}))},errorProcessing(s){gt.transition("PROCESS_ERROR"),Es.update(e=>({...e,errorMessage:s,canAcceptInput:!0})),Qo.update(e=>({...e,failedInputs:e.failedInputs+1}))},reset(){gt.transition("RESET"),Es.update(s=>({...s,inputMethod:"none",isDragActive:!1,errorMessage:null,successMessage:null,canAcceptInput:!0}))},processAnother(){gt.transition("PROCESS_ANOTHER"),Es.update(s=>({...s,inputMethod:"none",isDragActive:!1,errorMessage:null,successMessage:null,canAcceptInput:!0}))},retry(){gt.transition("RETRY"),Es.update(s=>({...s,errorMessage:null,canAcceptInput:!0}))},setClipboardReady(s){Es.update(e=>({...e,isClipboardReady:s,showPasteHint:s}))},validateInput(s){const t=["image/jpeg","image/png","image/webp","image/bmp","image/tiff"];return s.size>10485760?{valid:!1,error:"File size too large (max 10MB)"}:t.includes(s.type.toLowerCase())?{valid:!0}:{valid:!1,error:"Unsupported file type"}}};if(typeof window<"u"){const s=!!(navigator.clipboard&&navigator.clipboard.read);gt.setClipboardReady(s)}const Lr=el({sessionId:ka(),startTime:Date.now(),imagesProcessed:0,successfulImages:0,totalProcessingTime:0,averageProcessingTime:0,sessionDuration:0,meetsTarget:!1,showProcessAnotherPrompt:!1,history:[]}),Nc=El(Lr,s=>({isFirstImage:s.imagesProcessed===0,hasProcessedImages:s.imagesProcessed>0,meetsTarget:s.imagesProcessed>=2,shouldShowProcessAnother:s.successfulImages>0,successRate:s.imagesProcessed>0?s.successfulImages/s.imagesProcessed*100:0,isActiveSession:s.sessionDuration<30*60*1e3,performanceGood:s.averageProcessingTime<5e3})),Lc=El(Lr,s=>({sessionDuration:oa(s.sessionDuration),imagesPerMinute:s.sessionDuration>0?(s.imagesProcessed/(s.sessionDuration/6e4)).toFixed(1):"0",averageProcessingTime:oa(s.averageProcessingTime),mostUsedInputMethod:Oc(s.history),quickestProcessingTime:zc(s.history),sessionScore:Uc(s)})),Mo={startNewSession(){Lr.set({sessionId:ka(),startTime:Date.now(),imagesProcessed:0,successfulImages:0,totalProcessingTime:0,averageProcessingTime:0,sessionDuration:0,meetsTarget:!1,showProcessAnotherPrompt:!1,history:[]})},recordProcessing(s,e,t,r=0){Lr.update(o=>{const n={id:`img_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,timestamp:Date.now(),filename:s,processingTime:e,success:!0,inputMethod:t,recoveryAttempts:r},i=[...o.history,n],u=o.imagesProcessed+1,c=o.successfulImages+1,f=o.totalProcessingTime+e,m=Date.now()-o.startTime;return{...o,imagesProcessed:u,successfulImages:c,totalProcessingTime:f,averageProcessingTime:f/u,sessionDuration:m,meetsTarget:u>=2,showProcessAnotherPrompt:!0,history:i}}),this.trackContinuityEvent("image_processed",{processingTime:e,inputMethod:t,recoveryAttempts:r})},recordFailure(s,e,t=0){Lr.update(r=>{const o={id:`fail_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,timestamp:Date.now(),filename:s,processingTime:0,success:!1,inputMethod:e,recoveryAttempts:t},n=[...r.history,o],i=r.imagesProcessed+1,u=Date.now()-r.startTime;return{...r,imagesProcessed:i,sessionDuration:u,history:n}}),this.trackContinuityEvent("image_failed",{inputMethod:e,recoveryAttempts:t})},processAnother(){Lr.update(s=>({...s,showProcessAnotherPrompt:!1,sessionDuration:Date.now()-s.startTime})),this.trackContinuityEvent("process_another_clicked")},endSession(){Lr.update(s=>{const e=Date.now()-s.startTime;return this.trackContinuityEvent("session_ended",{imagesProcessed:s.imagesProcessed,successfulImages:s.successfulImages,sessionDuration:e,meetsTarget:s.imagesProcessed>=2}),{...s,sessionDuration:e}})},updateSessionDuration(){Lr.update(s=>({...s,sessionDuration:Date.now()-s.startTime}))},getSessionSummary(){return new Promise(s=>{const e=Lr.subscribe(t=>{e();const r=Lc.subscribe(o=>{r(),s({...t,analytics:o})})})})},trackContinuityEvent(s,e){const t={type:s,timestamp:Date.now(),sessionId:null,data:e||{}};console.log("Session continuity event:",t);try{const r=JSON.parse(localStorage.getItem("session_events")||"[]");r.push(t),r.length>100&&r.splice(0,r.length-100),localStorage.setItem("session_events",JSON.stringify(r))}catch{}},clearSession(){Mo.startNewSession()}};function ka(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function oa(s){return s<1e3?`${s}ms`:s<6e4?`${(s/1e3).toFixed(1)}s`:`${Math.floor(s/6e4)}m ${Math.floor(s%6e4/1e3)}s`}function Oc(s){if(s.length===0)return"none";const e=s.reduce((t,r)=>(t[r.inputMethod]=(t[r.inputMethod]||0)+1,t),{});return Object.entries(e).reduce((t,r)=>e[t[0]]>e[r[0]]?t:r)[0]}function zc(s){const e=s.filter(t=>t.success&&t.processingTime>0).map(t=>t.processingTime);return e.length>0?Math.min(...e):0}function Uc(s){let e=0;return e+=s.imagesProcessed*20,e+=s.successfulImages*10,s.meetsTarget&&(e+=50),s.averageProcessingTime<5e3&&(e+=20),s.sessionDuration>5*60*1e3&&(e+=30),Math.min(e,100)}typeof window<"u"&&(setInterval(()=>{Mo.updateSessionDuration()},3e4),window.addEventListener("beforeunload",()=>{Mo.endSession()}));const eo={}.VITE_API_URL||"https://background-remover-ekco.onrender.com";class ft extends Error{constructor(e,t,r){super(e),this.status=t,this.response=r,this.name="APIError"}}const Do=class Do{constructor(){}static getInstance(){return Do.instance||(Do.instance=new Do),Do.instance}async processImage(e){const t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return this.processImageWithSession(e,t)}async processImageWithSession(e,t,r){const o=Date.now();try{const n=new FormData;n.append("file",e),n.append("session_id",t);const i=new AbortController,u=setTimeout(()=>i.abort(),3e4);r==null||r(10,"Uploading image..."),console.log("ðŸ” API DEBUG: === API REQUEST START ==="),console.log("ðŸ” API DEBUG: URL:",`${eo}/process`),console.log("ðŸ” API DEBUG: Method: POST"),console.log("ðŸ” API DEBUG: FormData file:",e.name,e.type,e.size),console.log("ðŸ” API DEBUG: Session ID:",t);const c=await fetch(`${eo}/process`,{method:"POST",body:n,signal:i.signal,headers:{}});if(clearTimeout(u),console.log("ðŸ” API DEBUG: === RESPONSE RECEIVED ==="),console.log("ðŸ” API DEBUG: Status:",c.status),console.log("ðŸ” API DEBUG: Status text:",c.statusText),console.log("ðŸ” API DEBUG: Response OK:",c.ok),console.log("ðŸ” API DEBUG: Response headers:",Object.fromEntries(c.headers.entries())),console.log("=== API RESPONSE RECEIVED ==="),console.log("Status:",c.status,c.statusText),console.log("Content-Type:",c.headers.get("content-type")),console.log("Content-Length:",c.headers.get("content-length")),console.log("All headers:",Object.fromEntries(c.headers.entries())),!c.ok){console.log("ðŸ” API DEBUG: === ERROR RESPONSE ==="),console.log("ðŸ” API DEBUG: Response not OK, status:",c.status);const b=await c.json().catch(_=>(console.log("ðŸ” API DEBUG: Failed to parse error JSON:",_),{}));console.log("ðŸ” API DEBUG: Parsed error data:",b);const w=b.detail||`HTTP ${c.status}: ${c.statusText}`;throw console.log("ðŸ” API DEBUG: Throwing APIError with message:",w),new ft(w,c.status,b)}r==null||r(90,"Finalizing...");const f=c.headers.get("content-type");if(console.log("=== PARSING RESPONSE ==="),console.log("Content-Type for parsing:",f),!f||!f.includes("application/json")){console.error("Unexpected response content type:",f);const b=await c.text();throw console.log("Response text (first 200 chars):",b.substring(0,200)),new ft(`Unexpected response type: ${f}`,c.status)}console.log("ðŸ” API DEBUG: Parsing JSON response...");const m=await c.json().catch(b=>{throw console.log("ðŸ” API DEBUG: JSON parsing failed:",b),new Error(`Failed to parse JSON response: ${b.message}`)});console.log("ðŸ” API DEBUG: === JSON PARSED SUCCESSFULLY ==="),console.log("ðŸ” API DEBUG: Parsed result:",m);const p=Date.now()-o;return this.trackProcessingMetrics(m.processing_id,p,!0),r==null||r(100,"Complete!"),m}catch(n){const i=Date.now()-o;if(console.log("=== API REQUEST FAILED ==="),console.log("Error type:",n.constructor.name),console.log("Error message:",n instanceof Error?n.message:n),console.log("Error stack:",n instanceof Error?n.stack:"No stack"),console.log("Processing time:",i),n instanceof ft)throw console.log("APIError status:",n.status),console.log("APIError response:",n.response),this.trackProcessingMetrics("failed",i,!1,n.message),n;const u=n instanceof Error?n.message:"Unknown error occurred";throw this.trackProcessingMetrics("failed",i,!1,u),u.includes("abort")?new ft("Processing timeout. Please try again with a smaller image.",408):eo.includes("localhost")&&u.includes("Failed to fetch")?new ft("Local backend server is not running. Please start the backend server with: npm run start:backend",0):!eo.includes("localhost")&&(u.includes("Failed to fetch")||u.includes("404"))?new ft("Backend deployment is in progress. Please try again in a few minutes or run the app locally for immediate testing.",503):new ft(`Network error: ${u}`,0)}}async getProcessingStatus(e){try{const t=await fetch(`${eo}/status/${e}`);if(!t.ok)throw new ft(`Failed to get status: ${t.statusText}`,t.status);return await t.json()}catch(t){throw t instanceof ft?t:new ft(`Status check failed: ${t}`,0)}}async downloadImage(e){try{const t=await fetch(`${eo}/download/${e}`);if(!t.ok)throw t.status===404?new ft("Image not found or has expired",404):new ft(`Download failed: ${t.statusText}`,t.status);return await t.blob()}catch(t){throw t instanceof ft?t:new ft(`Download error: ${t}`,0)}}async refineImage(e,t,r){const o=Date.now();try{const i=await(await fetch(t)).blob(),u=new File([i],"refined_image.png",{type:"image/png"}),c=new FormData;c.append("refined_image",u),c.append("original_processing_id",e),r==null||r(10,"Uploading refined image...");const f=new AbortController,m=setTimeout(()=>f.abort(),3e4);console.log("ðŸ” REFINE API DEBUG: Uploading refined image..."),console.log("ðŸ” Original processing ID:",e),console.log("ðŸ” Refined file size:",u.size);const p=await fetch(`${eo}/refine`,{method:"POST",body:c,signal:f.signal});if(clearTimeout(m),!p.ok){const _=await p.json().catch(()=>({})),y=_.detail||`HTTP ${p.status}: ${p.statusText}`;throw new ft(y,p.status,_)}r==null||r(90,"Finalizing refined image...");const b=await p.json(),w=Date.now()-o;return this.trackProcessingMetrics(b.processing_id,w,!0),r==null||r(100,"Refinement complete!"),b}catch(n){const i=Date.now()-o;if(console.log("=== REFINE API REQUEST FAILED ==="),console.log("Error:",n),n instanceof ft)throw this.trackProcessingMetrics("refine_failed",i,!1,n.message),n;const u=n instanceof Error?n.message:"Unknown error occurred";throw this.trackProcessingMetrics("refine_failed",i,!1,u),u.includes("abort")?new ft("Refinement timeout. Please try again.",408):new ft(`Refinement failed: ${u}`,0)}}async healthCheck(){try{const e=await fetch(`${eo}/health`);if(!e.ok)throw new ft(`Health check failed: ${e.statusText}`,e.status);return e.json()}catch(e){throw e instanceof ft?e:new ft(`Health check error: ${e}`,0)}}async withRetry(e,t=2,r=1e3){let o;for(let n=0;n<=t;n++)try{return await e()}catch(i){if(o=i,i instanceof ft&&i.status>=400&&i.status<500&&i.status!==408)throw i;if(n===t)break;const u=r*Math.pow(2,n);await new Promise(c=>setTimeout(c,u))}throw o}trackProcessingMetrics(e,t,r,o){const n={processingId:e,processingTime:t,success:r,error:o,timestamp:new Date().toISOString(),under5Seconds:t<5e3};console.log("Processing metrics:",n);try{const i=JSON.parse(localStorage.getItem("processing_metrics")||"[]");i.push(n),i.length>50&&i.splice(0,i.length-50),localStorage.setItem("processing_metrics",JSON.stringify(i))}catch{}}};or(Do,"instance");let _l=Do;const kl=_l.getInstance(),Io=class Io{constructor(){or(this,"config",{maxAttempts:4,strategies:["retry_original","compress_image","convert_format","reduce_quality"],delayMs:500,enableLogging:!0})}static getInstance(){return Io.instance||(Io.instance=new Io),Io.instance}async processWithRecovery(e,t,r){console.log("ðŸ” ERROR RECOVERY DEBUG: processWithRecovery started"),console.log("ðŸ” ERROR RECOVERY DEBUG: File:",e.name,e.size,e.type),console.log("ðŸ” ERROR RECOVERY DEBUG: Session ID:",t);const o=Date.now(),n=[];let i;for(let u=1;u<=this.config.maxAttempts;u++){const c=this.getStrategyForAttempt(u,i);r==null||r(10+(u-1)*20,this.getProgressMessage(c,u),u);try{console.log(`ðŸ” ERROR RECOVERY DEBUG: Attempt ${u} using strategy: ${c}`);const f=await this.applyRecoveryStrategy(e,c);console.log(`ðŸ” ERROR RECOVERY DEBUG: Applied recovery strategy, file size: ${f.size}`);const m=Date.now();console.log("ðŸ” ERROR RECOVERY DEBUG: Calling apiService.processImageWithSession...");const p=await kl.processImageWithSession(f,t,(w,_)=>r==null?void 0:r(10+(u-1)*20+w*.6,_,u));console.log(`ðŸ” ERROR RECOVERY DEBUG: API call succeeded on attempt ${u}:`,p);const b={attemptNumber:u,strategy:c,timestamp:m,success:!0};return n.push(b),this.config.enableLogging&&console.log(`Recovery success on attempt ${u} with strategy: ${c}`),{success:!0,result:p,attempts:n,totalTime:Date.now()-o,finalStrategy:c}}catch(f){console.log(`ðŸ” ERROR RECOVERY DEBUG: Attempt ${u} failed with error:`,f),console.log("ðŸ” ERROR RECOVERY DEBUG: Error type:",typeof f),console.log("ðŸ” ERROR RECOVERY DEBUG: Error instanceof Error:",f instanceof Error),f instanceof Error&&(console.log("ðŸ” ERROR RECOVERY DEBUG: Error message:",f.message),console.log("ðŸ” ERROR RECOVERY DEBUG: Error stack:",f.stack));const m=f instanceof Error?f.message:String(f);console.log("ðŸ” ERROR RECOVERY DEBUG: Classifying error message:",m);const p=et.classifyError(m,{fileSize:e.size,fileName:e.name,attempt:u});console.log("ðŸ” ERROR RECOVERY DEBUG: Error classification:",p);const b={attemptNumber:u,strategy:c,timestamp:Date.now(),success:!1,error:m};if(n.push(b),i=m,this.config.enableLogging&&(console.warn(`Recovery attempt ${u} failed with strategy ${c}:`,m),console.log("Error classification:",p)),!p.recoverable||p.severity==="critical")return{success:!1,error:p.userMessage,attempts:n,totalTime:Date.now()-o};if(u===this.config.maxAttempts)return{success:!1,error:this.getFinalErrorMessage(n),attempts:n,totalTime:Date.now()-o};const w=et.getRetryDelay(p,u);await this.delay(w)}}return{success:!1,error:"Maximum recovery attempts exceeded",attempts:n,totalTime:Date.now()-o}}getStrategyForAttempt(e,t){if(t&&e>1){const o=et.classifyError(t);if(o.recommendedStrategy)return o.recommendedStrategy}const r=Math.min(e-1,this.config.strategies.length-1);return this.config.strategies[r]}async applyRecoveryStrategy(e,t){switch(t){case"retry_original":return e;case"compress_image":return await this.compressImage(e,.8);case"convert_format":return await this.convertToJpeg(e);case"reduce_quality":return await this.compressImage(e,.6);default:return e}}async compressImage(e,t){try{const r=document.createElement("canvas"),o=r.getContext("2d"),n=new Image;return new Promise((i,u)=>{n.onload=()=>{let{width:c,height:f}=n;const m=2048;if(c>m||f>m){const p=Math.min(m/c,m/f);c*=p,f*=p}r.width=c,r.height=f,o==null||o.drawImage(n,0,0,c,f),r.toBlob(p=>{if(p){const b=new File([p],e.name,{type:"image/jpeg",lastModified:Date.now()});i(b)}else i(e)},"image/jpeg",t)},n.onerror=()=>i(e),n.src=URL.createObjectURL(e)})}catch{return e}}async convertToJpeg(e){return e.type==="image/jpeg"?e:this.compressImage(e,.9)}getProgressMessage(e,t){return{retry_original:t===1?"Processing your image...":"Retrying original image...",compress_image:"Optimizing image size...",convert_format:"Converting to compatible format...",reduce_quality:"Reducing image complexity...",fallback_api:"Trying alternative processing method..."}[e]||"Attempting recovery..."}getFinalErrorMessage(e){var o;const t=(o=e[e.length-1])==null?void 0:o.error,r=e.map(n=>n.strategy).join(", ");return`Processing failed after ${e.length} attempts (${r}). ${t||"Please try a different image."}`}delay(e){return new Promise(t=>setTimeout(t,e))}isRecoverableError(e){const t=typeof e=="string"?e:e.message;return[/network/i,/timeout/i,/too large/i,/file size/i,/format/i,/temporary/i,/server error/i,/5\d\d/].some(o=>o.test(t))}getRecommendedStrategy(e){const t=typeof e=="string"?e:e.message;return/too large|file size/i.test(t)?"compress_image":/format|unsupported/i.test(t)?"convert_format":/quality|complex/i.test(t)?"reduce_quality":"retry_original"}configure(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}resetConfig(){this.config={maxAttempts:4,strategies:["retry_original","compress_image","convert_format","reduce_quality"],delayMs:500,enableLogging:!0}}async retryWithErrorClassification(e,t,r,o){const n=et.classifyError(r,{fileSize:e.size,fileName:e.name,attempt:1});if(!n.recoverable)return{success:!1,error:n.userMessage,attempts:[],totalTime:0};if(n.recommendedStrategy){const i=n.recommendedStrategy;return this.retrySingleStrategy(e,t,i,o)}return this.processWithRecovery(e,t,o)}async retrySingleStrategy(e,t,r,o){const n=Date.now();o==null||o(10,this.getProgressMessage(r,1));try{const i=await this.applyRecoveryStrategy(e,r);return{success:!0,result:await kl.processImageWithSession(i,t,(c,f)=>o==null?void 0:o(10+c*.8,f)),attempts:[{attemptNumber:1,strategy:r,timestamp:n,success:!0}],totalTime:Date.now()-n,finalStrategy:r}}catch(i){const u=i instanceof Error?i.message:"Unknown error";return{success:!1,error:u,attempts:[{attemptNumber:1,strategy:r,timestamp:n,success:!1,error:u}],totalTime:Date.now()-n}}}shouldRetry(e,t){const r=et.classifyError(e,t);return et.shouldAutoRetry(r)}getEstimatedRetryDelay(e,t=1){const r=et.classifyError(e);return et.getRetryDelay(r,t)}};or(Io,"instance");let wl=Io;const gl=wl.getInstance(),So=class So{constructor(){}static getInstance(){return So.instance||(So.instance=new So),So.instance}isSupported(){return!!(navigator.clipboard&&navigator.clipboard.read&&typeof navigator.clipboard.read=="function")}async readImage(){try{if(!this.isSupported())return{success:!1,error:"Clipboard API not supported in this browser"};if(!await this.requestPermission())return{success:!1,error:"Clipboard permission denied"};const t=await navigator.clipboard.read();if(!t||t.length===0)return{success:!1,error:"No items found in clipboard"};for(const r of t){const o=r.types.filter(u=>u.startsWith("image/"));if(o.length===0)continue;const n=o[0],i=await r.getType(n);if(i&&i.size>0)return{success:!0,file:new File([i],`clipboard-image.${this.getExtensionFromMimeType(n)}`,{type:n})}}return{success:!1,error:"No valid images found in clipboard"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to read clipboard"}}}async requestPermission(){try{if(!navigator.permissions)return!0;const e=await navigator.permissions.query({name:"clipboard-read"});return e.state==="granted"||e.state==="prompt"}catch{return!0}}async copyImage(e){try{if(!navigator.clipboard||!navigator.clipboard.write)return!1;const t=new ClipboardItem({[e.type]:e});return await navigator.clipboard.write([t]),!0}catch(t){return console.warn("Failed to copy image to clipboard:",t),!1}}setupKeyboardListener(e){const t=async r=>{if(!((r.metaKey||r.ctrlKey)&&r.key==="v"))return;const n=r.target;if(n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable)return;r.preventDefault();const i=await this.readImage();i.success&&i.file&&e(i.file)};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}}getExtensionFromMimeType(e){return{"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp","image/bmp":"bmp","image/tiff":"tiff"}[e.toLowerCase()]||"png"}getCapabilities(){return{read:!!(navigator.clipboard&&navigator.clipboard.read),write:!!(navigator.clipboard&&navigator.clipboard.write),readText:!!(navigator.clipboard&&navigator.clipboard.readText),writeText:!!(navigator.clipboard&&navigator.clipboard.writeText),permissions:!!navigator.permissions}}};or(So,"instance");let yl=So;const Hc=yl.getInstance();function la(s){let e,t,r,o,n,i=`<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
              Process Multiple Images`,u,c,f;return t=new Ci({props:{disabled:s[0]}}),t.$on("imageSelected",s[20]),t.$on("error",s[21]),{c(){e=h("div"),lr(t.$$.fragment),r=C(),o=h("div"),n=h("button"),n.innerHTML=i,this.h()},l(m){e=g(m,"DIV",{class:!0});var p=v(e);nr(t.$$.fragment,p),r=D(p),o=g(p,"DIV",{class:!0});var b=v(o);n=g(b,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(n)!=="svelte-1tvqvdp"&&(n.innerHTML=i),b.forEach(d),p.forEach(d),this.h()},h(){a(n,"class","btn btn-outline border-magic-400 text-magic-400 hover:bg-magic-400 hover:text-white py-2 px-4 rounded-lg font-medium text-sm"),a(o,"class","text-center batch-button-container mt-6"),a(e,"class","max-w-2xl mx-auto")},m(m,p){Y(m,e,p),ar(t,e,null),l(e,r),l(e,o),l(o,n),u=!0,c||(f=se(n,"click",s[42]),c=!0)},p(m,p){const b={};p[0]&1&&(b.disabled=m[0]),t.$set(b)},i(m){u||($e(t.$$.fragment,m),u=!0)},o(m){ht(t.$$.fragment,m),u=!1},d(m){m&&d(e),ir(t),c=!1,f()}}}function na(s){let e,t,r,o,n,i,u;return r=new Pi({props:{image:s[8],isProcessing:s[0]||s[15],processingProgress:s[15]?s[17]:s[6],processingMessage:s[15]?s[16]:s[5]||"Processing your character...",processedResult:s[9]}}),r.$on("animationComplete",s[43]),r.$on("scanlineComplete",s[44]),i=new Wi({props:{status:"processing",progress:s[15]?s[17]:s[6],message:s[15]?s[16]:s[5]||"Processing your character...",attemptNumber:s[7],showDetails:s[7]>1}}),{c(){e=h("div"),t=h("div"),lr(r.$$.fragment),o=C(),n=h("div"),lr(i.$$.fragment),this.h()},l(c){e=g(c,"DIV",{class:!0});var f=v(e);t=g(f,"DIV",{class:!0});var m=v(t);nr(r.$$.fragment,m),o=D(m),n=g(m,"DIV",{class:!0});var p=v(n);nr(i.$$.fragment,p),p.forEach(d),m.forEach(d),f.forEach(d),this.h()},h(){a(n,"class","absolute bottom-4 left-4 right-4 z-50"),a(t,"class","processing-container svelte-1blw2di"),a(e,"class","processing-section svelte-1blw2di")},m(c,f){Y(c,e,f),l(e,t),ar(r,t,null),l(t,o),l(t,n),ar(i,n,null),u=!0},p(c,f){const m={};f[0]&256&&(m.image=c[8]),f[0]&32769&&(m.isProcessing=c[0]||c[15]),f[0]&163904&&(m.processingProgress=c[15]?c[17]:c[6]),f[0]&98336&&(m.processingMessage=c[15]?c[16]:c[5]||"Processing your character..."),f[0]&512&&(m.processedResult=c[9]),r.$set(m);const p={};f[0]&163904&&(p.progress=c[15]?c[17]:c[6]),f[0]&98336&&(p.message=c[15]?c[16]:c[5]||"Processing your character..."),f[0]&128&&(p.attemptNumber=c[7]),f[0]&128&&(p.showDetails=c[7]>1),i.$set(p)},i(c){u||($e(r.$$.fragment,c),$e(i.$$.fragment,c),u=!0)},o(c){ht(r.$$.fragment,c),ht(i.$$.fragment,c),u=!1},d(c){c&&d(e),ir(r),ir(i)}}}function aa(s){var H;let e,t,r,o,n='<svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',i,u,c,f="Magic Complete!",m,p,b,w=((H=s[1].processing_time)==null?void 0:H.toFixed(2))+"",_,y,V,S,k="Image automatically copied to clipboard",M,A,x,R,I=`<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-4-4m4 4l4-4m-4-4V3"></path></svg>
                  Download PNG`,U,B,T=`<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                  Process Another`,j,G,z=s[19].hasProcessedImages&&ia(s);return{c(){e=h("div"),t=h("div"),r=h("div"),o=h("div"),o.innerHTML=n,i=C(),u=h("div"),c=h("h3"),c.textContent=f,m=C(),p=h("p"),b=L("Background removed in "),_=L(w),y=L("s"),V=C(),S=h("p"),S.textContent=k,M=C(),z&&z.c(),A=C(),x=h("div"),R=h("button"),R.innerHTML=I,U=C(),B=h("button"),B.innerHTML=T,this.h()},l(E){e=g(E,"DIV",{class:!0});var F=v(e);t=g(F,"DIV",{class:!0});var P=v(t);r=g(P,"DIV",{class:!0});var N=v(r);o=g(N,"DIV",{class:!0,"data-svelte-h":!0}),Z(o)!=="svelte-7jb8d9"&&(o.innerHTML=n),i=D(N),u=g(N,"DIV",{});var K=v(u);c=g(K,"H3",{class:!0,"data-svelte-h":!0}),Z(c)!=="svelte-qk9ko5"&&(c.textContent=f),m=D(K),p=g(K,"P",{class:!0});var q=v(p);b=O(q,"Background removed in "),_=O(q,w),y=O(q,"s"),q.forEach(d),V=D(K),S=g(K,"P",{class:!0,"data-svelte-h":!0}),Z(S)!=="svelte-whk9x6"&&(S.textContent=k),M=D(K),z&&z.l(K),K.forEach(d),A=D(N),x=g(N,"DIV",{class:!0});var X=v(x);R=g(X,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(R)!=="svelte-ryd2av"&&(R.innerHTML=I),U=D(X),B=g(X,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(B)!=="svelte-178t1yh"&&(B.innerHTML=T),X.forEach(d),N.forEach(d),P.forEach(d),F.forEach(d),this.h()},h(){a(o,"class","w-16 h-16 mx-auto rounded-full bg-green-400/20 flex items-center justify-center"),a(c,"class","text-2xl font-semibold text-magic-gradient mb-2"),a(p,"class","text-dark-text-secondary mb-1"),a(S,"class","text-sm text-dark-text-muted mb-2"),a(R,"class","btn btn-magic py-3 px-6 rounded-lg font-medium"),a(B,"class","btn btn-outline border-magic-400 text-magic-400 hover:bg-magic-400 hover:text-white py-3 px-6 rounded-lg font-medium"),a(x,"class","flex flex-col sm:flex-row gap-4 justify-center"),a(r,"class","space-y-6"),a(t,"class","success-card glass-card rounded-xl p-8 text-center magic-reveal svelte-1blw2di"),a(e,"class","max-w-2xl mx-auto")},m(E,F){Y(E,e,F),l(e,t),l(t,r),l(r,o),l(r,i),l(r,u),l(u,c),l(u,m),l(u,p),l(p,b),l(p,_),l(p,y),l(u,V),l(u,S),l(u,M),z&&z.m(u,null),l(r,A),l(r,x),l(x,R),l(x,U),l(x,B),j||(G=[se(R,"click",s[30]),se(B,"click",s[22])],j=!0)},p(E,F){var P;F[0]&2&&w!==(w=((P=E[1].processing_time)==null?void 0:P.toFixed(2))+"")&&pe(_,w),E[19].hasProcessedImages?z?z.p(E,F):(z=ia(E),z.c(),z.m(u,null)):z&&(z.d(1),z=null)},d(E){E&&d(e),z&&z.d(),j=!1,Jt(G)}}}function ia(s){let e;function t(n,i){return n[19].meetsTarget?qc:Gc}let r=t(s),o=r(s);return{c(){e=h("div"),o.c(),this.h()},l(n){e=g(n,"DIV",{class:!0});var i=v(e);o.l(i),i.forEach(d),this.h()},h(){a(e,"class","text-xs text-magic-300")},m(n,i){Y(n,e,i),o.m(e,null)},p(n,i){r===(r=t(n))&&o?o.p(n,i):(o.d(1),o=r(n),o&&(o.c(),o.m(e,null)))},d(n){n&&d(e),o.d()}}}function Gc(s){let e,t=(s[19].hasProcessedImages?s[19].hasProcessedImages:0)+"",r,o;return{c(){e=L("ðŸ“ˆ Session progress: "),r=L(t),o=L("/2 images")},l(n){e=O(n,"ðŸ“ˆ Session progress: "),r=O(n,t),o=O(n,"/2 images")},m(n,i){Y(n,e,i),Y(n,r,i),Y(n,o,i)},p(n,i){i[0]&524288&&t!==(t=(n[19].hasProcessedImages?n[19].hasProcessedImages:0)+"")&&pe(r,t)},d(n){n&&(d(e),d(r),d(o))}}}function qc(s){let e,t=(s[19].hasProcessedImages?s[19].hasProcessedImages:0)+"",r,o;return{c(){e=L("ðŸŽ¯ Session target achieved! ("),r=L(t),o=L(" images processed)")},l(n){e=O(n,"ðŸŽ¯ Session target achieved! ("),r=O(n,t),o=O(n," images processed)")},m(n,i){Y(n,e,i),Y(n,r,i),Y(n,o,i)},p(n,i){i[0]&524288&&t!==(t=(n[19].hasProcessedImages?n[19].hasProcessedImages:0)+"")&&pe(r,t)},d(n){n&&(d(e),d(r),d(o))}}}function ca(s){let e,t,r;return t=new Ji({props:{error:s[2],context:s[10],showTechnicalDetails:!0,allowRetry:!0,autoHide:s[10].attempt===1}}),t.$on("retry",s[27]),t.$on("dismiss",s[28]),{c(){e=h("div"),lr(t.$$.fragment),this.h()},l(o){e=g(o,"DIV",{class:!0});var n=v(e);nr(t.$$.fragment,n),n.forEach(d),this.h()},h(){a(e,"class","max-w-4xl mx-auto")},m(o,n){Y(o,e,n),ar(t,e,null),r=!0},p(o,n){const i={};n[0]&4&&(i.error=o[2]),n[0]&1024&&(i.context=o[10]),n[0]&1024&&(i.autoHide=o[10].attempt===1),t.$set(i)},i(o){r||($e(t.$$.fragment,o),r=!0)},o(o){ht(t.$$.fragment,o),r=!1},d(o){o&&d(e),ir(t)}}}function ua(s){let e,t,r;return t=new Bi({props:{originalImage:s[8],processedResult:s[1],autoProceeds:!1,autoProceedDelay:3e3}}),t.$on("proceed",s[23]),t.$on("stay",s[29]),{c(){e=h("section"),lr(t.$$.fragment),this.h()},l(o){e=g(o,"SECTION",{class:!0});var n=v(e);nr(t.$$.fragment,n),n.forEach(d),this.h()},h(){a(e,"class","preview-section py-8")},m(o,n){Y(o,e,n),ar(t,e,null),r=!0},p(o,n){const i={};n[0]&256&&(i.originalImage=o[8]),n[0]&2&&(i.processedResult=o[1]),t.$set(i)},i(o){r||($e(t.$$.fragment,o),r=!0)},o(o){ht(t.$$.fragment,o),r=!1},d(o){o&&d(e),ir(t)}}}function da(s){let e,t='<div class="container"><div class="text-center mb-12"><h2 class="text-3xl font-bold text-dark-text mb-4">Built for Developer Workflow</h2> <p class="text-lg text-dark-text-secondary max-w-2xl mx-auto">Designed for speed and efficiency. Get back to building faster.</p></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto"><div class="feature-card glass-card rounded-xl p-6 text-center svelte-1blw2di"><div class="w-12 h-12 mx-auto mb-4 rounded-lg bg-magic-400/20 flex items-center justify-center"><svg class="w-6 h-6 text-magic-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div> <h3 class="text-lg font-semibold text-dark-text mb-2">Lightning Fast</h3> <p class="text-sm text-dark-text-secondary">Average processing under 5 seconds. Keep your momentum going.</p></div> <div class="feature-card glass-card rounded-xl p-6 text-center svelte-1blw2di"><div class="w-12 h-12 mx-auto mb-4 rounded-lg bg-magic-400/20 flex items-center justify-center"><svg class="w-6 h-6 text-magic-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></div> <h3 class="text-lg font-semibold text-dark-text mb-2">Seamless Paste</h3> <p class="text-sm text-dark-text-secondary">Cmd+V from any AI generator. Results auto-copy to clipboard.</p></div> <div class="feature-card glass-card rounded-xl p-6 text-center svelte-1blw2di"><div class="w-12 h-12 mx-auto mb-4 rounded-lg bg-magic-400/20 flex items-center justify-center"><svg class="w-6 h-6 text-magic-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div> <h3 class="text-lg font-semibold text-dark-text mb-2">Privacy First</h3> <p class="text-sm text-dark-text-secondary">Images auto-delete after 1 hour. No tracking, no accounts needed.</p></div></div></div>';return{c(){e=h("section"),e.innerHTML=t,this.h()},l(r){e=g(r,"SECTION",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-6b4rhs"&&(e.innerHTML=t),this.h()},h(){a(e,"class","features py-16 sm:py-24")},m(r,o){Y(r,e,o)},d(r){r&&d(e)}}}function fa(s){let e,t='<svg class="w-5 h-5 text-magic-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10m0 0V6a2 2 0 00-2-2H9a2 2 0 00-2 2v2m0 0v10a2 2 0 002 2h8a2 2 0 002-2V8M9 12h6"></path></svg>',r,o;return{c(){e=h("button"),e.innerHTML=t,this.h()},l(n){e=g(n,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Z(e)!=="svelte-10pz063"&&(e.innerHTML=t),this.h()},h(){a(e,"class","fixed bottom-6 left-6 bg-magic-400/20 hover:bg-magic-400/30 border border-magic-400/40 rounded-full p-3 transition-all duration-200 z-40"),a(e,"title","Send Feedback")},m(n,i){Y(n,e,i),r||(o=se(e,"click",s[35]),r=!0)},p:Ge,d(n){n&&d(e),r=!1,o()}}}function ha(s){let e,t;return e=new Ec({props:{originalImage:s[8].preview,processedImage:s[9]||"",isVisible:s[14]}}),e.$on("refined",s[24]),e.$on("cancel",s[25]),e.$on("error",s[26]),{c(){lr(e.$$.fragment)},l(r){nr(e.$$.fragment,r)},m(r,o){ar(e,r,o),t=!0},p(r,o){const n={};o[0]&256&&(n.originalImage=r[8].preview),o[0]&512&&(n.processedImage=r[9]||""),o[0]&16384&&(n.isVisible=r[14]),e.$set(n)},i(r){t||($e(e.$$.fragment,r),t=!0)},o(r){ht(e.$$.fragment,r),t=!1},d(r){ir(e,r)}}}function Wc(s){let e,t,r,o,n=`<div class="container text-center"><div class="mb-8"><h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold mb-4"><span class="text-magic-gradient">Transform Characters</span> <br/> <span class="text-dark-text">with Magic</span></h1> <p class="text-xl sm:text-2xl text-dark-text-secondary max-w-2xl mx-auto leading-relaxed">Watch backgrounds disappear effortlessly. Perfect for 
          <span class="text-magic-400 font-medium">AI-generated character assets</span>.</p></div> <div class="flex items-center justify-center space-x-2 mb-12 text-dark-text-muted"><svg class="w-5 h-5 text-magic-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path></svg> <span class="text-sm">Average processing time: &lt;5 seconds</span></div></div>`,i,u,c,f,m,p,b,w,_,y,V,S,k,M,A,x,R,I,U,B=!s[0]&&!s[1]&&la(s),T=(s[0]||s[15])&&s[8]&&na(s),j=s[1]&&s[3]&&aa(s),G=s[2]&&ca(s),z=s[1]&&s[4]&&s[8]&&ua(s),H=!s[0]&&!s[1]&&!s[4]&&da();y=new oc({props:{visible:s[11],imagesProcessed:ut.metrics.images_processed}}),y.$on("submit",s[31]),y.$on("dismiss",s[32]),S=new dc({props:{visible:s[12],contextData:{images_processed:ut.metrics.images_processed,successful_completions:ut.metrics.successful_completions,failed_attempts:ut.metrics.failed_attempts,processing_time:ut.metrics.total_processing_time/Math.max(1,ut.metrics.successful_completions),session_duration:ut.metrics.session_duration}}}),S.$on("submit",s[33]),S.$on("dismiss",s[34]),M=new gc({props:{visible:s[13],isDevMode:!0}}),M.$on("close",s[36]);let E=!s[0]&&!s[12]&&fa(s),F=s[14]&&s[8]&&s[1]&&ha(s);return I=new Bc({props:{isVisible:s[18]}}),I.$on("completed",s[37]),I.$on("error",s[38]),I.$on("close",s[39]),{c(){e=h("meta"),t=C(),r=h("div"),o=h("section"),o.innerHTML=n,i=C(),u=h("section"),c=h("div"),B&&B.c(),f=C(),T&&T.c(),m=C(),j&&j.c(),p=C(),G&&G.c(),b=C(),z&&z.c(),w=C(),H&&H.c(),_=C(),lr(y.$$.fragment),V=C(),lr(S.$$.fragment),k=C(),lr(M.$$.fragment),A=C(),E&&E.c(),x=C(),F&&F.c(),R=C(),lr(I.$$.fragment),this.h()},l(P){const N=xa("svelte-thm2db",document.head);e=g(N,"META",{name:!0,content:!0}),N.forEach(d),t=D(P),r=g(P,"DIV",{class:!0});var K=v(r);o=g(K,"SECTION",{class:!0,"data-svelte-h":!0}),Z(o)!=="svelte-1h6iamq"&&(o.innerHTML=n),i=D(K),u=g(K,"SECTION",{class:!0});var q=v(u);c=g(q,"DIV",{class:!0});var X=v(c);B&&B.l(X),f=D(X),T&&T.l(X),m=D(X),j&&j.l(X),p=D(X),G&&G.l(X),X.forEach(d),q.forEach(d),b=D(K),z&&z.l(K),w=D(K),H&&H.l(K),K.forEach(d),_=D(P),nr(y.$$.fragment,P),V=D(P),nr(S.$$.fragment,P),k=D(P),nr(M.$$.fragment,P),A=D(P),E&&E.l(P),x=D(P),F&&F.l(P),R=D(P),nr(I.$$.fragment,P),this.h()},h(){document.title="CharacterCut - Transform Your Characters with Magic",a(e,"name","description"),a(e,"content","Remove backgrounds from AI-generated characters instantly. Drag, drop, or paste - watch backgrounds disappear like magic."),a(o,"class","hero py-12 sm:py-20 svelte-1blw2di"),a(c,"class","container"),a(u,"class","interface py-8"),a(r,"class","page-container svelte-1blw2di")},m(P,N){l(document.head,e),Y(P,t,N),Y(P,r,N),l(r,o),l(r,i),l(r,u),l(u,c),B&&B.m(c,null),l(c,f),T&&T.m(c,null),l(c,m),j&&j.m(c,null),l(c,p),G&&G.m(c,null),l(r,b),z&&z.m(r,null),l(r,w),H&&H.m(r,null),Y(P,_,N),ar(y,P,N),Y(P,V,N),ar(S,P,N),Y(P,k,N),ar(M,P,N),Y(P,A,N),E&&E.m(P,N),Y(P,x,N),F&&F.m(P,N),Y(P,R,N),ar(I,P,N),U=!0},p(P,N){!P[0]&&!P[1]?B?(B.p(P,N),N[0]&3&&$e(B,1)):(B=la(P),B.c(),$e(B,1),B.m(c,f)):B&&(Jo(),ht(B,1,1,()=>{B=null}),Ko()),(P[0]||P[15])&&P[8]?T?(T.p(P,N),N[0]&33025&&$e(T,1)):(T=na(P),T.c(),$e(T,1),T.m(c,m)):T&&(Jo(),ht(T,1,1,()=>{T=null}),Ko()),P[1]&&P[3]?j?j.p(P,N):(j=aa(P),j.c(),j.m(c,p)):j&&(j.d(1),j=null),P[2]?G?(G.p(P,N),N[0]&4&&$e(G,1)):(G=ca(P),G.c(),$e(G,1),G.m(c,null)):G&&(Jo(),ht(G,1,1,()=>{G=null}),Ko()),P[1]&&P[4]&&P[8]?z?(z.p(P,N),N[0]&274&&$e(z,1)):(z=ua(P),z.c(),$e(z,1),z.m(r,w)):z&&(Jo(),ht(z,1,1,()=>{z=null}),Ko()),!P[0]&&!P[1]&&!P[4]?H||(H=da(),H.c(),H.m(r,null)):H&&(H.d(1),H=null);const K={};N[0]&2048&&(K.visible=P[11]),y.$set(K);const q={};N[0]&4096&&(q.visible=P[12]),S.$set(q);const X={};N[0]&8192&&(X.visible=P[13]),M.$set(X),!P[0]&&!P[12]?E?E.p(P,N):(E=fa(P),E.c(),E.m(x.parentNode,x)):E&&(E.d(1),E=null),P[14]&&P[8]&&P[1]?F?(F.p(P,N),N[0]&16642&&$e(F,1)):(F=ha(P),F.c(),$e(F,1),F.m(R.parentNode,R)):F&&(Jo(),ht(F,1,1,()=>{F=null}),Ko());const re={};N[0]&262144&&(re.isVisible=P[18]),I.$set(re)},i(P){U||($e(B),$e(T),$e(G),$e(z),$e(y.$$.fragment,P),$e(S.$$.fragment,P),$e(M.$$.fragment,P),$e(F),$e(I.$$.fragment,P),U=!0)},o(P){ht(B),ht(T),ht(G),ht(z),ht(y.$$.fragment,P),ht(S.$$.fragment,P),ht(M.$$.fragment,P),ht(F),ht(I.$$.fragment,P),U=!1},d(P){P&&(d(t),d(r),d(_),d(V),d(k),d(A),d(x),d(R)),d(e),B&&B.d(),T&&T.d(),j&&j.d(),G&&G.d(),z&&z.d(),H&&H.d(),ir(y,P),ir(S,P),ir(M,P),E&&E.d(P),F&&F.d(P),ir(I,P)}}}function cl(){return"upload"}function Yc(){console.log("Image copied to clipboard for immediate use")}function Kc(s,e,t){let r,o,n;is(s,Nc,_e=>t(40,o=_e)),is(s,Ra,_e=>t(41,n=_e));let i=!1,u=null,c=null,f=!1,m=!1,p="",b=0,w=1,_=null,y=null,V={},S=!1,k=!1,M=!1,A=!1,x=!1,R=!1,I="",U=0,B=!1;Cr(()=>{Kt.reset(),ut.trackUniqueUser(),window.addEventListener("keydown",_e=>{_e.ctrlKey&&_e.shiftKey&&_e.key==="A"&&t(13,M=!0)})});async function T(_e){var de;console.log("ðŸ” FRONTEND DEBUG: handleImageSelected called");const{image:ce}=_e.detail;console.log("ðŸ” File details:",ce.file.name,ce.file.size,ce.file.type),t(8,_=ce),t(2,c=null),t(1,u=null),t(3,f=!1),t(4,m=!1),t(5,p=""),t(6,b=0),t(7,w=1),t(9,y=null);try{t(0,i=!0),Kt.setProcessingStatus("processing"),gt.startProcessing(),await ut.trackProcessingStart(ce,cl());const ue=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;console.log("ðŸ” FRONTEND DEBUG: About to call processWithRecovery"),console.log("ðŸ” Session ID:",ue);const ye=await gl.processWithRecovery(ce.file,ue,(Re,Qe,Ue)=>{console.log("ðŸ” Progress update:",Re,Qe,Ue),t(6,b=Re),t(5,p=Qe),t(7,w=Ue||1),Kt.updateProgress(Re,Qe)});if(console.log("ðŸ” FRONTEND DEBUG: processWithRecovery completed"),console.log("ðŸ” Recovery result:",ye),ye.success&&ye.result)t(1,u=ye.result),t(9,y=ye.result.download_url),Kt.completeProcessing(ye.result.download_url,ye.totalTime),gt.completeProcessing("Background removed successfully!"),Mo.recordProcessing(ce.file.name,ye.totalTime,cl(),((de=ye.attempts)==null?void 0:de.length)||0),t(4,m=!0),await ut.trackTaskCompletion(!0,ye.totalTime),await ut.trackSessionContinuity(),await G(ye.result.download_url);else throw new Error(ye.error||"Processing failed after all recovery attempts")}catch(ue){console.log("ðŸ” FRONTEND DEBUG: Caught error in handleImageSelected"),console.log("ðŸ” Error object:",ue),console.log("ðŸ” Error type:",typeof ue),console.log("ðŸ” Error instanceof Error:",ue instanceof Error),ue instanceof Error&&(console.log("ðŸ” Error message:",ue.message),console.log("ðŸ” Error stack:",ue.stack));const ye=ue instanceof Error?ue.message:"Processing failed";console.log("ðŸ” Final error message set to:",ye),t(2,c=ye),t(10,V={fileSize:ce.file.size,fileName:ce.file.name,attempt:w,userAgent:navigator.userAgent}),Kt.setError(ye),gt.errorProcessing(ye),await ut.trackTaskCompletion(!1,0,ye),Mo.recordFailure(ce.file.name,cl(),w)}finally{t(0,i=!1)}}function j(_e){t(2,c=_e.detail.message),t(10,V={userAgent:navigator.userAgent,attempt:1}),Kt.setProcessingStatus("error")}async function G(_e){try{const ce=await fetch(_e);if(!ce.ok)throw new Error("Failed to fetch processed image");const de=await ce.blob();await Hc.copyImage(de)?(Yc(),console.log("Image automatically copied to clipboard for immediate use")):console.warn("Clipboard copy failed, download option available")}catch(ce){console.warn("Failed to copy to clipboard:",ce)}}async function z(){await ut.trackProcessAnother(),Kt.resetProcessing(),gt.processAnother(),Mo.processAnother(),t(2,c=null),t(1,u=null),t(3,f=!1),t(4,m=!1),t(0,i=!1),t(5,p=""),t(6,b=0),t(7,w=1),t(8,_=null),t(9,y=null),t(10,V={})}function H(_e){const{action:ce}=_e.detail;ce==="download"?X():ce==="continue"?z():ce==="refine"&&t(14,x=!0)}async function E(_e){const{refinedImage:ce}=_e.detail;if(console.log("=== REFINEMENT HANDLER ==="),console.log("Received refined image:",ce?"YES":"NO"),console.log("Current result:",u),!(u!=null&&u.processing_id)){console.error("No processing ID available for refinement");return}try{t(15,R=!0),t(14,x=!1),t(17,U=0),t(16,I="Processing refined image..."),console.log("Starting API refinement with processing ID:",u.processing_id);const de=await kl.refineImage(u.processing_id,ce,(ue,ye)=>{console.log("Refinement progress:",ue,ye),t(17,U=ue),t(16,I=ye),Kt.updateProgress(ue,ye)});console.log("API refinement successful:",de),t(1,u=de),t(9,y=de.download_url),Kt.completeProcessing(de.download_url,de.processing_time),await G(de.download_url),await ut.trackTaskCompletion(!0,de.processing_time),console.log("Refinement completed successfully")}catch(de){console.error("=== REFINEMENT HANDLER ERROR ==="),console.error("Error object:",de),console.error("Error type:",typeof de),console.error("Error instanceof Error:",de instanceof Error),de instanceof Error&&(console.error("Error message:",de.message),console.error("Error stack:",de.stack));const ue=de instanceof Error?de.message:"Refinement failed";t(2,c=ue),Kt.setError(ue),await ut.trackTaskCompletion(!1,0,ue)}finally{t(15,R=!1),t(17,U=0),t(16,I="")}}function F(){t(14,x=!1)}function P(_e){const{message:ce}=_e.detail;t(2,c=ce),t(14,x=!1),Kt.setError(ce)}async function N(){var _e;if(_){t(2,c=null);const ce=c;t(10,V={});try{t(0,i=!0),Kt.setProcessingStatus("processing"),gt.startProcessing();const de=`retry_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;let ue;if(ce?ue=await gl.retryWithErrorClassification(_.file,de,ce,(ye,Re)=>{t(6,b=ye),t(5,p=Re),Kt.updateProgress(ye,Re)}):ue=await gl.processWithRecovery(_.file,de,(ye,Re,Qe)=>{t(6,b=ye),t(5,p=Re),t(7,w=Qe||1),Kt.updateProgress(ye,Re)}),ue.success&&ue.result)t(1,u=ue.result),t(9,y=ue.result.download_url),Kt.completeProcessing(ue.result.download_url,ue.totalTime),gt.completeProcessing("Background removed successfully!"),Mo.recordProcessing(_.file.name,ue.totalTime,cl(),((_e=ue.attempts)==null?void 0:_e.length)||0),t(4,m=!0),await G(ue.result.download_url);else throw new Error(ue.error||"Retry failed after all recovery attempts")}catch(de){const ue=de instanceof Error?de.message:"Retry failed";t(2,c=ue),t(10,V={fileSize:_.file.size,fileName:_.file.name,attempt:w+1,userAgent:navigator.userAgent,isRetry:!0}),Kt.setError(ue),gt.errorProcessing(ue)}finally{t(0,i=!1)}}else t(2,c=null),t(10,V={})}function K(){t(2,c=null),t(10,V={})}function q(){t(3,f=!0),t(4,m=!1)}async function X(){if(u!=null&&u.download_url)try{if(!await Ri.downloadImage(u.download_url,{format:"png"},{processingId:u.processing_id,processingTime:u.processing_time,timestamp:new Date().toISOString(),format:"png"}))throw new Error("Download service failed");await ut.trackDownload("png")}catch(_e){t(2,c="Download failed. Please try again."),console.error("Download error:",_e)}}function re(_e){const{score:ce,feedback:de}=_e.detail;console.log("NPS submitted:",{score:ce,feedback:de}),t(11,S=!1)}function Q(){t(11,S=!1)}function te(_e){const{type:ce,content:de,email:ue}=_e.detail;console.log("Feedback submitted:",{type:ce,content:de,email:ue}),t(12,k=!1)}function ee(){t(12,k=!1)}function oe(){t(12,k=!0)}function ne(){t(13,M=!1)}function ke(_e){const{batchResults:ce}=_e.detail;console.log("Batch processing completed:",ce),ut.trackBatchCompletion(ce.successful_count,ce.total_images)}function ae(_e){const{message:ce}=_e.detail;console.error("Batch processing error:",ce),t(2,c=ce)}function be(){t(18,B=!1)}const Ie=()=>t(18,B=!0),J=()=>{console.log("Scanline animation completed")},Ae=()=>{console.log("Scanline processing phase completed")};return s.$$.update=()=>{s.$$.dirty[1]&1024&&n.currentImage,s.$$.dirty[1]&1024&&n.processingState.status,s.$$.dirty[1]&512&&t(19,r=o)},[i,u,c,f,m,p,b,w,_,y,V,S,k,M,x,R,I,U,B,r,T,j,z,H,E,F,P,N,K,q,X,re,Q,te,ee,oe,ne,ke,ae,be,o,n,Ie,J,Ae]}class su extends Rs{constructor(e){super(),As(this,e,Kc,Wc,Ps,{},null,[-1,-1])}}export{su as component};
